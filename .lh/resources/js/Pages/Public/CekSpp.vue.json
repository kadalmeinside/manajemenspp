{
    "sourceFile": "resources/js/Pages/Public/CekSpp.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 10,
            "patches": [
                {
                    "date": 1754378698573,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1754379159811,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n <script setup>\n import { Head, Link, useForm, usePage } from '@inertiajs/vue3';\n import { computed, ref } from 'vue';\n import ApplicationLogo from '@/Components/ApplicationLogo.vue';\n-import { CreditCardIcon, ArrowPathIcon, UserIcon } from '@heroicons/vue/24/outline';\n+import { CreditCardIcon, ArrowPathIcon, UserIcon, CheckCircleIcon } from '@heroicons/vue/24/outline';\n import { XCircleIcon } from '@heroicons/vue/20/solid';\n import PrimaryButton from '@/Components/PrimaryButton.vue';\n import InputLabel from '@/Components/InputLabel.vue';\n import TextInput from '@/Components/TextInput.vue';\n@@ -12,17 +12,20 @@\n \n const props = defineProps({\n     pageTitle: String,\n     errors: Object,\n-    foundSiswa: Array, // Daftar siswa yang ditemukan\n-    selectedSiswa: Object, // Siswa yang sudah dipilih\n+    foundSiswa: Array,\n+    selectedSiswa: Object,\n     sppInvoices: Array,\n     lastPaidPeriod: String,\n-    searchedPhone: String, // Untuk mengisi kembali form\n+    searchedPhone: String,\n });\n \n const page = usePage();\n const appLogo = computed(() => page.props.app_settings?.app_logo ? `/storage/${page.props.app_settings.app_logo}` : null);\n+const flashMessage = computed(() => page.props.flash?.message);\n+const flashType = computed(() => page.props.flash?.type || 'info');\n+const showSuccessCard = computed(() => flashMessage.value && flashType.value === 'success');\n \n // --- State & Forms ---\n const isSearching = ref(false);\n const isRedirecting = ref(false);\n@@ -30,12 +33,19 @@\n const lookupForm = useForm({\n     nomor_telepon_wali: props.searchedPhone || '',\n });\n \n+const createUserForm = useForm({\n+    name: '',\n+    email: '',\n+    password: '',\n+    password_confirmation: '',\n+});\n+\n const selectedPeriods = ref([]);\n const paymentForm = useForm({ periods: [] });\n \n-// --- Logika Halaman Tagihan (jika selectedSiswa ada) ---\n+// --- Logika Halaman Tagihan ---\n const displayList = computed(() => {\n     if (!props.selectedSiswa) return [];\n     const existingInvoices = (props.sppInvoices || []).map(inv => ({ ...inv, is_projected: false }));\n     const projectedInvoices = [];\n@@ -88,8 +98,19 @@\n         onFinish: () => isSearching.value = false,\n     });\n };\n \n+const submitCreateUser = () => {\n+    createUserForm.post(route('tagihan.create_user'), {\n+        preserveScroll: true,\n+        onError: () => {\n+            if (!createUserForm.name) createUserForm.setError('name', 'Nama akun wajib diisi.');\n+            if (!createUserForm.email) createUserForm.setError('email', 'Email wajib diisi.');\n+            if (!createUserForm.password) createUserForm.setError('password', 'Password wajib diisi.');\n+        }\n+    });\n+};\n+\n const updateSelection = (item, isChecked) => {\n     const clickedIndex = displayList.value.findIndex(i => i.id === item.id);\n     if (isChecked) {\n         if (clickedIndex === 0 || selectedPeriods.value.includes(displayList.value[clickedIndex - 1].periode_tagihan)) {\n@@ -134,17 +155,17 @@\n             <ArrowPathIcon class=\"h-12 w-12 text-white animate-spin\" />\n             <p class=\"text-white mt-4 text-lg\">Mengarahkan ke halaman pembayaran...</p>\n         </div>\n \n-        <main class=\"w-full max-w-4xl mx-auto z-10 flex-grow flex flex-col justify-center\">\n-            <header class=\"text-center mb-8\">\n+        <main class=\"w-full max-w-4xl mx-auto z-10 flex-grow flex flex-col overflow-y-auto\">\n+            <header class=\"text-center mb-8 flex-shrink-0 pt-6\">\n                 <Link href=\"/\" class=\"inline-block\">\n                     <img v-if=\"appLogo\" :src=\"appLogo\" alt=\"App Logo\" class=\"h-12 w-auto mx-auto\">\n                     <ApplicationLogo v-else class=\"h-12 w-auto mx-auto text-white\" />\n                 </Link>\n             </header>\n \n-            <div class=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8\">\n+            <div class=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8 pb-32\">\n                 \n                 <!-- TAMPILAN 1: FORM PENCARIAN -->\n                 <div v-if=\"!foundSiswa && !selectedSiswa\">\n                      <h1 class=\"text-2xl font-bold text-center text-gray-800 dark:text-white\">{{ pageTitle }}</h1>\n@@ -193,11 +214,97 @@\n                 </div>\n \n                 <!-- TAMPILAN 3: HALAMAN TAGIHAN LENGKAP -->\n                 <div v-else-if=\"selectedSiswa\">\n-                    <!-- Seluruh kode dari halaman tagihan yang sudah ada bisa diletakkan di sini -->\n+                    <div class=\"flex flex-col sm:flex-row justify-between sm:items-center gap-4\">\n+                        <div>\n+                            <h3 class=\"text-xl font-bold text-gray-900 dark:text-white\">Tagihan untuk: {{ selectedSiswa.nama_siswa }}</h3>\n+                            <p class=\"text-sm text-gray-500 dark:text-gray-400\">NIS: {{ selectedSiswa.nis }}</p>\n+                        </div>\n+                        <Link :href=\"route('tagihan.spp.form')\" class=\"text-sm text-indigo-600 hover:text-indigo-500\">\n+                           &larr; Cari Siswa Lain\n+                        </Link>\n+                    </div>\n+                    \n+                    <div v-if=\"showSuccessCard\" class=\"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center\">\n+                        <CheckCircleIcon class=\"h-12 w-12 text-green-500 mx-auto\" />\n+                        <h4 class=\"mt-4 font-bold text-gray-800 dark:text-white\">Pendaftaran Akun Berhasil!</h4>\n+                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">{{ flashMessage }}</p>\n+                        <Link :href=\"route('login')\" class=\"mt-4 inline-block\">\n+                            <PrimaryButton>Masuk Sekarang</PrimaryButton>\n+                        </Link>\n+                    </div>\n+                    \n+                    <div v-if=\"!selectedSiswa.has_user_account && !showSuccessCard\" class=\"mt-8 p-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800/50 rounded-lg\">\n+                        <h4 class=\"font-bold text-gray-800 dark:text-white\">Lengkapi Akun Anda</h4>\n+                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Buat akun untuk login dan mempermudah pembayaran di kemudian hari.</p>\n+                        <form @submit.prevent=\"submitCreateUser\" class=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start\">\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.name\" placeholder=\"Nama Akun (misal: Budi Ayah Gilang)\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.name\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.email\" type=\"email\" placeholder=\"Email (untuk login)\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.email\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.password\" type=\"password\" placeholder=\"Password\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.password\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.password_confirmation\" type=\"password\" placeholder=\"Konfirmasi Password\" required class=\"w-full\" />\n+                            </div>\n+                            <PrimaryButton type=\"submit\" :disabled=\"createUserForm.processing\" class=\"md:col-span-2\">\n+                                {{ createUserForm.processing ? 'Menyimpan...' : 'Simpan & Buat Akun' }}\n+                            </PrimaryButton>\n+                        </form>\n+                    </div>\n+\n+                    <div class=\"mt-8\">\n+                        <div v-if=\"displayList.length > 0\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n+                            <div v-for=\"(item, index) in displayList\" :key=\"item.id\"\n+                                @click=\"!isItemDisabled(index) && updateSelection(item, !selectedPeriods.includes(item.periode_tagihan))\" \n+                                class=\"bg-white/50 dark:bg-gray-900/50 rounded-lg shadow-sm transition-all duration-200 p-4 flex items-center space-x-4\"\n+                                :class=\"{ \n+                                    'bg-slate-200 dark:bg-slate-700': selectedPeriods.includes(item.periode_tagihan),\n+                                    'cursor-pointer hover:shadow-md': !isItemDisabled(index),\n+                                    'opacity-50 cursor-not-allowed': isItemDisabled(index)\n+                                }\">\n+                                <Checkbox \n+                                    :checked=\"selectedPeriods.includes(item.periode_tagihan)\" \n+                                    @update:checked=\"updateSelection(item, $event)\"\n+                                    :disabled=\"isItemDisabled(index)\"\n+                                />\n+                                <div class=\"flex-1\">\n+                                    <p class=\"font-medium text-gray-900 dark:text-white\">{{ getShortDescription(item.description) }}</p>\n+                                    <p class=\"text-sm text-gray-500 dark:text-gray-400\">{{ item.total_amount_formatted }}</p>\n+                                </div>\n+                                <span class=\"px-2 py-0.5 text-xs font-semibold rounded-full\" :class=\"getStatusClass(item.status)\">\n+                                    {{ item.is_projected ? 'Proyeksi' : 'Tersedia' }}\n+                                </span>\n+                            </div>\n+                        </div>\n+                    </div>\n                 </div>\n \n             </div>\n+            <transition enter-active-class=\"transition ease-out duration-300\" enter-from-class=\"transform opacity-0 translate-y-full\" enter-to-class=\"transform opacity-100 translate-y-0\" leave-active-class=\"transition ease-in duration-200\" leave-from-class=\"transform opacity-100 translate-y-0\" leave-to-class=\"transform opacity-0 translate-y-full\">\n+                <div v-if=\"selectedSiswa && selectedPeriods.length > 0\" class=\"fixed bottom-0 left-0 right-0 w-full z-40\">\n+                    <div class=\"bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 shadow-2xl shadow-slate-400/20\">\n+                        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n+                            <div class=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n+                                <div>\n+                                    <h4 class=\"font-semibold text-gray-900 dark:text-white\">{{ selectedPeriods.length }} bulan tagihan dipilih</h4>\n+                                    <p class=\"text-lg font-bold text-red-600 dark:text-red-500\">{{ totalSelectedAmountFormatted }}</p>\n+                                </div>\n+                                <PrimaryButton @click=\"submitPayment\" :disabled=\"paymentForm.processing\" class=\"w-full sm:w-auto\">\n+                                    <CreditCardIcon class=\"h-5 w-5 mr-2\"/>\n+                                    {{ paymentForm.processing ? 'Memproses...' : 'Lanjutkan ke Pembayaran' }}\n+                                </PrimaryButton>\n+                            </div>\n+                        </div>\n+                    </div>\n+                </div>\n+            </transition>\n         </main>\n     </div>\n </template>\n"
                },
                {
                    "date": 1754380654069,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,11 +21,8 @@\n });\n \n const page = usePage();\n const appLogo = computed(() => page.props.app_settings?.app_logo ? `/storage/${page.props.app_settings.app_logo}` : null);\n-const flashMessage = computed(() => page.props.flash?.message);\n-const flashType = computed(() => page.props.flash?.type || 'info');\n-const showSuccessCard = computed(() => flashMessage.value && flashType.value === 'success');\n \n // --- State & Forms ---\n const isSearching = ref(false);\n const isRedirecting = ref(false);\n@@ -33,19 +30,12 @@\n const lookupForm = useForm({\n     nomor_telepon_wali: props.searchedPhone || '',\n });\n \n-const createUserForm = useForm({\n-    name: '',\n-    email: '',\n-    password: '',\n-    password_confirmation: '',\n-});\n-\n const selectedPeriods = ref([]);\n const paymentForm = useForm({ periods: [] });\n \n-// --- Logika Halaman Tagihan ---\n+// --- Logika Halaman Tagihan (jika selectedSiswa ada) ---\n const displayList = computed(() => {\n     if (!props.selectedSiswa) return [];\n     const existingInvoices = (props.sppInvoices || []).map(inv => ({ ...inv, is_projected: false }));\n     const projectedInvoices = [];\n@@ -98,19 +88,8 @@\n         onFinish: () => isSearching.value = false,\n     });\n };\n \n-const submitCreateUser = () => {\n-    createUserForm.post(route('tagihan.create_user'), {\n-        preserveScroll: true,\n-        onError: () => {\n-            if (!createUserForm.name) createUserForm.setError('name', 'Nama akun wajib diisi.');\n-            if (!createUserForm.email) createUserForm.setError('email', 'Email wajib diisi.');\n-            if (!createUserForm.password) createUserForm.setError('password', 'Password wajib diisi.');\n-        }\n-    });\n-};\n-\n const updateSelection = (item, isChecked) => {\n     const clickedIndex = displayList.value.findIndex(i => i.id === item.id);\n     if (isChecked) {\n         if (clickedIndex === 0 || selectedPeriods.value.includes(displayList.value[clickedIndex - 1].periode_tagihan)) {\n@@ -129,9 +108,9 @@\n \n const submitPayment = () => {\n     isRedirecting.value = true;\n     paymentForm.periods = selectedPeriods.value.sort();\n-    paymentForm.post(route('tagihan.check_pay')); \n+    paymentForm.post(route('tagihan.spp.pay', props.selectedSiswa.id_siswa)); \n };\n \n const getStatusClass = (status) => ({\n     'PENDING': 'bg-yellow-100 text-yellow-800',\n@@ -220,46 +199,12 @@\n                             <h3 class=\"text-xl font-bold text-gray-900 dark:text-white\">Tagihan untuk: {{ selectedSiswa.nama_siswa }}</h3>\n                             <p class=\"text-sm text-gray-500 dark:text-gray-400\">NIS: {{ selectedSiswa.nis }}</p>\n                         </div>\n                         <Link :href=\"route('tagihan.spp.form')\" class=\"text-sm text-indigo-600 hover:text-indigo-500\">\n-                           &larr; Cari Siswa Lain\n+                           &larr; Cari dengan Nomor Lain\n                         </Link>\n                     </div>\n                     \n-                    <div v-if=\"showSuccessCard\" class=\"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center\">\n-                        <CheckCircleIcon class=\"h-12 w-12 text-green-500 mx-auto\" />\n-                        <h4 class=\"mt-4 font-bold text-gray-800 dark:text-white\">Pendaftaran Akun Berhasil!</h4>\n-                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">{{ flashMessage }}</p>\n-                        <Link :href=\"route('login')\" class=\"mt-4 inline-block\">\n-                            <PrimaryButton>Masuk Sekarang</PrimaryButton>\n-                        </Link>\n-                    </div>\n-                    \n-                    <div v-if=\"!selectedSiswa.has_user_account && !showSuccessCard\" class=\"mt-8 p-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800/50 rounded-lg\">\n-                        <h4 class=\"font-bold text-gray-800 dark:text-white\">Lengkapi Akun Anda</h4>\n-                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Buat akun untuk login dan mempermudah pembayaran di kemudian hari.</p>\n-                        <form @submit.prevent=\"submitCreateUser\" class=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start\">\n-                            <div>\n-                                <TextInput v-model=\"createUserForm.name\" placeholder=\"Nama Akun (misal: Budi Ayah Gilang)\" required class=\"w-full\" />\n-                                <InputError :message=\"createUserForm.errors.name\" class=\"mt-1\" />\n-                            </div>\n-                            <div>\n-                                <TextInput v-model=\"createUserForm.email\" type=\"email\" placeholder=\"Email (untuk login)\" required class=\"w-full\" />\n-                                <InputError :message=\"createUserForm.errors.email\" class=\"mt-1\" />\n-                            </div>\n-                            <div>\n-                                <TextInput v-model=\"createUserForm.password\" type=\"password\" placeholder=\"Password\" required class=\"w-full\" />\n-                                <InputError :message=\"createUserForm.errors.password\" class=\"mt-1\" />\n-                            </div>\n-                            <div>\n-                                <TextInput v-model=\"createUserForm.password_confirmation\" type=\"password\" placeholder=\"Konfirmasi Password\" required class=\"w-full\" />\n-                            </div>\n-                            <PrimaryButton type=\"submit\" :disabled=\"createUserForm.processing\" class=\"md:col-span-2\">\n-                                {{ createUserForm.processing ? 'Menyimpan...' : 'Simpan & Buat Akun' }}\n-                            </PrimaryButton>\n-                        </form>\n-                    </div>\n-\n                     <div class=\"mt-8\">\n                         <div v-if=\"displayList.length > 0\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                             <div v-for=\"(item, index) in displayList\" :key=\"item.id\"\n                                 @click=\"!isItemDisabled(index) && updateSelection(item, !selectedPeriods.includes(item.periode_tagihan))\" \n"
                },
                {
                    "date": 1754386947150,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -202,9 +202,43 @@\n                         <Link :href=\"route('tagihan.spp.form')\" class=\"text-sm text-indigo-600 hover:text-indigo-500\">\n                            &larr; Cari dengan Nomor Lain\n                         </Link>\n                     </div>\n+\n+                    <div v-if=\"showSuccessCard\" class=\"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center\">\n+                        <CheckCircleIcon class=\"h-12 w-12 text-green-500 mx-auto\" />\n+                        <h4 class=\"mt-4 font-bold text-gray-800 dark:text-white\">Akun Berhasil Dibuat!</h4>\n+                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">{{ flashMessage }}</p>\n+                        <Link :href=\"route('login')\" class=\"mt-4 inline-block\">\n+                            <PrimaryButton>Masuk Sekarang</PrimaryButton>\n+                        </Link>\n+                    </div>\n                     \n+                    <div v-if=\"!selectedSiswa.has_user_account && !showSuccessCard\" class=\"mt-8 p-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800/50 rounded-lg\">\n+                        <h4 class=\"font-bold text-gray-800 dark:text-white\">Lengkapi Akun Anda</h4>\n+                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Buat akun untuk login dan mempermudah pembayaran di kemudian hari.</p>\n+                        <form @submit.prevent=\"submitCreateUser\" class=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start\">\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.name\" placeholder=\"Nama Akun (misal: Budi Ayah Gilang)\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.name\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.email\" type=\"email\" placeholder=\"Email (untuk login)\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.email\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.password\" type=\"password\" placeholder=\"Password\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.password\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.password_confirmation\" type=\"password\" placeholder=\"Konfirmasi Password\" required class=\"w-full\" />\n+                            </div>\n+                            <PrimaryButton type=\"submit\" :disabled=\"createUserForm.processing\" class=\"md:col-span-2\">\n+                                {{ createUserForm.processing ? 'Menyimpan...' : 'Simpan & Buat Akun' }}\n+                            </PrimaryButton>\n+                        </form>\n+                    </div>\n+                    \n                     <div class=\"mt-8\">\n                         <div v-if=\"displayList.length > 0\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                             <div v-for=\"(item, index) in displayList\" :key=\"item.id\"\n                                 @click=\"!isItemDisabled(index) && updateSelection(item, !selectedPeriods.includes(item.periode_tagihan))\" \n"
                },
                {
                    "date": 1754387097848,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,8 +21,11 @@\n });\n \n const page = usePage();\n const appLogo = computed(() => page.props.app_settings?.app_logo ? `/storage/${page.props.app_settings.app_logo}` : null);\n+const flashMessage = computed(() => page.props.flash?.message);\n+const flashType = computed(() => page.props.flash?.type || 'info');\n+const showSuccessCard = computed(() => flashMessage.value && flashType.value === 'success');\n \n // --- State & Forms ---\n const isSearching = ref(false);\n const isRedirecting = ref(false);\n@@ -30,12 +33,19 @@\n const lookupForm = useForm({\n     nomor_telepon_wali: props.searchedPhone || '',\n });\n \n+const createUserForm = useForm({\n+    name: '',\n+    email: '',\n+    password: '',\n+    password_confirmation: '',\n+});\n+\n const selectedPeriods = ref([]);\n const paymentForm = useForm({ periods: [] });\n \n-// --- Logika Halaman Tagihan (jika selectedSiswa ada) ---\n+// --- Logika Halaman Tagihan ---\n const displayList = computed(() => {\n     if (!props.selectedSiswa) return [];\n     const existingInvoices = (props.sppInvoices || []).map(inv => ({ ...inv, is_projected: false }));\n     const projectedInvoices = [];\n@@ -88,8 +98,19 @@\n         onFinish: () => isSearching.value = false,\n     });\n };\n \n+const submitCreateUser = () => {\n+    createUserForm.post(route('tagihan.spp.create_user', props.selectedSiswa.id_siswa), {\n+        preserveScroll: true,\n+        onError: () => {\n+            if (!createUserForm.name) createUserForm.setError('name', 'Nama akun wajib diisi.');\n+            if (!createUserForm.email) createUserForm.setError('email', 'Email wajib diisi.');\n+            if (!createUserForm.password) createUserForm.setError('password', 'Password wajib diisi.');\n+        }\n+    });\n+};\n+\n const updateSelection = (item, isChecked) => {\n     const clickedIndex = displayList.value.findIndex(i => i.id === item.id);\n     if (isChecked) {\n         if (clickedIndex === 0 || selectedPeriods.value.includes(displayList.value[clickedIndex - 1].periode_tagihan)) {\n@@ -202,9 +223,9 @@\n                         <Link :href=\"route('tagihan.spp.form')\" class=\"text-sm text-indigo-600 hover:text-indigo-500\">\n                            &larr; Cari dengan Nomor Lain\n                         </Link>\n                     </div>\n-\n+                    \n                     <div v-if=\"showSuccessCard\" class=\"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center\">\n                         <CheckCircleIcon class=\"h-12 w-12 text-green-500 mx-auto\" />\n                         <h4 class=\"mt-4 font-bold text-gray-800 dark:text-white\">Akun Berhasil Dibuat!</h4>\n                         <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">{{ flashMessage }}</p>\n@@ -236,9 +257,9 @@\n                                 {{ createUserForm.processing ? 'Menyimpan...' : 'Simpan & Buat Akun' }}\n                             </PrimaryButton>\n                         </form>\n                     </div>\n-                    \n+\n                     <div class=\"mt-8\">\n                         <div v-if=\"displayList.length > 0\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n                             <div v-for=\"(item, index) in displayList\" :key=\"item.id\"\n                                 @click=\"!isItemDisabled(index) && updateSelection(item, !selectedPeriods.includes(item.periode_tagihan))\" \n"
                },
                {
                    "date": 1754466904621,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,9 +43,9 @@\n \n const selectedPeriods = ref([]);\n const paymentForm = useForm({ periods: [] });\n \n-// --- Logika Halaman Tagihan ---\n+// --- Page Logic ---\n const displayList = computed(() => {\n     if (!props.selectedSiswa) return [];\n     const existingInvoices = (props.sppInvoices || []).map(inv => ({ ...inv, is_projected: false }));\n     const projectedInvoices = [];\n@@ -146,12 +146,14 @@\n \n <template>\n     <Head :title=\"pageTitle\" />\n     <div class=\"relative min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col items-center p-4 sm:p-6\">\n+        <!-- Background Image -->\n         <div class=\"fixed inset-0 z-0 bg-cover bg-center\" style=\"background-image: url('/images/bg_registration.webp');\">\n             <div class=\"absolute inset-0 bg-black/50\"></div>\n         </div>\n \n+        <!-- Redirecting Overlay -->\n         <div v-if=\"isRedirecting\" class=\"fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-50\">\n             <ArrowPathIcon class=\"h-12 w-12 text-white animate-spin\" />\n             <p class=\"text-white mt-4 text-lg\">Mengarahkan ke halaman pembayaran...</p>\n         </div>\n@@ -165,9 +167,9 @@\n             </header>\n \n             <div class=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8 pb-32\">\n                 \n-                <!-- TAMPILAN 1: FORM PENCARIAN -->\n+                <!-- VIEW 1: SEARCH FORM -->\n                 <div v-if=\"!foundSiswa && !selectedSiswa\">\n                      <h1 class=\"text-2xl font-bold text-center text-gray-800 dark:text-white\">{{ pageTitle }}</h1>\n                     <p class=\"mt-2 text-center text-gray-600 dark:text-gray-400\">Masukkan No. Telepon Wali yang terdaftar.</p>\n                     <form @submit.prevent=\"submitLookup\" class=\"mt-6 max-w-md mx-auto space-y-6 relative\">\n@@ -190,11 +192,26 @@\n                                 {{ lookupForm.processing ? 'Mencari...' : 'Cari Siswa' }}\n                             </PrimaryButton>\n                         </div>\n                     </form>\n+\n+                    <!-- Help Section -->\n+                    <div class=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto\">\n+                        <p>\n+                            Nomor Anda tidak terdaftar, padahal anak Anda sudah menjadi siswa aktif?\n+                            <br class=\"sm:hidden\" />\n+                            Silakan hubungi kami melalui\n+                            <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n+                                <span>WhatsApp</span>\n+                                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                    <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\n+                                </svg>\n+                            </a>.\n+                        </p>\n+                    </div>\n                 </div>\n \n-                <!-- TAMPILAN 2: DAFTAR PILIHAN SISWA -->\n+                <!-- VIEW 2: STUDENT SELECTION LIST -->\n                 <div v-else-if=\"foundSiswa\">\n                     <h3 class=\"text-xl font-bold text-gray-900 dark:text-white\">Pilih Siswa</h3>\n                     <p class=\"text-sm text-gray-500 dark:text-gray-400\">Ditemukan {{ foundSiswa.length }} siswa dengan nomor telepon yang sama.</p>\n                     <div class=\"mt-4 border-t border-gray-200 dark:border-gray-700\">\n@@ -212,9 +229,9 @@\n                         </ul>\n                     </div>\n                 </div>\n \n-                <!-- TAMPILAN 3: HALAMAN TAGIHAN LENGKAP -->\n+                <!-- VIEW 3: FULL BILLING PAGE -->\n                 <div v-else-if=\"selectedSiswa\">\n                     <div class=\"flex flex-col sm:flex-row justify-between sm:items-center gap-4\">\n                         <div>\n                             <h3 class=\"text-xl font-bold text-gray-900 dark:text-white\">Tagihan untuk: {{ selectedSiswa.nama_siswa }}</h3>\n@@ -286,8 +303,9 @@\n                     </div>\n                 </div>\n \n             </div>\n+            <!-- Floating Payment Bar -->\n             <transition enter-active-class=\"transition ease-out duration-300\" enter-from-class=\"transform opacity-0 translate-y-full\" enter-to-class=\"transform opacity-100 translate-y-0\" leave-active-class=\"transition ease-in duration-200\" leave-from-class=\"transform opacity-100 translate-y-0\" leave-to-class=\"transform opacity-0 translate-y-full\">\n                 <div v-if=\"selectedSiswa && selectedPeriods.length > 0\" class=\"fixed bottom-0 left-0 right-0 w-full z-40\">\n                     <div class=\"bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 shadow-2xl shadow-slate-400/20\">\n                         <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n"
                },
                {
                    "date": 1754467078572,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -227,8 +227,21 @@\n                                 <Link :href=\"route('tagihan.spp.show', siswa.id_siswa)\" class=\"rounded-md bg-white px-3 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-700 dark:text-white dark:ring-gray-600 dark:hover:bg-gray-600\">Pilih</Link>\n                             </li>\n                         </ul>\n                     </div>\n+                    <div class=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto\">\n+                        <p>\n+                            Nomor Anda tidak terdaftar, padahal anak Anda sudah menjadi siswa aktif?\n+                            <br class=\"sm:hidden\" />\n+                            Silakan hubungi kami melalui\n+                            <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n+                                <span>WhatsApp</span>\n+                                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                    <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\n+                                </svg>\n+                            </a>.\n+                        </p>\n+                    </div>\n                 </div>\n \n                 <!-- VIEW 3: FULL BILLING PAGE -->\n                 <div v-else-if=\"selectedSiswa\">\n"
                },
                {
                    "date": 1754467128616,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -229,9 +229,9 @@\n                         </ul>\n                     </div>\n                     <div class=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto\">\n                         <p>\n-                            Nomor Anda tidak terdaftar, padahal anak Anda sudah menjadi siswa aktif?\n+                            Nomor Anda terdaftar untuk siswa lain ?\n                             <br class=\"sm:hidden\" />\n                             Silakan hubungi kami melalui\n                             <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n                                 <span>WhatsApp</span>\n"
                },
                {
                    "date": 1754467173809,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -233,9 +233,9 @@\n                             Nomor Anda terdaftar untuk siswa lain ?\n                             <br class=\"sm:hidden\" />\n                             Silakan hubungi kami melalui\n                             <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n-                                <span>WhatsApp</span>\n+                                <span>WhatsApp</span> +62 811-386-846\n                                 <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n                                     <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\n                                 </svg>\n                             </a>.\n"
                },
                {
                    "date": 1754467186669,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -233,9 +233,9 @@\n                             Nomor Anda terdaftar untuk siswa lain ?\n                             <br class=\"sm:hidden\" />\n                             Silakan hubungi kami melalui\n                             <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n-                                <span>WhatsApp</span> +62 811-386-846\n+                                +62 811-386-846 <span>WhatsApp</span> \n                                 <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n                                     <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\n                                 </svg>\n                             </a>.\n"
                },
                {
                    "date": 1754467653007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,354 @@\n+<script setup>\n+import { Head, Link, useForm, usePage } from '@inertiajs/vue3';\n+import { computed, ref } from 'vue';\n+import ApplicationLogo from '@/Components/ApplicationLogo.vue';\n+import { CreditCardIcon, ArrowPathIcon, UserIcon, CheckCircleIcon } from '@heroicons/vue/24/outline';\n+import { XCircleIcon } from '@heroicons/vue/20/solid';\n+import PrimaryButton from '@/Components/PrimaryButton.vue';\n+import InputLabel from '@/Components/InputLabel.vue';\n+import TextInput from '@/Components/TextInput.vue';\n+import InputError from '@/Components/InputError.vue';\n+import Checkbox from '@/Components/Checkbox.vue';\n+\n+const props = defineProps({\n+    pageTitle: String,\n+    errors: Object,\n+    foundSiswa: Array,\n+    selectedSiswa: Object,\n+    sppInvoices: Array,\n+    lastPaidPeriod: String,\n+    searchedPhone: String,\n+});\n+\n+const page = usePage();\n+const appLogo = computed(() => page.props.app_settings?.app_logo ? `/storage/${page.props.app_settings.app_logo}` : null);\n+const flashMessage = computed(() => page.props.flash?.message);\n+const flashType = computed(() => page.props.flash?.type || 'info');\n+const showSuccessCard = computed(() => flashMessage.value && flashType.value === 'success');\n+\n+// --- State & Forms ---\n+const isSearching = ref(false);\n+const isRedirecting = ref(false);\n+\n+const lookupForm = useForm({\n+    nomor_telepon_wali: props.searchedPhone || '',\n+});\n+\n+const createUserForm = useForm({\n+    name: '',\n+    email: '',\n+    password: '',\n+    password_confirmation: '',\n+});\n+\n+const selectedPeriods = ref([]);\n+const paymentForm = useForm({ periods: [] });\n+\n+// --- Page Logic ---\n+const displayList = computed(() => {\n+    if (!props.selectedSiswa) return [];\n+    const existingInvoices = (props.sppInvoices || []).map(inv => ({ ...inv, is_projected: false }));\n+    const projectedInvoices = [];\n+    let startProjectionDate;\n+    if (existingInvoices.length > 0) {\n+        const lastPeriod = new Date(existingInvoices[existingInvoices.length - 1].periode_tagihan);\n+        startProjectionDate = new Date(Date.UTC(lastPeriod.getUTCFullYear(), lastPeriod.getUTCMonth() + 1, 1));\n+    } else if (props.lastPaidPeriod) {\n+        const lastPeriod = new Date(props.lastPaidPeriod);\n+        startProjectionDate = new Date(Date.UTC(lastPeriod.getUTCFullYear(), lastPeriod.getUTCMonth() + 1, 1));\n+    } else {\n+        const today = new Date();\n+        startProjectionDate = new Date(Date.UTC(today.getFullYear(), today.getMonth(), 1));\n+    }\n+    let currentPeriod = startProjectionDate;\n+    const endOfYear = new Date(Date.UTC(currentPeriod.getUTCFullYear(), 11, 31));\n+    while (currentPeriod <= endOfYear) {\n+        const year = currentPeriod.getUTCFullYear();\n+        const month = String(currentPeriod.getUTCMonth() + 1).padStart(2, '0');\n+        const day = '01';\n+        const periodString = `${year}-${month}-${day}`;\n+        const monthName = new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric', timeZone: 'UTC' }).format(currentPeriod);\n+        const totalAmount = (props.selectedSiswa.jumlah_spp_custom || 0);\n+        projectedInvoices.push({\n+            id: `proj-${periodString}`,\n+            description: `SPP Bulan ${monthName}`,\n+            total_amount: totalAmount,\n+            total_amount_formatted: new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(totalAmount),\n+            status: 'PROJECTED',\n+            periode_tagihan: periodString,\n+            is_projected: true,\n+        });\n+        currentPeriod.setUTCMonth(currentPeriod.getUTCMonth() + 1);\n+    }\n+    return [...existingInvoices, ...projectedInvoices];\n+});\n+\n+const totalSelectedAmount = computed(() => {\n+    if (selectedPeriods.value.length === 0) return 0;\n+    const totalSpp = displayList.value.filter(item => selectedPeriods.value.includes(item.periode_tagihan)).reduce((total, item) => total + item.total_amount, 0);\n+    const adminFee = props.selectedSiswa.admin_fee_custom || 0;\n+    return totalSpp + adminFee;\n+});\n+\n+const totalSelectedAmountFormatted = computed(() => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(totalSelectedAmount.value));\n+\n+const submitLookup = () => {\n+    isSearching.value = true;\n+    lookupForm.post(route('tagihan.spp.find'), {\n+        onFinish: () => isSearching.value = false,\n+    });\n+};\n+\n+const submitCreateUser = () => {\n+    createUserForm.post(route('tagihan.spp.create_user', props.selectedSiswa.id_siswa), {\n+        preserveScroll: true,\n+        onError: () => {\n+            if (!createUserForm.name) createUserForm.setError('name', 'Nama akun wajib diisi.');\n+            if (!createUserForm.email) createUserForm.setError('email', 'Email wajib diisi.');\n+            if (!createUserForm.password) createUserForm.setError('password', 'Password wajib diisi.');\n+        }\n+    });\n+};\n+\n+const updateSelection = (item, isChecked) => {\n+    const clickedIndex = displayList.value.findIndex(i => i.id === item.id);\n+    if (isChecked) {\n+        if (clickedIndex === 0 || selectedPeriods.value.includes(displayList.value[clickedIndex - 1].periode_tagihan)) {\n+            selectedPeriods.value.push(item.periode_tagihan);\n+        }\n+    } else {\n+        const periodsToRemove = displayList.value.slice(clickedIndex).map(i => i.periode_tagihan);\n+        selectedPeriods.value = selectedPeriods.value.filter(p => !periodsToRemove.includes(p));\n+    }\n+};\n+\n+const isItemDisabled = (index) => {\n+    if (index === 0) return false; \n+    return !selectedPeriods.value.includes(displayList.value[index - 1].periode_tagihan);\n+};\n+\n+const submitPayment = () => {\n+    isRedirecting.value = true;\n+    paymentForm.periods = selectedPeriods.value.sort();\n+    paymentForm.post(route('tagihan.spp.pay', props.selectedSiswa.id_siswa)); \n+};\n+\n+const getStatusClass = (status) => ({\n+    'PENDING': 'bg-yellow-100 text-yellow-800',\n+    'PROJECTED': 'bg-blue-100 text-blue-800',\n+}[status] || 'bg-gray-100 text-gray-800');\n+\n+const getShortDescription = (description) => {\n+    if (!description) return '';\n+    return description.split('-')[0].trim();\n+};\n+</script>\n+\n+<template>\n+    <Head :title=\"pageTitle\" />\n+    <div class=\"relative min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col items-center p-4 sm:p-6\">\n+        <!-- Background Image -->\n+        <div class=\"fixed inset-0 z-0 bg-cover bg-center\" style=\"background-image: url('/images/bg_registration.webp');\">\n+            <div class=\"absolute inset-0 bg-black/50\"></div>\n+        </div>\n+\n+        <!-- Redirecting Overlay -->\n+        <div v-if=\"isRedirecting\" class=\"fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-50\">\n+            <ArrowPathIcon class=\"h-12 w-12 text-white animate-spin\" />\n+            <p class=\"text-white mt-4 text-lg\">Mengarahkan ke halaman pembayaran...</p>\n+        </div>\n+\n+        <main class=\"w-full max-w-4xl mx-auto z-10 flex-grow flex flex-col overflow-y-auto\">\n+            <header class=\"text-center mb-8 flex-shrink-0 pt-6\">\n+                <Link href=\"/\" class=\"inline-block\">\n+                    <img v-if=\"appLogo\" :src=\"appLogo\" alt=\"App Logo\" class=\"h-12 w-auto mx-auto\">\n+                    <ApplicationLogo v-else class=\"h-12 w-auto mx-auto text-white\" />\n+                </Link>\n+            </header>\n+\n+            <div class=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8 pb-32\">\n+                \n+                <!-- VIEW 1: SEARCH FORM -->\n+                <div v-if=\"!foundSiswa && !selectedSiswa\">\n+                     <h1 class=\"text-2xl font-bold text-center text-gray-800 dark:text-white\">{{ pageTitle }}</h1>\n+                    <p class=\"mt-2 text-center text-gray-600 dark:text-gray-400\">Masukkan No. Telepon Wali yang terdaftar.</p>\n+                    <form @submit.prevent=\"submitLookup\" class=\"mt-6 max-w-md mx-auto space-y-6 relative\">\n+                        <div v-if=\"isSearching\" class=\"absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center rounded-md\">\n+                            <ArrowPathIcon class=\"h-8 w-8 text-gray-500 animate-spin\" />\n+                        </div>\n+                        <div v-if=\"errors.lookup\" class=\"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4\" role=\"alert\">\n+                            <div class=\"flex\">\n+                                <div class=\"flex-shrink-0\"><XCircleIcon class=\"h-5 w-5 text-red-400\" aria-hidden=\"true\" /></div>\n+                                <div class=\"ml-3\"><p class=\"text-sm font-medium text-red-800 dark:text-red-300\">{{ errors.lookup }}</p></div>\n+                            </div>\n+                        </div>\n+                        <div>\n+                            <InputLabel for=\"nomor_telepon_wali\" value=\"No. Telepon Wali\" />\n+                            <TextInput v-model=\"lookupForm.nomor_telepon_wali\" id=\"nomor_telepon_wali\" type=\"tel\" required class=\"mt-1 block w-full\" />\n+                            <InputError :message=\"lookupForm.errors.nomor_telepon_wali\" class=\"mt-2\" />\n+                        </div>\n+                        <div>\n+                            <PrimaryButton type=\"submit\" :disabled=\"lookupForm.processing\" class=\"w-full flex justify-center py-3\">\n+                                {{ lookupForm.processing ? 'Mencari...' : 'Cari Siswa' }}\n+                            </PrimaryButton>\n+                        </div>\n+                    </form>\n+\n+                    <!-- Help Section -->\n+                    <div class=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto\">\n+                        <p>\n+                            Nomor Anda tidak terdaftar, padahal anak Anda sudah menjadi siswa aktif?\n+                            <br class=\"sm:hidden\" />\n+                            Silakan hubungi kami melalui\n+                            <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n+                                <span>WhatsApp</span>\n+                                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                    <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\n+                                </svg>\n+                            </a>.\n+                        </p>\n+                    </div>\n+                </div>\n+\n+                <!-- VIEW 2: STUDENT SELECTION LIST -->\n+                <div v-else-if=\"foundSiswa\">\n+                    <h3 class=\"text-xl font-bold text-gray-900 dark:text-white\">Pilih Siswa</h3>\n+                    <p class=\"text-sm text-gray-500 dark:text-gray-400\">Ditemukan {{ foundSiswa.length }} siswa dengan nomor telepon yang sama.</p>\n+                    <div class=\"mt-4 border-t border-gray-200 dark:border-gray-700\">\n+                        <ul role=\"list\" class=\"divide-y divide-gray-200 dark:divide-gray-600\">\n+                            <li v-for=\"siswa in foundSiswa\" :key=\"siswa.id_siswa\" class=\"flex items-center justify-between gap-x-6 py-4\">\n+                                <div class=\"flex min-w-0 gap-x-4\">\n+                                    <UserIcon class=\"h-10 w-10 flex-none rounded-full bg-gray-200 dark:bg-gray-700 p-2 text-gray-500\" />\n+                                    <div class=\"min-w-0 flex-auto\">\n+                                        <p class=\"text-sm font-semibold leading-6 text-gray-900 dark:text-white\">{{ siswa.nama_siswa }}</p>\n+                                        <p class=\"mt-1 truncate text-xs leading-5 text-gray-500 dark:text-gray-400\">{{ siswa.kelas_nama }}</p>\n+                                    </div>\n+                                </div>\n+                                <Link :href=\"route('tagihan.spp.show', siswa.id_siswa)\" class=\"rounded-md bg-white px-3 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-700 dark:text-white dark:ring-gray-600 dark:hover:bg-gray-600\">Pilih</Link>\n+                            </li>\n+                        </ul>\n+                    </div>\n+                    <div class=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto\">\n+                        <p>\n+                            Nomor Anda terdaftar untuk siswa lain ?\n+                            <br class=\"sm:hidden\" />\n+                            Silakan hubungi kami melalui\n+                            <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n+                                +62 811-386-846 <span>WhatsApp</span> \n+                                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                    <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\n+                                </svg>\n+                            </a>.\n+                        </p>\n+                    </div>\n+                </div>\n+\n+                <!-- VIEW 3: FULL BILLING PAGE -->\n+                <div v-else-if=\"selectedSiswa\">\n+                    <div class=\"flex flex-col sm:flex-row justify-between sm:items-center gap-4\">\n+                        <div>\n+                            <h3 class=\"text-xl font-bold text-gray-900 dark:text-white\">Tagihan untuk: {{ selectedSiswa.nama_siswa }}</h3>\n+                            <p class=\"text-sm text-gray-500 dark:text-gray-400\">NIS: {{ selectedSiswa.nis }}</p>\n+                        </div>\n+                        <Link :href=\"route('tagihan.spp.form')\" class=\"text-sm text-indigo-600 hover:text-indigo-500\">\n+                           &larr; Cari dengan Nomor Lain\n+                        </Link>\n+                    </div>\n+                    \n+                    <div v-if=\"showSuccessCard\" class=\"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center\">\n+                        <CheckCircleIcon class=\"h-12 w-12 text-green-500 mx-auto\" />\n+                        <h4 class=\"mt-4 font-bold text-gray-800 dark:text-white\">Akun Berhasil Dibuat!</h4>\n+                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">{{ flashMessage }}</p>\n+                        <Link :href=\"route('login')\" class=\"mt-4 inline-block\">\n+                            <PrimaryButton>Masuk Sekarang</PrimaryButton>\n+                        </Link>\n+                    </div>\n+                    \n+                    <div v-if=\"!selectedSiswa.has_user_account && !showSuccessCard\" class=\"mt-8 p-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800/50 rounded-lg\">\n+                        <h4 class=\"font-bold text-gray-800 dark:text-white\">Lengkapi Akun Anda</h4>\n+                        <p class=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">Buat akun untuk login dan mempermudah pembayaran di kemudian hari.</p>\n+                        <form @submit.prevent=\"submitCreateUser\" class=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start\">\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.name\" placeholder=\"Nama Akun (misal: Budi Ayah Gilang)\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.name\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.email\" type=\"email\" placeholder=\"Email (untuk login)\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.email\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.password\" type=\"password\" placeholder=\"Password\" required class=\"w-full\" />\n+                                <InputError :message=\"createUserForm.errors.password\" class=\"mt-1\" />\n+                            </div>\n+                            <div>\n+                                <TextInput v-model=\"createUserForm.password_confirmation\" type=\"password\" placeholder=\"Konfirmasi Password\" required class=\"w-full\" />\n+                            </div>\n+                            <PrimaryButton type=\"submit\" :disabled=\"createUserForm.processing\" class=\"md:col-span-2\">\n+                                {{ createUserForm.processing ? 'Menyimpan...' : 'Simpan & Buat Akun' }}\n+                            </PrimaryButton>\n+                        </form>\n+                    </div>\n+\n+                    <div class=\"mt-8\">\n+                        <div v-if=\"displayList.length > 0\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3\">\n+                            <div v-for=\"(item, index) in displayList\" :key=\"item.id\"\n+                                @click=\"!isItemDisabled(index) && updateSelection(item, !selectedPeriods.includes(item.periode_tagihan))\" \n+                                class=\"bg-white/50 dark:bg-gray-900/50 rounded-lg shadow-sm transition-all duration-200 p-4 flex items-center space-x-4\"\n+                                :class=\"{ \n+                                    'bg-slate-200 dark:bg-slate-700': selectedPeriods.includes(item.periode_tagihan),\n+                                    'cursor-pointer hover:shadow-md': !isItemDisabled(index),\n+                                    'opacity-50 cursor-not-allowed': isItemDisabled(index)\n+                                }\">\n+                                <Checkbox \n+                                    :checked=\"selectedPeriods.includes(item.periode_tagihan)\" \n+                                    @update:checked=\"updateSelection(item, $event)\"\n+                                    :disabled=\"isItemDisabled(index)\"\n+                                />\n+                                <div class=\"flex-1\">\n+                                    <p class=\"font-medium text-gray-900 dark:text-white\">{{ getShortDescription(item.description) }}</p>\n+                                    <p class=\"text-sm text-gray-500 dark:text-gray-400\">{{ item.total_amount_formatted }}</p>\n+                                </div>\n+                                <span class=\"px-2 py-0.5 text-xs font-semibold rounded-full\" :class=\"getStatusClass(item.status)\">\n+                                    {{ item.is_projected ? 'Proyeksi' : 'Tersedia' }}\n+                                </span>\n+                            </div>\n+                        </div>\n+                    </div>\n+                    <div class=\"mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto\">\n+                        <p>\n+                            Ada tagihan yang tidak sesuai ?\n+                            <br class=\"sm:hidden\" />\n+                            Silakan hubungi kami melalui\n+                            <a href=\"https://wa.me/62811386846\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400\">\n+                                +62 811-386-846 <span>WhatsApp</span> \n+                                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" viewBox=\"0 0 16 16\" fill=\"currentColor\">\n+                                    <path d=\"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z\"/>\n+                                </svg>\n+                            </a>.\n+                        </p>\n+                    </div>\n+                </div>\n+\n+            </div>\n+            <!-- Floating Payment Bar -->\n+            <transition enter-active-class=\"transition ease-out duration-300\" enter-from-class=\"transform opacity-0 translate-y-full\" enter-to-class=\"transform opacity-100 translate-y-0\" leave-active-class=\"transition ease-in duration-200\" leave-from-class=\"transform opacity-100 translate-y-0\" leave-to-class=\"transform opacity-0 translate-y-full\">\n+                <div v-if=\"selectedSiswa && selectedPeriods.length > 0\" class=\"fixed bottom-0 left-0 right-0 w-full z-40\">\n+                    <div class=\"bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 shadow-2xl shadow-slate-400/20\">\n+                        <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4\">\n+                            <div class=\"flex flex-col sm:flex-row items-center justify-between gap-4\">\n+                                <div>\n+                                    <h4 class=\"font-semibold text-gray-900 dark:text-white\">{{ selectedPeriods.length }} bulan tagihan dipilih</h4>\n+                                    <p class=\"text-lg font-bold text-red-600 dark:text-red-500\">{{ totalSelectedAmountFormatted }}</p>\n+                                </div>\n+                                <PrimaryButton @click=\"submitPayment\" :disabled=\"paymentForm.processing\" class=\"w-full sm:w-auto\">\n+                                    <CreditCardIcon class=\"h-5 w-5 mr-2\"/>\n+                                    {{ paymentForm.processing ? 'Memproses...' : 'Lanjutkan ke Pembayaran' }}\n+                                </PrimaryButton>\n+                            </div>\n+                        </div>\n+                    </div>\n+                </div>\n+            </transition>\n+        </main>\n+    </div>\n+</template>\n"
                }
            ],
            "date": 1754378698573,
            "name": "Commit-0",
            "content": "<script setup>\nimport { Head, Link, useForm, usePage } from '@inertiajs/vue3';\nimport { computed, ref } from 'vue';\nimport ApplicationLogo from '@/Components/ApplicationLogo.vue';\nimport { CreditCardIcon, ArrowPathIcon, UserIcon } from '@heroicons/vue/24/outline';\nimport { XCircleIcon } from '@heroicons/vue/20/solid';\nimport PrimaryButton from '@/Components/PrimaryButton.vue';\nimport InputLabel from '@/Components/InputLabel.vue';\nimport TextInput from '@/Components/TextInput.vue';\nimport InputError from '@/Components/InputError.vue';\nimport Checkbox from '@/Components/Checkbox.vue';\n\nconst props = defineProps({\n    pageTitle: String,\n    errors: Object,\n    foundSiswa: Array, // Daftar siswa yang ditemukan\n    selectedSiswa: Object, // Siswa yang sudah dipilih\n    sppInvoices: Array,\n    lastPaidPeriod: String,\n    searchedPhone: String, // Untuk mengisi kembali form\n});\n\nconst page = usePage();\nconst appLogo = computed(() => page.props.app_settings?.app_logo ? `/storage/${page.props.app_settings.app_logo}` : null);\n\n// --- State & Forms ---\nconst isSearching = ref(false);\nconst isRedirecting = ref(false);\n\nconst lookupForm = useForm({\n    nomor_telepon_wali: props.searchedPhone || '',\n});\n\nconst selectedPeriods = ref([]);\nconst paymentForm = useForm({ periods: [] });\n\n// --- Logika Halaman Tagihan (jika selectedSiswa ada) ---\nconst displayList = computed(() => {\n    if (!props.selectedSiswa) return [];\n    const existingInvoices = (props.sppInvoices || []).map(inv => ({ ...inv, is_projected: false }));\n    const projectedInvoices = [];\n    let startProjectionDate;\n    if (existingInvoices.length > 0) {\n        const lastPeriod = new Date(existingInvoices[existingInvoices.length - 1].periode_tagihan);\n        startProjectionDate = new Date(Date.UTC(lastPeriod.getUTCFullYear(), lastPeriod.getUTCMonth() + 1, 1));\n    } else if (props.lastPaidPeriod) {\n        const lastPeriod = new Date(props.lastPaidPeriod);\n        startProjectionDate = new Date(Date.UTC(lastPeriod.getUTCFullYear(), lastPeriod.getUTCMonth() + 1, 1));\n    } else {\n        const today = new Date();\n        startProjectionDate = new Date(Date.UTC(today.getFullYear(), today.getMonth(), 1));\n    }\n    let currentPeriod = startProjectionDate;\n    const endOfYear = new Date(Date.UTC(currentPeriod.getUTCFullYear(), 11, 31));\n    while (currentPeriod <= endOfYear) {\n        const year = currentPeriod.getUTCFullYear();\n        const month = String(currentPeriod.getUTCMonth() + 1).padStart(2, '0');\n        const day = '01';\n        const periodString = `${year}-${month}-${day}`;\n        const monthName = new Intl.DateTimeFormat('id-ID', { month: 'long', year: 'numeric', timeZone: 'UTC' }).format(currentPeriod);\n        const totalAmount = (props.selectedSiswa.jumlah_spp_custom || 0);\n        projectedInvoices.push({\n            id: `proj-${periodString}`,\n            description: `SPP Bulan ${monthName}`,\n            total_amount: totalAmount,\n            total_amount_formatted: new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(totalAmount),\n            status: 'PROJECTED',\n            periode_tagihan: periodString,\n            is_projected: true,\n        });\n        currentPeriod.setUTCMonth(currentPeriod.getUTCMonth() + 1);\n    }\n    return [...existingInvoices, ...projectedInvoices];\n});\n\nconst totalSelectedAmount = computed(() => {\n    if (selectedPeriods.value.length === 0) return 0;\n    const totalSpp = displayList.value.filter(item => selectedPeriods.value.includes(item.periode_tagihan)).reduce((total, item) => total + item.total_amount, 0);\n    const adminFee = props.selectedSiswa.admin_fee_custom || 0;\n    return totalSpp + adminFee;\n});\n\nconst totalSelectedAmountFormatted = computed(() => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(totalSelectedAmount.value));\n\nconst submitLookup = () => {\n    isSearching.value = true;\n    lookupForm.post(route('tagihan.spp.find'), {\n        onFinish: () => isSearching.value = false,\n    });\n};\n\nconst updateSelection = (item, isChecked) => {\n    const clickedIndex = displayList.value.findIndex(i => i.id === item.id);\n    if (isChecked) {\n        if (clickedIndex === 0 || selectedPeriods.value.includes(displayList.value[clickedIndex - 1].periode_tagihan)) {\n            selectedPeriods.value.push(item.periode_tagihan);\n        }\n    } else {\n        const periodsToRemove = displayList.value.slice(clickedIndex).map(i => i.periode_tagihan);\n        selectedPeriods.value = selectedPeriods.value.filter(p => !periodsToRemove.includes(p));\n    }\n};\n\nconst isItemDisabled = (index) => {\n    if (index === 0) return false; \n    return !selectedPeriods.value.includes(displayList.value[index - 1].periode_tagihan);\n};\n\nconst submitPayment = () => {\n    isRedirecting.value = true;\n    paymentForm.periods = selectedPeriods.value.sort();\n    paymentForm.post(route('tagihan.check_pay')); \n};\n\nconst getStatusClass = (status) => ({\n    'PENDING': 'bg-yellow-100 text-yellow-800',\n    'PROJECTED': 'bg-blue-100 text-blue-800',\n}[status] || 'bg-gray-100 text-gray-800');\n\nconst getShortDescription = (description) => {\n    if (!description) return '';\n    return description.split('-')[0].trim();\n};\n</script>\n\n<template>\n    <Head :title=\"pageTitle\" />\n    <div class=\"relative min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col items-center p-4 sm:p-6\">\n        <div class=\"fixed inset-0 z-0 bg-cover bg-center\" style=\"background-image: url('/images/bg_registration.webp');\">\n            <div class=\"absolute inset-0 bg-black/50\"></div>\n        </div>\n\n        <div v-if=\"isRedirecting\" class=\"fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-50\">\n            <ArrowPathIcon class=\"h-12 w-12 text-white animate-spin\" />\n            <p class=\"text-white mt-4 text-lg\">Mengarahkan ke halaman pembayaran...</p>\n        </div>\n\n        <main class=\"w-full max-w-4xl mx-auto z-10 flex-grow flex flex-col justify-center\">\n            <header class=\"text-center mb-8\">\n                <Link href=\"/\" class=\"inline-block\">\n                    <img v-if=\"appLogo\" :src=\"appLogo\" alt=\"App Logo\" class=\"h-12 w-auto mx-auto\">\n                    <ApplicationLogo v-else class=\"h-12 w-auto mx-auto text-white\" />\n                </Link>\n            </header>\n\n            <div class=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8\">\n                \n                <!-- TAMPILAN 1: FORM PENCARIAN -->\n                <div v-if=\"!foundSiswa && !selectedSiswa\">\n                     <h1 class=\"text-2xl font-bold text-center text-gray-800 dark:text-white\">{{ pageTitle }}</h1>\n                    <p class=\"mt-2 text-center text-gray-600 dark:text-gray-400\">Masukkan No. Telepon Wali yang terdaftar.</p>\n                    <form @submit.prevent=\"submitLookup\" class=\"mt-6 max-w-md mx-auto space-y-6 relative\">\n                        <div v-if=\"isSearching\" class=\"absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center rounded-md\">\n                            <ArrowPathIcon class=\"h-8 w-8 text-gray-500 animate-spin\" />\n                        </div>\n                        <div v-if=\"errors.lookup\" class=\"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4\" role=\"alert\">\n                            <div class=\"flex\">\n                                <div class=\"flex-shrink-0\"><XCircleIcon class=\"h-5 w-5 text-red-400\" aria-hidden=\"true\" /></div>\n                                <div class=\"ml-3\"><p class=\"text-sm font-medium text-red-800 dark:text-red-300\">{{ errors.lookup }}</p></div>\n                            </div>\n                        </div>\n                        <div>\n                            <InputLabel for=\"nomor_telepon_wali\" value=\"No. Telepon Wali\" />\n                            <TextInput v-model=\"lookupForm.nomor_telepon_wali\" id=\"nomor_telepon_wali\" type=\"tel\" required class=\"mt-1 block w-full\" />\n                            <InputError :message=\"lookupForm.errors.nomor_telepon_wali\" class=\"mt-2\" />\n                        </div>\n                        <div>\n                            <PrimaryButton type=\"submit\" :disabled=\"lookupForm.processing\" class=\"w-full flex justify-center py-3\">\n                                {{ lookupForm.processing ? 'Mencari...' : 'Cari Siswa' }}\n                            </PrimaryButton>\n                        </div>\n                    </form>\n                </div>\n\n                <!-- TAMPILAN 2: DAFTAR PILIHAN SISWA -->\n                <div v-else-if=\"foundSiswa\">\n                    <h3 class=\"text-xl font-bold text-gray-900 dark:text-white\">Pilih Siswa</h3>\n                    <p class=\"text-sm text-gray-500 dark:text-gray-400\">Ditemukan {{ foundSiswa.length }} siswa dengan nomor telepon yang sama.</p>\n                    <div class=\"mt-4 border-t border-gray-200 dark:border-gray-700\">\n                        <ul role=\"list\" class=\"divide-y divide-gray-200 dark:divide-gray-600\">\n                            <li v-for=\"siswa in foundSiswa\" :key=\"siswa.id_siswa\" class=\"flex items-center justify-between gap-x-6 py-4\">\n                                <div class=\"flex min-w-0 gap-x-4\">\n                                    <UserIcon class=\"h-10 w-10 flex-none rounded-full bg-gray-200 dark:bg-gray-700 p-2 text-gray-500\" />\n                                    <div class=\"min-w-0 flex-auto\">\n                                        <p class=\"text-sm font-semibold leading-6 text-gray-900 dark:text-white\">{{ siswa.nama_siswa }}</p>\n                                        <p class=\"mt-1 truncate text-xs leading-5 text-gray-500 dark:text-gray-400\">{{ siswa.kelas_nama }}</p>\n                                    </div>\n                                </div>\n                                <Link :href=\"route('tagihan.spp.show', siswa.id_siswa)\" class=\"rounded-md bg-white px-3 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-700 dark:text-white dark:ring-gray-600 dark:hover:bg-gray-600\">Pilih</Link>\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n\n                <!-- TAMPILAN 3: HALAMAN TAGIHAN LENGKAP -->\n                <div v-else-if=\"selectedSiswa\">\n                    <!-- Seluruh kode dari halaman tagihan yang sudah ada bisa diletakkan di sini -->\n                </div>\n\n            </div>\n        </main>\n    </div>\n</template>\n"
        }
    ]
}