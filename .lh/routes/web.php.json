{
    "sourceFile": "routes/web.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 18,
            "patches": [
                {
                    "date": 1754202041374,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1754202127821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,152 +1,200 @@\n <?php\n \n+use App\\Http\\Controllers\\ProfileController;\n+use Illuminate\\Foundation\\Application;\n use Illuminate\\Support\\Facades\\Route;\n+use Illuminate\\Http\\Request;\n use Inertia\\Inertia;\n+use App\\Models\\Kelas;\n \n-// --- Import semua controller di satu tempat ---\n-use App\\Http\\Controllers\\Admin\\ActivityLogController;\n use App\\Http\\Controllers\\Admin\\Auth\\AuthenticatedSessionController as AdminAuthenticatedSessionController;\n-use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n-use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n+use App\\Http\\Controllers\\WebhookController;\n+use App\\Http\\Controllers\\CekTagihanController;\n+use App\\Http\\Controllers\\Public\\CheckTagihanController;\n+use App\\Http\\Controllers\\PaymentController;\n+use App\\Http\\Controllers\\RegistrationController;\n+use App\\Http\\Controllers\\DisplayController;\n use App\\Http\\Controllers\\Admin\\DashboardController;\n+use App\\Http\\Controllers\\Admin\\RoleController;\n+use App\\Http\\Controllers\\Admin\\PermissionController;\n+use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\Admin\\KelasController;\n+use App\\Http\\Controllers\\Admin\\SiswaController;\n use App\\Http\\Controllers\\Admin\\InvoiceController;\n-use App\\Http\\Controllers\\Admin\\JobBatchController;\n-use App\\Http\\Controllers\\Admin\\KelasController;\n+use App\\Http\\Controllers\\Admin\\LaporanController;\n+use App\\Http\\Controllers\\Admin\\SettingsController;\n+use App\\Http\\Controllers\\Admin\\ActivityLogController;\n+use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n+use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n use App\\Http\\Controllers\\Admin\\LegalDocumentController;\n-use App\\Http\\Controllers\\Admin\\LaporanController;\n-use App\\Http\\Controllers\\Admin\\PermissionController;\n use App\\Http\\Controllers\\Admin\\PromoController;\n-use App\\Http\\Controllers\\Admin\\RoleController;\n-use App\\Http\\Controllers\\Admin\\SettingsController;\n-use App\\Http\\Controllers\\Admin\\SiswaController;\n-use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\ReRegistrationController;\n+use App\\Http\\Controllers\\RegistrationSuccessController;\n use App\\Http\\Controllers\\LegalController;\n-use App\\Http\\Controllers\\PaymentController;\n-use App\\Http\\Controllers\\ProfileController;\n-use App\\Http\\Controllers\\Public\\CheckTagihanController;\n-use App\\Http\\Controllers\\RegistrationController;\n-use App\\Http\\Controllers\\RegistrationSuccessController;\n-use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n+\n use App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\n use App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\n-use App\\Http\\Controllers\\WebhookController;\n+use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n \n-/*\n-|--------------------------------------------------------------------------\n-| Web Routes\n-|--------------------------------------------------------------------------\n-*/\n-\n-// --- Rute Publik Statis (Tidak Perlu Session) ---\n-Route::get('/', function () {\n+Route::get('/', function (Request $request) {\n     return Inertia::render('Welcome', [\n         'canLogin' => Route::has('login'),\n         'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip(),\n+        // 'laravelVersion' => Application::VERSION,\n+        // 'phpVersion' => PHP_VERSION,\n+        'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n+            return [\n+                'nama_kelas' => $kelas->nama_kelas,\n+                'deskripsi' => Str::limit($kelas->deskripsi, 50),\n+                // Tambahkan path gambar jika Anda punya, jika tidak kita gunakan placeholder\n+                'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n+            ];\n+        }),\n     ]);\n-})->name('welcome');\n-\n-// --- Rute Webhook (Stateless) ---\n-// Webhook dari Xendit tidak memerlukan session atau CSRF, jadi diletakkan di luar grup 'web'.\n+})->name('welcome'); \n+Route::get('/soccer-school', function (Request $request) {\n+    return Inertia::render('Soccerschool', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('soccer-school');\n+Route::get('/academy', function (Request $request) {\n+    return Inertia::render('Academy', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('academy');\n+Route::get('/persija-dna', function (Request $request) {\n+    return Inertia::render('Persijadna', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('persija-dna');\n+Route::get('/kontak', function (Request $request) {\n+    return Inertia::render('Kontak', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('kontak'); \n+// Route::get('/cek-tagihan', [CekTagihanController::class, 'showForm'])->name('tagihan.check_form');\n+// Route::post('/cek-tagihan', [CekTagihanController::class, 'checkStatus'])->name('tagihan.check_status');\n+Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n+Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n+Route::get('/pendaftaran', [RegistrationController::class, 'create'])->name('pendaftaran.create');\n+Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n+Route::get('/syarat-ketentuan', [LegalController::class, 'terms'])->name('legal.terms');\n+Route::get('/kebijakan-privasi', [LegalController::class, 'privacy'])->name('legal.privacy');\n+Route::get('/ketentuan-pengembalian', [LegalController::class, 'refund'])->name('legal.refund');\n+Route::get('/daftar-ulang', [ReRegistrationController::class, 'create'])->name('re-register.create');\n+Route::get('/daftar-ulang-academy', [ReRegistrationController::class, 'createAcademy'])->name('re-register-academy.create');\n+// Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n+Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n+Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n+Route::get('/dashboard', function () {\n+    if (auth()->check() && auth()->user()->hasRole('siswa')) {\n+        return redirect()->route('siswa.dashboard');\n+    }\n+    // Jika admin atau role lain, redirect ke dashboard admin\n+    if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user'])) {\n+        return redirect()->route('admin.dashboard');\n+    }\n+    // Fallback jika tidak ada role yang cocok (seharusnya tidak terjadi jika setup benar)\n+    return Inertia::render('Welcome');\n+})->middleware(['auth', 'verified'])->name('dashboard');\n \n-// --- RUTE YANG MEMERLUKAN SESSION (MIDDLEWARE 'WEB') ---\n Route::middleware('web')->group(function () {\n+    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n+    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n+    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n+    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+});\n \n-    // --- Rute Pendaftaran & Pembayaran Publik ---\n-    Route::controller(RegistrationController::class)->group(function () {\n-        Route::get('/daftar-academy', 'createAcademy')->name('register-academy.create');\n-        Route::get('/daftar-ss', 'createSs')->name('register-ss.create');\n-        Route::post('/pendaftaran', 'store')->name('pendaftaran.store');\n-        Route::post('/promo/validate', 'validatePromoCode')->name('promo.validate');\n-    });\n+Route::middleware('auth')->group(function () {\n+    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n+    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n+    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n+});\n \n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-    Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n-    Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n+Route::prefix('admin')->name('admin.')->group(function () {\n+    Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])\n+                ->middleware('guest') // Hanya bisa diakses oleh guest (belum login)\n+                ->name('login');\n \n-    // --- Rute Cek Tagihan Publik ---\n-    Route::controller(CheckTagihanController::class)->group(function () {\n-        Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n-        Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n-        Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n-        Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n-        Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay');\n-    });\n+    Route::post('login', [AdminAuthenticatedSessionController::class, 'store'])\n+                ->middleware('guest');\n+    \n+    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])\n+                ->middleware('guest')\n+                ->name('password.request');\n \n-    // --- Rute Halaman Legal ---\n-    Route::controller(LegalController::class)->group(function () {\n-        Route::get('/syarat-ketentuan', 'terms')->name('legal.terms');\n-        Route::get('/kebijakan-privasi', 'privacy')->name('legal.privacy');\n-        Route::get('/ketentuan-pengembalian', 'refund')->name('legal.refund');\n-    });\n+    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])\n+                ->middleware('guest')\n+                ->name('password.email');\n \n-    // --- Rute Otentikasi Bawaan Laravel ---\n-    Route::get('/dashboard', function () {\n-        if (auth()->check() && auth()->user()->hasRole('siswa')) {\n-            return redirect()->route('siswa.dashboard');\n-        }\n-        if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user', 'super_admin', 'admin_kelas'])) {\n-            return redirect()->route('admin.dashboard');\n-        }\n-        return redirect()->route('welcome');\n-    })->middleware(['auth', 'verified'])->name('dashboard');\n+    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])\n+                ->middleware('guest')\n+                ->name('password.reset');\n \n-    Route::middleware('auth')->group(function () {\n-        Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n-        Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n-        Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n-    });\n+    Route::post('reset-password', [NewPasswordController::class, 'store'])\n+                ->middleware('guest')\n+                ->name('password.store');\n \n-    require __DIR__.'/auth.php';\n+    Route::middleware(['auth', 'verified'])->group(function () {\n+        \n+        Route::middleware(['role:admin'])->group(function () {\n+            Route::resource('roles', RoleController::class);\n+            Route::resource('permissions', PermissionController::class);\n+            Route::resource('users', UserController::class);\n+            Route::resource('legal-documents', LegalDocumentController::class);\n+            Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n+            Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n+            Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n+        });\n \n-    // --- Rute Area Admin ---\n-    Route::prefix('admin')->name('admin.')->group(function () {\n-        // Rute login & reset password admin (hanya untuk guest)\n-        Route::middleware('guest')->group(function () {\n-            Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])->name('login');\n-            Route::post('login', [AdminAuthenticatedSessionController::class, 'store']);\n-            Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])->name('password.request');\n-            Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])->name('password.email');\n-            Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])->name('password.reset');\n-            Route::post('reset-password', [NewPasswordController::class, 'store'])->name('password.store');\n+        Route::middleware(['role:admin|user|admin_kelas'])->group(function() {\n+            Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n+            Route::resource('kelas', KelasController::class);\n+            Route::get('siswa/export', [SiswaController::class, 'export'])->name('siswa.export');\n+            Route::post('siswa/import', [SiswaController::class, 'import'])->name('siswa.import');\n+            Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n+            Route::resource('siswa', SiswaController::class);\n+            Route::resource('invoices', InvoiceController::class);\n+            Route::resource('promos', PromoController::class)->except(['show']);\n+            Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n+            Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n+            Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n+            Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n+            Route::get('jobs', [\\App\\Http\\Controllers\\Admin\\JobBatchController::class, 'index'])->name('jobs.index');\n         });\n \n-        // Rute yang memerlukan login admin\n-        Route::middleware(['auth', 'verified'])->group(function () {\n-            // Rute khusus untuk Super Admin & Admin\n-            Route::middleware(['role:super_admin|admin'])->group(function () {\n-                Route::resource('roles', RoleController::class);\n-                Route::resource('permissions', PermissionController::class);\n-                Route::resource('users', UserController::class);\n-                Route::resource('legal-documents', LegalDocumentController::class);\n-                Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n-                Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n-                Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n-            });\n-\n-            // Rute untuk semua jenis admin (termasuk admin kelas)\n-            Route::middleware(['role:super_admin|admin|admin_kelas'])->group(function() {\n-                Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n-                Route::resource('kelas', KelasController::class);\n-                Route::resource('siswa', SiswaController::class);\n-                Route::resource('invoices', InvoiceController::class);\n-                Route::resource('promos', PromoController::class)->except(['show']);\n-                Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n-                Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n-                Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n-                Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n-                Route::get('jobs', [JobBatchController::class, 'index'])->name('jobs.index');\n-            });\n-        });\n     });\n+});\n \n-    // --- Rute Area Siswa ---\n-    Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')->name('siswa.')->group(function () {\n+Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')\n+    ->name('siswa.')->group(function () {\n         Route::get('/dashboard', [SiswaDashboardController::class, 'index'])->name('dashboard');\n+        Route::put('/profil/update-info', [SiswaProfileController::class, 'updateInformation'])->name('profil.update_info');\n+        Route::put('/profil/update-password', [SiswaProfileController::class, 'updatePassword'])->name('profil.update_password');\n         Route::get('/profil', [SiswaProfileController::class, 'show'])->name('profil.show');\n         Route::get('/tagihan', [SiswaTagihanController::class, 'index'])->name('tagihan.index');\n+        Route::post('/invoices/{invoice}/pay', [SiswaTagihanController::class, 'createPaymentToken'])->name('tagihan.pay');\n+        Route::post('/invoices/bulk-pay', [SiswaTagihanController::class, 'createBulkPayment'])->name('invoices.bulk_pay');\n         Route::post('/tagihan/pay', [SiswaTagihanController::class, 'createUnifiedPayment'])->name('invoices.unified_pay');\n-    });\n+});\n \n+Route::controller(CheckTagihanController::class)->group(function () {\n+    Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n+    Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n+    Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n+    Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n+    Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay'); // Route pembayaran baru\n });\n+\n+require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754202170439,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,200 +1,177 @@\n <?php\n \n-use App\\Http\\Controllers\\ProfileController;\n-use Illuminate\\Foundation\\Application;\n use Illuminate\\Support\\Facades\\Route;\n use Illuminate\\Http\\Request;\n use Inertia\\Inertia;\n use App\\Models\\Kelas;\n+use Illuminate\\Support\\Str;\n \n+// --- Import semua controller di satu tempat ---\n+use App\\Http\\Controllers\\Admin\\ActivityLogController;\n use App\\Http\\Controllers\\Admin\\Auth\\AuthenticatedSessionController as AdminAuthenticatedSessionController;\n-use App\\Http\\Controllers\\WebhookController;\n-use App\\Http\\Controllers\\CekTagihanController;\n-use App\\Http\\Controllers\\Public\\CheckTagihanController;\n-use App\\Http\\Controllers\\PaymentController;\n-use App\\Http\\Controllers\\RegistrationController;\n-use App\\Http\\Controllers\\DisplayController;\n+use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n+use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n use App\\Http\\Controllers\\Admin\\DashboardController;\n-use App\\Http\\Controllers\\Admin\\RoleController;\n-use App\\Http\\Controllers\\Admin\\PermissionController;\n-use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\Admin\\InvoiceController;\n+use App\\Http\\Controllers\\Admin\\JobBatchController;\n use App\\Http\\Controllers\\Admin\\KelasController;\n-use App\\Http\\Controllers\\Admin\\SiswaController;\n-use App\\Http\\Controllers\\Admin\\InvoiceController;\n+use App\\Http\\Controllers\\Admin\\LegalDocumentController;\n use App\\Http\\Controllers\\Admin\\LaporanController;\n+use App\\Http\\Controllers\\Admin\\PermissionController;\n+use App\\Http\\Controllers\\Admin\\PromoController;\n+use App\\Http\\Controllers\\Admin\\RoleController;\n use App\\Http\\Controllers\\Admin\\SettingsController;\n-use App\\Http\\Controllers\\Admin\\ActivityLogController;\n-use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n-use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n-use App\\Http\\Controllers\\Admin\\LegalDocumentController;\n-use App\\Http\\Controllers\\Admin\\PromoController;\n+use App\\Http\\Controllers\\Admin\\SiswaController;\n+use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\LegalController;\n+use App\\Http\\Controllers\\PaymentController;\n+use App\\Http\\Controllers\\ProfileController;\n+use App\\Http\\Controllers\\Public\\CheckTagihanController;\n+use App\\Http\\Controllers\\RegistrationController;\n+use App\\Http\\Controllers\\RegistrationSuccessController;\n use App\\Http\\Controllers\\ReRegistrationController;\n-use App\\Http\\Controllers\\RegistrationSuccessController;\n-use App\\Http\\Controllers\\LegalController;\n-\n+use App\\Http\\Controllers\\DisplayController;\n+use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n use App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\n use App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\n-use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n+use App\\Http\\Controllers\\WebhookController;\n \n-Route::get('/', function (Request $request) {\n-    return Inertia::render('Welcome', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip(),\n-        // 'laravelVersion' => Application::VERSION,\n-        // 'phpVersion' => PHP_VERSION,\n-        'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n-            return [\n-                'nama_kelas' => $kelas->nama_kelas,\n-                'deskripsi' => Str::limit($kelas->deskripsi, 50),\n-                // Tambahkan path gambar jika Anda punya, jika tidak kita gunakan placeholder\n-                'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n-            ];\n-        }),\n-    ]);\n-})->name('welcome'); \n-Route::get('/soccer-school', function (Request $request) {\n-    return Inertia::render('Soccerschool', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('soccer-school');\n-Route::get('/academy', function (Request $request) {\n-    return Inertia::render('Academy', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('academy');\n-Route::get('/persija-dna', function (Request $request) {\n-    return Inertia::render('Persijadna', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('persija-dna');\n-Route::get('/kontak', function (Request $request) {\n-    return Inertia::render('Kontak', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('kontak'); \n-// Route::get('/cek-tagihan', [CekTagihanController::class, 'showForm'])->name('tagihan.check_form');\n-// Route::post('/cek-tagihan', [CekTagihanController::class, 'checkStatus'])->name('tagihan.check_status');\n-Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n-Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n-Route::get('/pendaftaran', [RegistrationController::class, 'create'])->name('pendaftaran.create');\n-Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n-Route::get('/syarat-ketentuan', [LegalController::class, 'terms'])->name('legal.terms');\n-Route::get('/kebijakan-privasi', [LegalController::class, 'privacy'])->name('legal.privacy');\n-Route::get('/ketentuan-pengembalian', [LegalController::class, 'refund'])->name('legal.refund');\n-Route::get('/daftar-ulang', [ReRegistrationController::class, 'create'])->name('re-register.create');\n-Route::get('/daftar-ulang-academy', [ReRegistrationController::class, 'createAcademy'])->name('re-register-academy.create');\n-// Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n-Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n-Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n+/*\n+|--------------------------------------------------------------------------\n+| Web Routes\n+|--------------------------------------------------------------------------\n+*/\n+\n+// --- Rute Webhook (Stateless) ---\n+// Webhook dari Xendit tidak memerlukan session atau CSRF, jadi diletakkan di luar grup 'web'.\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n-Route::get('/dashboard', function () {\n-    if (auth()->check() && auth()->user()->hasRole('siswa')) {\n-        return redirect()->route('siswa.dashboard');\n-    }\n-    // Jika admin atau role lain, redirect ke dashboard admin\n-    if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user'])) {\n-        return redirect()->route('admin.dashboard');\n-    }\n-    // Fallback jika tidak ada role yang cocok (seharusnya tidak terjadi jika setup benar)\n-    return Inertia::render('Welcome');\n-})->middleware(['auth', 'verified'])->name('dashboard');\n \n+// --- RUTE YANG MEMERLUKAN SESSION (MIDDLEWARE 'WEB') ---\n Route::middleware('web')->group(function () {\n-    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n-    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n-    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-});\n \n-Route::middleware('auth')->group(function () {\n-    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n-    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n-    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n-});\n+    // --- Rute Publik Statis & Halaman Informasi ---\n+    Route::get('/', function (Request $request) {\n+        return Inertia::render('Welcome', [\n+            'canLogin' => Route::has('login'),\n+            'canRegister' => Route::has('register'),\n+            'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n+                return [\n+                    'nama_kelas' => $kelas->nama_kelas,\n+                    'deskripsi' => Str::limit($kelas->deskripsi, 50),\n+                    'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n+                ];\n+            }),\n+        ]);\n+    })->name('welcome');\n \n-Route::prefix('admin')->name('admin.')->group(function () {\n-    Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])\n-                ->middleware('guest') // Hanya bisa diakses oleh guest (belum login)\n-                ->name('login');\n+    Route::get('/soccer-school', fn() => Inertia::render('Soccerschool'))->name('soccer-school');\n+    Route::get('/academy', fn() => Inertia::render('Academy'))->name('academy');\n+    Route::get('/persija-dna', fn() => Inertia::render('Persijadna'))->name('persija-dna');\n+    Route::get('/kontak', fn() => Inertia::render('Kontak'))->name('kontak');\n+    Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n \n-    Route::post('login', [AdminAuthenticatedSessionController::class, 'store'])\n-                ->middleware('guest');\n+    // --- Rute Pendaftaran & Pembayaran Publik ---\n+    Route::controller(RegistrationController::class)->group(function () {\n+        Route::get('/daftar-academy', 'createAcademy')->name('register-academy.create');\n+        Route::get('/daftar-ss', 'createSs')->name('register-ss.create');\n+        Route::post('/pendaftaran', 'store')->name('pendaftaran.store');\n+        Route::post('/promo/validate', 'validatePromoCode')->name('promo.validate');\n+    });\n     \n-    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])\n-                ->middleware('guest')\n-                ->name('password.request');\n+    // Rute daftar ulang\n+    Route::controller(ReRegistrationController::class)->group(function () {\n+        Route::get('/daftar-ulang', 'create')->name('re-register.create');\n+        Route::get('/daftar-ulang-academy', 'createAcademy')->name('re-register-academy.create');\n+        Route::post('/daftar-ulang', 'store')->name('re-register.store');\n+    });\n \n-    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])\n-                ->middleware('guest')\n-                ->name('password.email');\n+    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+    Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n+    Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n \n-    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])\n-                ->middleware('guest')\n-                ->name('password.reset');\n+    // --- Rute Cek Tagihan Publik ---\n+    Route::controller(CheckTagihanController::class)->group(function () {\n+        Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n+        Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n+        Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n+        Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n+        Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay');\n+    });\n \n-    Route::post('reset-password', [NewPasswordController::class, 'store'])\n-                ->middleware('guest')\n-                ->name('password.store');\n+    // --- Rute Halaman Legal ---\n+    Route::controller(LegalController::class)->group(function () {\n+        Route::get('/syarat-ketentuan', 'terms')->name('legal.terms');\n+        Route::get('/kebijakan-privasi', 'privacy')->name('legal.privacy');\n+        Route::get('/ketentuan-pengembalian', 'refund')->name('legal.refund');\n+    });\n \n-    Route::middleware(['auth', 'verified'])->group(function () {\n-        \n-        Route::middleware(['role:admin'])->group(function () {\n-            Route::resource('roles', RoleController::class);\n-            Route::resource('permissions', PermissionController::class);\n-            Route::resource('users', UserController::class);\n-            Route::resource('legal-documents', LegalDocumentController::class);\n-            Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n-            Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n-            Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n+    // --- Rute Otentikasi Bawaan Laravel ---\n+    Route::get('/dashboard', function () {\n+        if (auth()->check() && auth()->user()->hasRole('siswa')) {\n+            return redirect()->route('siswa.dashboard');\n+        }\n+        if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user', 'super_admin', 'admin_kelas'])) {\n+            return redirect()->route('admin.dashboard');\n+        }\n+        return redirect()->route('welcome');\n+    })->middleware(['auth', 'verified'])->name('dashboard');\n+\n+    Route::middleware('auth')->group(function () {\n+        Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n+        Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n+        Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n+    });\n+\n+    require __DIR__.'/auth.php';\n+\n+    // --- Rute Area Admin ---\n+    Route::prefix('admin')->name('admin.')->group(function () {\n+        // Rute login & reset password admin (hanya untuk guest)\n+        Route::middleware('guest')->group(function () {\n+            Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])->name('login');\n+            Route::post('login', [AdminAuthenticatedSessionController::class, 'store']);\n+            Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])->name('password.request');\n+            Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])->name('password.email');\n+            Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])->name('password.reset');\n+            Route::post('reset-password', [NewPasswordController::class, 'store'])->name('password.store');\n         });\n \n-        Route::middleware(['role:admin|user|admin_kelas'])->group(function() {\n-            Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n-            Route::resource('kelas', KelasController::class);\n-            Route::get('siswa/export', [SiswaController::class, 'export'])->name('siswa.export');\n-            Route::post('siswa/import', [SiswaController::class, 'import'])->name('siswa.import');\n-            Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n-            Route::resource('siswa', SiswaController::class);\n-            Route::resource('invoices', InvoiceController::class);\n-            Route::resource('promos', PromoController::class)->except(['show']);\n-            Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n-            Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n-            Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n-            Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n-            Route::get('jobs', [\\App\\Http\\Controllers\\Admin\\JobBatchController::class, 'index'])->name('jobs.index');\n+        // Rute yang memerlukan login admin\n+        Route::middleware(['auth', 'verified'])->group(function () {\n+            // Rute khusus untuk Super Admin & Admin\n+            Route::middleware(['role:super_admin|admin'])->group(function () {\n+                Route::resource('roles', RoleController::class);\n+                Route::resource('permissions', PermissionController::class);\n+                Route::resource('users', UserController::class);\n+                Route::resource('legal-documents', LegalDocumentController::class);\n+                Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n+                Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n+                Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n+            });\n+\n+            // Rute untuk semua jenis admin (termasuk admin kelas)\n+            Route::middleware(['role:super_admin|admin|admin_kelas'])->group(function() {\n+                Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n+                Route::resource('kelas', KelasController::class);\n+                Route::resource('siswa', SiswaController::class);\n+                Route::resource('invoices', InvoiceController::class);\n+                Route::resource('promos', PromoController::class)->except(['show']);\n+                Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n+                Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n+                Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n+                Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n+                Route::get('jobs', [JobBatchController::class, 'index'])->name('jobs.index');\n+            });\n         });\n-\n     });\n-});\n \n-Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')\n-    ->name('siswa.')->group(function () {\n+    // --- Rute Area Siswa ---\n+    Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')->name('siswa.')->group(function () {\n         Route::get('/dashboard', [SiswaDashboardController::class, 'index'])->name('dashboard');\n-        Route::put('/profil/update-info', [SiswaProfileController::class, 'updateInformation'])->name('profil.update_info');\n-        Route::put('/profil/update-password', [SiswaProfileController::class, 'updatePassword'])->name('profil.update_password');\n         Route::get('/profil', [SiswaProfileController::class, 'show'])->name('profil.show');\n         Route::get('/tagihan', [SiswaTagihanController::class, 'index'])->name('tagihan.index');\n-        Route::post('/invoices/{invoice}/pay', [SiswaTagihanController::class, 'createPaymentToken'])->name('tagihan.pay');\n-        Route::post('/invoices/bulk-pay', [SiswaTagihanController::class, 'createBulkPayment'])->name('invoices.bulk_pay');\n         Route::post('/tagihan/pay', [SiswaTagihanController::class, 'createUnifiedPayment'])->name('invoices.unified_pay');\n-});\n+    });\n \n-Route::controller(CheckTagihanController::class)->group(function () {\n-    Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n-    Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n-    Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n-    Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n-    Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay'); // Route pembayaran baru\n });\n-\n-require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754202193459,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,177 +1,200 @@\n <?php\n \n+use App\\Http\\Controllers\\ProfileController;\n+use Illuminate\\Foundation\\Application;\n use Illuminate\\Support\\Facades\\Route;\n use Illuminate\\Http\\Request;\n use Inertia\\Inertia;\n use App\\Models\\Kelas;\n-use Illuminate\\Support\\Str;\n \n-// --- Import semua controller di satu tempat ---\n-use App\\Http\\Controllers\\Admin\\ActivityLogController;\n use App\\Http\\Controllers\\Admin\\Auth\\AuthenticatedSessionController as AdminAuthenticatedSessionController;\n-use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n-use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n+use App\\Http\\Controllers\\WebhookController;\n+use App\\Http\\Controllers\\CekTagihanController;\n+use App\\Http\\Controllers\\Public\\CheckTagihanController;\n+use App\\Http\\Controllers\\PaymentController;\n+use App\\Http\\Controllers\\RegistrationController;\n+use App\\Http\\Controllers\\DisplayController;\n use App\\Http\\Controllers\\Admin\\DashboardController;\n+use App\\Http\\Controllers\\Admin\\RoleController;\n+use App\\Http\\Controllers\\Admin\\PermissionController;\n+use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\Admin\\KelasController;\n+use App\\Http\\Controllers\\Admin\\SiswaController;\n use App\\Http\\Controllers\\Admin\\InvoiceController;\n-use App\\Http\\Controllers\\Admin\\JobBatchController;\n-use App\\Http\\Controllers\\Admin\\KelasController;\n+use App\\Http\\Controllers\\Admin\\LaporanController;\n+use App\\Http\\Controllers\\Admin\\SettingsController;\n+use App\\Http\\Controllers\\Admin\\ActivityLogController;\n+use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n+use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n use App\\Http\\Controllers\\Admin\\LegalDocumentController;\n-use App\\Http\\Controllers\\Admin\\LaporanController;\n-use App\\Http\\Controllers\\Admin\\PermissionController;\n use App\\Http\\Controllers\\Admin\\PromoController;\n-use App\\Http\\Controllers\\Admin\\RoleController;\n-use App\\Http\\Controllers\\Admin\\SettingsController;\n-use App\\Http\\Controllers\\Admin\\SiswaController;\n-use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\ReRegistrationController;\n+use App\\Http\\Controllers\\RegistrationSuccessController;\n use App\\Http\\Controllers\\LegalController;\n-use App\\Http\\Controllers\\PaymentController;\n-use App\\Http\\Controllers\\ProfileController;\n-use App\\Http\\Controllers\\Public\\CheckTagihanController;\n-use App\\Http\\Controllers\\RegistrationController;\n-use App\\Http\\Controllers\\RegistrationSuccessController;\n-use App\\Http\\Controllers\\ReRegistrationController;\n-use App\\Http\\Controllers\\DisplayController;\n-use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n+\n use App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\n use App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\n-use App\\Http\\Controllers\\WebhookController;\n+use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n \n-/*\n-|--------------------------------------------------------------------------\n-| Web Routes\n-|--------------------------------------------------------------------------\n-*/\n-\n-// --- Rute Webhook (Stateless) ---\n-// Webhook dari Xendit tidak memerlukan session atau CSRF, jadi diletakkan di luar grup 'web'.\n+Route::get('/', function (Request $request) {\n+    return Inertia::render('Welcome', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip(),\n+        // 'laravelVersion' => Application::VERSION,\n+        // 'phpVersion' => PHP_VERSION,\n+        'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n+            return [\n+                'nama_kelas' => $kelas->nama_kelas,\n+                'deskripsi' => Str::limit($kelas->deskripsi, 50),\n+                // Tambahkan path gambar jika Anda punya, jika tidak kita gunakan placeholder\n+                'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n+            ];\n+        }),\n+    ]);\n+})->name('welcome'); \n+Route::get('/soccer-school', function (Request $request) {\n+    return Inertia::render('Soccerschool', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('soccer-school');\n+Route::get('/academy', function (Request $request) {\n+    return Inertia::render('Academy', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('academy');\n+Route::get('/persija-dna', function (Request $request) {\n+    return Inertia::render('Persijadna', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('persija-dna');\n+Route::get('/kontak', function (Request $request) {\n+    return Inertia::render('Kontak', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('kontak'); \n+// Route::get('/cek-tagihan', [CekTagihanController::class, 'showForm'])->name('tagihan.check_form');\n+// Route::post('/cek-tagihan', [CekTagihanController::class, 'checkStatus'])->name('tagihan.check_status');\n+Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n+Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n+Route::get('/pendaftaran', [RegistrationController::class, 'create'])->name('pendaftaran.create');\n+Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n+Route::get('/syarat-ketentuan', [LegalController::class, 'terms'])->name('legal.terms');\n+Route::get('/kebijakan-privasi', [LegalController::class, 'privacy'])->name('legal.privacy');\n+Route::get('/ketentuan-pengembalian', [LegalController::class, 'refund'])->name('legal.refund');\n+Route::get('/daftar-ulang', [ReRegistrationController::class, 'create'])->name('re-register.create');\n+Route::get('/daftar-ulang-academy', [ReRegistrationController::class, 'createAcademy'])->name('re-register-academy.create');\n+// Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n+Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n+Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n+Route::get('/dashboard', function () {\n+    if (auth()->check() && auth()->user()->hasRole('siswa')) {\n+        return redirect()->route('siswa.dashboard');\n+    }\n+    // Jika admin atau role lain, redirect ke dashboard admin\n+    if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user'])) {\n+        return redirect()->route('admin.dashboard');\n+    }\n+    // Fallback jika tidak ada role yang cocok (seharusnya tidak terjadi jika setup benar)\n+    return Inertia::render('Welcome');\n+})->middleware(['auth', 'verified'])->name('dashboard');\n \n-// --- RUTE YANG MEMERLUKAN SESSION (MIDDLEWARE 'WEB') ---\n Route::middleware('web')->group(function () {\n+    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n+    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n+    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n+    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+});\n \n-    // --- Rute Publik Statis & Halaman Informasi ---\n-    Route::get('/', function (Request $request) {\n-        return Inertia::render('Welcome', [\n-            'canLogin' => Route::has('login'),\n-            'canRegister' => Route::has('register'),\n-            'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n-                return [\n-                    'nama_kelas' => $kelas->nama_kelas,\n-                    'deskripsi' => Str::limit($kelas->deskripsi, 50),\n-                    'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n-                ];\n-            }),\n-        ]);\n-    })->name('welcome');\n+Route::middleware('auth')->group(function () {\n+    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n+    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n+    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n+});\n \n-    Route::get('/soccer-school', fn() => Inertia::render('Soccerschool'))->name('soccer-school');\n-    Route::get('/academy', fn() => Inertia::render('Academy'))->name('academy');\n-    Route::get('/persija-dna', fn() => Inertia::render('Persijadna'))->name('persija-dna');\n-    Route::get('/kontak', fn() => Inertia::render('Kontak'))->name('kontak');\n-    Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n+Route::prefix('admin')->name('admin.')->group(function () {\n+    Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])\n+                ->middleware('guest') // Hanya bisa diakses oleh guest (belum login)\n+                ->name('login');\n \n-    // --- Rute Pendaftaran & Pembayaran Publik ---\n-    Route::controller(RegistrationController::class)->group(function () {\n-        Route::get('/daftar-academy', 'createAcademy')->name('register-academy.create');\n-        Route::get('/daftar-ss', 'createSs')->name('register-ss.create');\n-        Route::post('/pendaftaran', 'store')->name('pendaftaran.store');\n-        Route::post('/promo/validate', 'validatePromoCode')->name('promo.validate');\n-    });\n+    Route::post('login', [AdminAuthenticatedSessionController::class, 'store'])\n+                ->middleware('guest');\n     \n-    // Rute daftar ulang\n-    Route::controller(ReRegistrationController::class)->group(function () {\n-        Route::get('/daftar-ulang', 'create')->name('re-register.create');\n-        Route::get('/daftar-ulang-academy', 'createAcademy')->name('re-register-academy.create');\n-        Route::post('/daftar-ulang', 'store')->name('re-register.store');\n-    });\n+    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])\n+                ->middleware('guest')\n+                ->name('password.request');\n \n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-    Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n-    Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n+    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])\n+                ->middleware('guest')\n+                ->name('password.email');\n \n-    // --- Rute Cek Tagihan Publik ---\n-    Route::controller(CheckTagihanController::class)->group(function () {\n-        Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n-        Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n-        Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n-        Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n-        Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay');\n-    });\n+    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])\n+                ->middleware('guest')\n+                ->name('password.reset');\n \n-    // --- Rute Halaman Legal ---\n-    Route::controller(LegalController::class)->group(function () {\n-        Route::get('/syarat-ketentuan', 'terms')->name('legal.terms');\n-        Route::get('/kebijakan-privasi', 'privacy')->name('legal.privacy');\n-        Route::get('/ketentuan-pengembalian', 'refund')->name('legal.refund');\n-    });\n+    Route::post('reset-password', [NewPasswordController::class, 'store'])\n+                ->middleware('guest')\n+                ->name('password.store');\n \n-    // --- Rute Otentikasi Bawaan Laravel ---\n-    Route::get('/dashboard', function () {\n-        if (auth()->check() && auth()->user()->hasRole('siswa')) {\n-            return redirect()->route('siswa.dashboard');\n-        }\n-        if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user', 'super_admin', 'admin_kelas'])) {\n-            return redirect()->route('admin.dashboard');\n-        }\n-        return redirect()->route('welcome');\n-    })->middleware(['auth', 'verified'])->name('dashboard');\n+    Route::middleware(['auth', 'verified'])->group(function () {\n+        \n+        Route::middleware(['role:admin'])->group(function () {\n+            Route::resource('roles', RoleController::class);\n+            Route::resource('permissions', PermissionController::class);\n+            Route::resource('users', UserController::class);\n+            Route::resource('legal-documents', LegalDocumentController::class);\n+            Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n+            Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n+            Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n+        });\n \n-    Route::middleware('auth')->group(function () {\n-        Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n-        Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n-        Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n-    });\n-\n-    require __DIR__.'/auth.php';\n-\n-    // --- Rute Area Admin ---\n-    Route::prefix('admin')->name('admin.')->group(function () {\n-        // Rute login & reset password admin (hanya untuk guest)\n-        Route::middleware('guest')->group(function () {\n-            Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])->name('login');\n-            Route::post('login', [AdminAuthenticatedSessionController::class, 'store']);\n-            Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])->name('password.request');\n-            Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])->name('password.email');\n-            Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])->name('password.reset');\n-            Route::post('reset-password', [NewPasswordController::class, 'store'])->name('password.store');\n+        Route::middleware(['role:admin|user|admin_kelas'])->group(function() {\n+            Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n+            Route::resource('kelas', KelasController::class);\n+            Route::get('siswa/export', [SiswaController::class, 'export'])->name('siswa.export');\n+            Route::post('siswa/import', [SiswaController::class, 'import'])->name('siswa.import');\n+            Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n+            Route::resource('siswa', SiswaController::class);\n+            Route::resource('invoices', InvoiceController::class);\n+            Route::resource('promos', PromoController::class)->except(['show']);\n+            Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n+            Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n+            Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n+            Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n+            Route::get('jobs', [\\App\\Http\\Controllers\\Admin\\JobBatchController::class, 'index'])->name('jobs.index');\n         });\n \n-        // Rute yang memerlukan login admin\n-        Route::middleware(['auth', 'verified'])->group(function () {\n-            // Rute khusus untuk Super Admin & Admin\n-            Route::middleware(['role:super_admin|admin'])->group(function () {\n-                Route::resource('roles', RoleController::class);\n-                Route::resource('permissions', PermissionController::class);\n-                Route::resource('users', UserController::class);\n-                Route::resource('legal-documents', LegalDocumentController::class);\n-                Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n-                Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n-                Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n-            });\n-\n-            // Rute untuk semua jenis admin (termasuk admin kelas)\n-            Route::middleware(['role:super_admin|admin|admin_kelas'])->group(function() {\n-                Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n-                Route::resource('kelas', KelasController::class);\n-                Route::resource('siswa', SiswaController::class);\n-                Route::resource('invoices', InvoiceController::class);\n-                Route::resource('promos', PromoController::class)->except(['show']);\n-                Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n-                Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n-                Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n-                Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n-                Route::get('jobs', [JobBatchController::class, 'index'])->name('jobs.index');\n-            });\n-        });\n     });\n+});\n \n-    // --- Rute Area Siswa ---\n-    Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')->name('siswa.')->group(function () {\n+Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')\n+    ->name('siswa.')->group(function () {\n         Route::get('/dashboard', [SiswaDashboardController::class, 'index'])->name('dashboard');\n+        Route::put('/profil/update-info', [SiswaProfileController::class, 'updateInformation'])->name('profil.update_info');\n+        Route::put('/profil/update-password', [SiswaProfileController::class, 'updatePassword'])->name('profil.update_password');\n         Route::get('/profil', [SiswaProfileController::class, 'show'])->name('profil.show');\n         Route::get('/tagihan', [SiswaTagihanController::class, 'index'])->name('tagihan.index');\n+        Route::post('/invoices/{invoice}/pay', [SiswaTagihanController::class, 'createPaymentToken'])->name('tagihan.pay');\n+        Route::post('/invoices/bulk-pay', [SiswaTagihanController::class, 'createBulkPayment'])->name('invoices.bulk_pay');\n         Route::post('/tagihan/pay', [SiswaTagihanController::class, 'createUnifiedPayment'])->name('invoices.unified_pay');\n-    });\n+});\n \n+Route::controller(CheckTagihanController::class)->group(function () {\n+    Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n+    Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n+    Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n+    Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n+    Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay'); // Route pembayaran baru\n });\n+\n+require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754202246405,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,200 +1,177 @@\n <?php\n \n-use App\\Http\\Controllers\\ProfileController;\n-use Illuminate\\Foundation\\Application;\n use Illuminate\\Support\\Facades\\Route;\n use Illuminate\\Http\\Request;\n use Inertia\\Inertia;\n use App\\Models\\Kelas;\n+use Illuminate\\Support\\Str;\n \n+// --- Import semua controller di satu tempat ---\n+use App\\Http\\Controllers\\Admin\\ActivityLogController;\n use App\\Http\\Controllers\\Admin\\Auth\\AuthenticatedSessionController as AdminAuthenticatedSessionController;\n-use App\\Http\\Controllers\\WebhookController;\n-use App\\Http\\Controllers\\CekTagihanController;\n-use App\\Http\\Controllers\\Public\\CheckTagihanController;\n-use App\\Http\\Controllers\\PaymentController;\n-use App\\Http\\Controllers\\RegistrationController;\n-use App\\Http\\Controllers\\DisplayController;\n+use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n+use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n use App\\Http\\Controllers\\Admin\\DashboardController;\n-use App\\Http\\Controllers\\Admin\\RoleController;\n-use App\\Http\\Controllers\\Admin\\PermissionController;\n-use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\Admin\\InvoiceController;\n+use App\\Http\\Controllers\\Admin\\JobBatchController;\n use App\\Http\\Controllers\\Admin\\KelasController;\n-use App\\Http\\Controllers\\Admin\\SiswaController;\n-use App\\Http\\Controllers\\Admin\\InvoiceController;\n+use App\\Http\\Controllers\\Admin\\LegalDocumentController;\n use App\\Http\\Controllers\\Admin\\LaporanController;\n+use App\\Http\\Controllers\\Admin\\PermissionController;\n+use App\\Http\\Controllers\\Admin\\PromoController;\n+use App\\Http\\Controllers\\Admin\\RoleController;\n use App\\Http\\Controllers\\Admin\\SettingsController;\n-use App\\Http\\Controllers\\Admin\\ActivityLogController;\n-use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n-use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n-use App\\Http\\Controllers\\Admin\\LegalDocumentController;\n-use App\\Http\\Controllers\\Admin\\PromoController;\n+use App\\Http\\Controllers\\Admin\\SiswaController;\n+use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\LegalController;\n+use App\\Http\\Controllers\\PaymentController;\n+use App\\Http\\Controllers\\ProfileController;\n+use App\\Http\\Controllers\\Public\\CheckTagihanController;\n+use App\\Http\\Controllers\\RegistrationController;\n+use App\\Http\\Controllers\\RegistrationSuccessController;\n use App\\Http\\Controllers\\ReRegistrationController;\n-use App\\Http\\Controllers\\RegistrationSuccessController;\n-use App\\Http\\Controllers\\LegalController;\n-\n+use App\\Http\\Controllers\\DisplayController;\n+use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n use App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\n use App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\n-use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n+use App\\Http\\Controllers\\WebhookController;\n \n-Route::get('/', function (Request $request) {\n-    return Inertia::render('Welcome', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip(),\n-        // 'laravelVersion' => Application::VERSION,\n-        // 'phpVersion' => PHP_VERSION,\n-        'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n-            return [\n-                'nama_kelas' => $kelas->nama_kelas,\n-                'deskripsi' => Str::limit($kelas->deskripsi, 50),\n-                // Tambahkan path gambar jika Anda punya, jika tidak kita gunakan placeholder\n-                'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n-            ];\n-        }),\n-    ]);\n-})->name('welcome'); \n-Route::get('/soccer-school', function (Request $request) {\n-    return Inertia::render('Soccerschool', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('soccer-school');\n-Route::get('/academy', function (Request $request) {\n-    return Inertia::render('Academy', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('academy');\n-Route::get('/persija-dna', function (Request $request) {\n-    return Inertia::render('Persijadna', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('persija-dna');\n-Route::get('/kontak', function (Request $request) {\n-    return Inertia::render('Kontak', [\n-        'canLogin' => Route::has('login'),\n-        'canRegister' => Route::has('register'),\n-        'userIp' => $request->ip()\n-    ]);\n-})->name('kontak'); \n-// Route::get('/cek-tagihan', [CekTagihanController::class, 'showForm'])->name('tagihan.check_form');\n-// Route::post('/cek-tagihan', [CekTagihanController::class, 'checkStatus'])->name('tagihan.check_status');\n-Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n-Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n-Route::get('/pendaftaran', [RegistrationController::class, 'create'])->name('pendaftaran.create');\n-Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n-Route::get('/syarat-ketentuan', [LegalController::class, 'terms'])->name('legal.terms');\n-Route::get('/kebijakan-privasi', [LegalController::class, 'privacy'])->name('legal.privacy');\n-Route::get('/ketentuan-pengembalian', [LegalController::class, 'refund'])->name('legal.refund');\n-Route::get('/daftar-ulang', [ReRegistrationController::class, 'create'])->name('re-register.create');\n-Route::get('/daftar-ulang-academy', [ReRegistrationController::class, 'createAcademy'])->name('re-register-academy.create');\n-// Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n-Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n-Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n+/*\n+|--------------------------------------------------------------------------\n+| Web Routes\n+|--------------------------------------------------------------------------\n+*/\n+\n+// --- Rute Webhook (Stateless) ---\n+// Webhook dari Xendit tidak memerlukan session atau CSRF, jadi diletakkan di luar grup 'web'.\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n-Route::get('/dashboard', function () {\n-    if (auth()->check() && auth()->user()->hasRole('siswa')) {\n-        return redirect()->route('siswa.dashboard');\n-    }\n-    // Jika admin atau role lain, redirect ke dashboard admin\n-    if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user'])) {\n-        return redirect()->route('admin.dashboard');\n-    }\n-    // Fallback jika tidak ada role yang cocok (seharusnya tidak terjadi jika setup benar)\n-    return Inertia::render('Welcome');\n-})->middleware(['auth', 'verified'])->name('dashboard');\n \n+// --- RUTE YANG MEMERLUKAN SESSION (MIDDLEWARE 'WEB') ---\n Route::middleware('web')->group(function () {\n-    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n-    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n-    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-});\n \n-Route::middleware('auth')->group(function () {\n-    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n-    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n-    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n-});\n+    // --- Rute Publik Statis & Halaman Informasi ---\n+    Route::get('/', function (Request $request) {\n+        return Inertia::render('Welcome', [\n+            'canLogin' => Route::has('login'),\n+            'canRegister' => Route::has('register'),\n+            'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n+                return [\n+                    'nama_kelas' => $kelas->nama_kelas,\n+                    'deskripsi' => Str::limit($kelas->deskripsi, 50),\n+                    'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n+                ];\n+            }),\n+        ]);\n+    })->name('welcome');\n \n-Route::prefix('admin')->name('admin.')->group(function () {\n-    Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])\n-                ->middleware('guest') // Hanya bisa diakses oleh guest (belum login)\n-                ->name('login');\n+    Route::get('/soccer-school', fn() => Inertia::render('Soccerschool'))->name('soccer-school');\n+    Route::get('/academy', fn() => Inertia::render('Academy'))->name('academy');\n+    Route::get('/persija-dna', fn() => Inertia::render('Persijadna'))->name('persija-dna');\n+    Route::get('/kontak', fn() => Inertia::render('Kontak'))->name('kontak');\n+    Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n \n-    Route::post('login', [AdminAuthenticatedSessionController::class, 'store'])\n-                ->middleware('guest');\n+    // --- Rute Pendaftaran & Pembayaran Publik ---\n+    Route::controller(RegistrationController::class)->group(function () {\n+        Route::get('/daftar-academy', 'createAcademy')->name('register-academy.create');\n+        Route::get('/daftar-ss', 'createSs')->name('register-ss.create');\n+        Route::post('/pendaftaran', 'store')->name('pendaftaran.store');\n+        Route::post('/promo/validate', 'validatePromoCode')->name('promo.validate');\n+    });\n     \n-    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])\n-                ->middleware('guest')\n-                ->name('password.request');\n+    // Rute daftar ulang\n+    Route::controller(ReRegistrationController::class)->group(function () {\n+        Route::get('/daftar-ulang', 'create')->name('re-register.create');\n+        Route::get('/daftar-ulang-academy', 'createAcademy')->name('re-register-academy.create');\n+        Route::post('/daftar-ulang', 'store')->name('re-register.store');\n+    });\n \n-    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])\n-                ->middleware('guest')\n-                ->name('password.email');\n+    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+    Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n+    Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n \n-    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])\n-                ->middleware('guest')\n-                ->name('password.reset');\n+    // --- Rute Cek Tagihan Publik ---\n+    Route::controller(CheckTagihanController::class)->group(function () {\n+        Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n+        Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n+        Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n+        Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n+        Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay');\n+    });\n \n-    Route::post('reset-password', [NewPasswordController::class, 'store'])\n-                ->middleware('guest')\n-                ->name('password.store');\n+    // --- Rute Halaman Legal ---\n+    Route::controller(LegalController::class)->group(function () {\n+        Route::get('/syarat-ketentuan', 'terms')->name('legal.terms');\n+        Route::get('/kebijakan-privasi', 'privacy')->name('legal.privacy');\n+        Route::get('/ketentuan-pengembalian', 'refund')->name('legal.refund');\n+    });\n \n-    Route::middleware(['auth', 'verified'])->group(function () {\n-        \n-        Route::middleware(['role:admin'])->group(function () {\n-            Route::resource('roles', RoleController::class);\n-            Route::resource('permissions', PermissionController::class);\n-            Route::resource('users', UserController::class);\n-            Route::resource('legal-documents', LegalDocumentController::class);\n-            Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n-            Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n-            Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n+    // --- Rute Otentikasi Bawaan Laravel ---\n+    Route::get('/dashboard', function () {\n+        if (auth()->check() && auth()->user()->hasRole('siswa')) {\n+            return redirect()->route('siswa.dashboard');\n+        }\n+        if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user', 'super_admin', 'admin_kelas'])) {\n+            return redirect()->route('admin.dashboard');\n+        }\n+        return redirect()->route('welcome');\n+    })->middleware(['auth', 'verified'])->name('dashboard');\n+\n+    Route::middleware('auth')->group(function () {\n+        Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n+        Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n+        Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n+    });\n+\n+    require __DIR__.'/auth.php';\n+\n+    // --- Rute Area Admin ---\n+    Route::prefix('admin')->name('admin.')->group(function () {\n+        // Rute login & reset password admin (hanya untuk guest)\n+        Route::middleware('guest')->group(function () {\n+            Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])->name('login');\n+            Route::post('login', [AdminAuthenticatedSessionController::class, 'store']);\n+            Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])->name('password.request');\n+            Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])->name('password.email');\n+            Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])->name('password.reset');\n+            Route::post('reset-password', [NewPasswordController::class, 'store'])->name('password.store');\n         });\n \n-        Route::middleware(['role:admin|user|admin_kelas'])->group(function() {\n-            Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n-            Route::resource('kelas', KelasController::class);\n-            Route::get('siswa/export', [SiswaController::class, 'export'])->name('siswa.export');\n-            Route::post('siswa/import', [SiswaController::class, 'import'])->name('siswa.import');\n-            Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n-            Route::resource('siswa', SiswaController::class);\n-            Route::resource('invoices', InvoiceController::class);\n-            Route::resource('promos', PromoController::class)->except(['show']);\n-            Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n-            Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n-            Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n-            Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n-            Route::get('jobs', [\\App\\Http\\Controllers\\Admin\\JobBatchController::class, 'index'])->name('jobs.index');\n+        // Rute yang memerlukan login admin\n+        Route::middleware(['auth', 'verified'])->group(function () {\n+            // Rute khusus untuk Super Admin & Admin\n+            Route::middleware(['role:super_admin|admin'])->group(function () {\n+                Route::resource('roles', RoleController::class);\n+                Route::resource('permissions', PermissionController::class);\n+                Route::resource('users', UserController::class);\n+                Route::resource('legal-documents', LegalDocumentController::class);\n+                Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n+                Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n+                Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n+            });\n+\n+            // Rute untuk semua jenis admin (termasuk admin kelas)\n+            Route::middleware(['role:super_admin|admin|admin_kelas'])->group(function() {\n+                Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n+                Route::resource('kelas', KelasController::class);\n+                Route::resource('siswa', SiswaController::class);\n+                Route::resource('invoices', InvoiceController::class);\n+                Route::resource('promos', PromoController::class)->except(['show']);\n+                Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n+                Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n+                Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n+                Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n+                Route::get('jobs', [JobBatchController::class, 'index'])->name('jobs.index');\n+            });\n         });\n-\n     });\n-});\n \n-Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')\n-    ->name('siswa.')->group(function () {\n+    // --- Rute Area Siswa ---\n+    Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')->name('siswa.')->group(function () {\n         Route::get('/dashboard', [SiswaDashboardController::class, 'index'])->name('dashboard');\n-        Route::put('/profil/update-info', [SiswaProfileController::class, 'updateInformation'])->name('profil.update_info');\n-        Route::put('/profil/update-password', [SiswaProfileController::class, 'updatePassword'])->name('profil.update_password');\n         Route::get('/profil', [SiswaProfileController::class, 'show'])->name('profil.show');\n         Route::get('/tagihan', [SiswaTagihanController::class, 'index'])->name('tagihan.index');\n-        Route::post('/invoices/{invoice}/pay', [SiswaTagihanController::class, 'createPaymentToken'])->name('tagihan.pay');\n-        Route::post('/invoices/bulk-pay', [SiswaTagihanController::class, 'createBulkPayment'])->name('invoices.bulk_pay');\n         Route::post('/tagihan/pay', [SiswaTagihanController::class, 'createUnifiedPayment'])->name('invoices.unified_pay');\n-});\n+    });\n \n-Route::controller(CheckTagihanController::class)->group(function () {\n-    Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n-    Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n-    Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n-    Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n-    Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay'); // Route pembayaran baru\n });\n-\n-require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754202261007,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,177 +1,200 @@\n <?php\n \n+use App\\Http\\Controllers\\ProfileController;\n+use Illuminate\\Foundation\\Application;\n use Illuminate\\Support\\Facades\\Route;\n use Illuminate\\Http\\Request;\n use Inertia\\Inertia;\n use App\\Models\\Kelas;\n-use Illuminate\\Support\\Str;\n \n-// --- Import semua controller di satu tempat ---\n-use App\\Http\\Controllers\\Admin\\ActivityLogController;\n use App\\Http\\Controllers\\Admin\\Auth\\AuthenticatedSessionController as AdminAuthenticatedSessionController;\n-use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n-use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n+use App\\Http\\Controllers\\WebhookController;\n+use App\\Http\\Controllers\\CekTagihanController;\n+use App\\Http\\Controllers\\Public\\CheckTagihanController;\n+use App\\Http\\Controllers\\PaymentController;\n+use App\\Http\\Controllers\\RegistrationController;\n+use App\\Http\\Controllers\\DisplayController;\n use App\\Http\\Controllers\\Admin\\DashboardController;\n+use App\\Http\\Controllers\\Admin\\RoleController;\n+use App\\Http\\Controllers\\Admin\\PermissionController;\n+use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\Admin\\KelasController;\n+use App\\Http\\Controllers\\Admin\\SiswaController;\n use App\\Http\\Controllers\\Admin\\InvoiceController;\n-use App\\Http\\Controllers\\Admin\\JobBatchController;\n-use App\\Http\\Controllers\\Admin\\KelasController;\n+use App\\Http\\Controllers\\Admin\\LaporanController;\n+use App\\Http\\Controllers\\Admin\\SettingsController;\n+use App\\Http\\Controllers\\Admin\\ActivityLogController;\n+use App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\n+use App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\n use App\\Http\\Controllers\\Admin\\LegalDocumentController;\n-use App\\Http\\Controllers\\Admin\\LaporanController;\n-use App\\Http\\Controllers\\Admin\\PermissionController;\n use App\\Http\\Controllers\\Admin\\PromoController;\n-use App\\Http\\Controllers\\Admin\\RoleController;\n-use App\\Http\\Controllers\\Admin\\SettingsController;\n-use App\\Http\\Controllers\\Admin\\SiswaController;\n-use App\\Http\\Controllers\\Admin\\UserController;\n+use App\\Http\\Controllers\\ReRegistrationController;\n+use App\\Http\\Controllers\\RegistrationSuccessController;\n use App\\Http\\Controllers\\LegalController;\n-use App\\Http\\Controllers\\PaymentController;\n-use App\\Http\\Controllers\\ProfileController;\n-use App\\Http\\Controllers\\Public\\CheckTagihanController;\n-use App\\Http\\Controllers\\RegistrationController;\n-use App\\Http\\Controllers\\RegistrationSuccessController;\n-use App\\Http\\Controllers\\ReRegistrationController;\n-use App\\Http\\Controllers\\DisplayController;\n-use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n+\n use App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\n use App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\n-use App\\Http\\Controllers\\WebhookController;\n+use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n \n-/*\n-|--------------------------------------------------------------------------\n-| Web Routes\n-|--------------------------------------------------------------------------\n-*/\n-\n-// --- Rute Webhook (Stateless) ---\n-// Webhook dari Xendit tidak memerlukan session atau CSRF, jadi diletakkan di luar grup 'web'.\n+Route::get('/', function (Request $request) {\n+    return Inertia::render('Welcome', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip(),\n+        // 'laravelVersion' => Application::VERSION,\n+        // 'phpVersion' => PHP_VERSION,\n+        'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n+            return [\n+                'nama_kelas' => $kelas->nama_kelas,\n+                'deskripsi' => Str::limit($kelas->deskripsi, 50),\n+                // Tambahkan path gambar jika Anda punya, jika tidak kita gunakan placeholder\n+                'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n+            ];\n+        }),\n+    ]);\n+})->name('welcome'); \n+Route::get('/soccer-school', function (Request $request) {\n+    return Inertia::render('Soccerschool', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('soccer-school');\n+Route::get('/academy', function (Request $request) {\n+    return Inertia::render('Academy', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('academy');\n+Route::get('/persija-dna', function (Request $request) {\n+    return Inertia::render('Persijadna', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('persija-dna');\n+Route::get('/kontak', function (Request $request) {\n+    return Inertia::render('Kontak', [\n+        'canLogin' => Route::has('login'),\n+        'canRegister' => Route::has('register'),\n+        'userIp' => $request->ip()\n+    ]);\n+})->name('kontak'); \n+// Route::get('/cek-tagihan', [CekTagihanController::class, 'showForm'])->name('tagihan.check_form');\n+// Route::post('/cek-tagihan', [CekTagihanController::class, 'checkStatus'])->name('tagihan.check_status');\n+Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n+Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n+Route::get('/pendaftaran', [RegistrationController::class, 'create'])->name('pendaftaran.create');\n+Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n+Route::get('/syarat-ketentuan', [LegalController::class, 'terms'])->name('legal.terms');\n+Route::get('/kebijakan-privasi', [LegalController::class, 'privacy'])->name('legal.privacy');\n+Route::get('/ketentuan-pengembalian', [LegalController::class, 'refund'])->name('legal.refund');\n+Route::get('/daftar-ulang', [ReRegistrationController::class, 'create'])->name('re-register.create');\n+Route::get('/daftar-ulang-academy', [ReRegistrationController::class, 'createAcademy'])->name('re-register-academy.create');\n+// Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n+Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n+Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n+Route::get('/dashboard', function () {\n+    if (auth()->check() && auth()->user()->hasRole('siswa')) {\n+        return redirect()->route('siswa.dashboard');\n+    }\n+    // Jika admin atau role lain, redirect ke dashboard admin\n+    if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user'])) {\n+        return redirect()->route('admin.dashboard');\n+    }\n+    // Fallback jika tidak ada role yang cocok (seharusnya tidak terjadi jika setup benar)\n+    return Inertia::render('Welcome');\n+})->middleware(['auth', 'verified'])->name('dashboard');\n \n-// --- RUTE YANG MEMERLUKAN SESSION (MIDDLEWARE 'WEB') ---\n Route::middleware('web')->group(function () {\n+    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n+    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n+    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n+    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+});\n \n-    // --- Rute Publik Statis & Halaman Informasi ---\n-    Route::get('/', function (Request $request) {\n-        return Inertia::render('Welcome', [\n-            'canLogin' => Route::has('login'),\n-            'canRegister' => Route::has('register'),\n-            'allKelas' => Kelas::orderBy('nama_kelas')->get()->map(function($kelas) {\n-                return [\n-                    'nama_kelas' => $kelas->nama_kelas,\n-                    'deskripsi' => Str::limit($kelas->deskripsi, 50),\n-                    'gambar' => 'https://placehold.co/400x300/e2e8f0/4a5563?text=' . urlencode($kelas->nama_kelas),\n-                ];\n-            }),\n-        ]);\n-    })->name('welcome');\n+Route::middleware('auth')->group(function () {\n+    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n+    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n+    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n+});\n \n-    Route::get('/soccer-school', fn() => Inertia::render('Soccerschool'))->name('soccer-school');\n-    Route::get('/academy', fn() => Inertia::render('Academy'))->name('academy');\n-    Route::get('/persija-dna', fn() => Inertia::render('Persijadna'))->name('persija-dna');\n-    Route::get('/kontak', fn() => Inertia::render('Kontak'))->name('kontak');\n-    Route::get('/display', [DisplayController::class, 'index'])->name('display.index');\n+Route::prefix('admin')->name('admin.')->group(function () {\n+    Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])\n+                ->middleware('guest') // Hanya bisa diakses oleh guest (belum login)\n+                ->name('login');\n \n-    // --- Rute Pendaftaran & Pembayaran Publik ---\n-    Route::controller(RegistrationController::class)->group(function () {\n-        Route::get('/daftar-academy', 'createAcademy')->name('register-academy.create');\n-        Route::get('/daftar-ss', 'createSs')->name('register-ss.create');\n-        Route::post('/pendaftaran', 'store')->name('pendaftaran.store');\n-        Route::post('/promo/validate', 'validatePromoCode')->name('promo.validate');\n-    });\n+    Route::post('login', [AdminAuthenticatedSessionController::class, 'store'])\n+                ->middleware('guest');\n     \n-    // Rute daftar ulang\n-    Route::controller(ReRegistrationController::class)->group(function () {\n-        Route::get('/daftar-ulang', 'create')->name('re-register.create');\n-        Route::get('/daftar-ulang-academy', 'createAcademy')->name('re-register-academy.create');\n-        Route::post('/daftar-ulang', 'store')->name('re-register.store');\n-    });\n+    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])\n+                ->middleware('guest')\n+                ->name('password.request');\n \n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-    Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n-    Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n+    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])\n+                ->middleware('guest')\n+                ->name('password.email');\n \n-    // --- Rute Cek Tagihan Publik ---\n-    Route::controller(CheckTagihanController::class)->group(function () {\n-        Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n-        Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n-        Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n-        Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n-        Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay');\n-    });\n+    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])\n+                ->middleware('guest')\n+                ->name('password.reset');\n \n-    // --- Rute Halaman Legal ---\n-    Route::controller(LegalController::class)->group(function () {\n-        Route::get('/syarat-ketentuan', 'terms')->name('legal.terms');\n-        Route::get('/kebijakan-privasi', 'privacy')->name('legal.privacy');\n-        Route::get('/ketentuan-pengembalian', 'refund')->name('legal.refund');\n-    });\n+    Route::post('reset-password', [NewPasswordController::class, 'store'])\n+                ->middleware('guest')\n+                ->name('password.store');\n \n-    // --- Rute Otentikasi Bawaan Laravel ---\n-    Route::get('/dashboard', function () {\n-        if (auth()->check() && auth()->user()->hasRole('siswa')) {\n-            return redirect()->route('siswa.dashboard');\n-        }\n-        if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user', 'super_admin', 'admin_kelas'])) {\n-            return redirect()->route('admin.dashboard');\n-        }\n-        return redirect()->route('welcome');\n-    })->middleware(['auth', 'verified'])->name('dashboard');\n+    Route::middleware(['auth', 'verified'])->group(function () {\n+        \n+        Route::middleware(['role:admin'])->group(function () {\n+            Route::resource('roles', RoleController::class);\n+            Route::resource('permissions', PermissionController::class);\n+            Route::resource('users', UserController::class);\n+            Route::resource('legal-documents', LegalDocumentController::class);\n+            Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n+            Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n+            Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n+        });\n \n-    Route::middleware('auth')->group(function () {\n-        Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n-        Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n-        Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n-    });\n-\n-    require __DIR__.'/auth.php';\n-\n-    // --- Rute Area Admin ---\n-    Route::prefix('admin')->name('admin.')->group(function () {\n-        // Rute login & reset password admin (hanya untuk guest)\n-        Route::middleware('guest')->group(function () {\n-            Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])->name('login');\n-            Route::post('login', [AdminAuthenticatedSessionController::class, 'store']);\n-            Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])->name('password.request');\n-            Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])->name('password.email');\n-            Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])->name('password.reset');\n-            Route::post('reset-password', [NewPasswordController::class, 'store'])->name('password.store');\n+        Route::middleware(['role:admin|user|admin_kelas'])->group(function() {\n+            Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n+            Route::resource('kelas', KelasController::class);\n+            Route::get('siswa/export', [SiswaController::class, 'export'])->name('siswa.export');\n+            Route::post('siswa/import', [SiswaController::class, 'import'])->name('siswa.import');\n+            Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n+            Route::resource('siswa', SiswaController::class);\n+            Route::resource('invoices', InvoiceController::class);\n+            Route::resource('promos', PromoController::class)->except(['show']);\n+            Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n+            Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n+            Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n+            Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n+            Route::get('jobs', [\\App\\Http\\Controllers\\Admin\\JobBatchController::class, 'index'])->name('jobs.index');\n         });\n \n-        // Rute yang memerlukan login admin\n-        Route::middleware(['auth', 'verified'])->group(function () {\n-            // Rute khusus untuk Super Admin & Admin\n-            Route::middleware(['role:super_admin|admin'])->group(function () {\n-                Route::resource('roles', RoleController::class);\n-                Route::resource('permissions', PermissionController::class);\n-                Route::resource('users', UserController::class);\n-                Route::resource('legal-documents', LegalDocumentController::class);\n-                Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n-                Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n-                Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n-            });\n-\n-            // Rute untuk semua jenis admin (termasuk admin kelas)\n-            Route::middleware(['role:super_admin|admin|admin_kelas'])->group(function() {\n-                Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n-                Route::resource('kelas', KelasController::class);\n-                Route::resource('siswa', SiswaController::class);\n-                Route::resource('invoices', InvoiceController::class);\n-                Route::resource('promos', PromoController::class)->except(['show']);\n-                Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n-                Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n-                Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n-                Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n-                Route::get('jobs', [JobBatchController::class, 'index'])->name('jobs.index');\n-            });\n-        });\n     });\n+});\n \n-    // --- Rute Area Siswa ---\n-    Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')->name('siswa.')->group(function () {\n+Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')\n+    ->name('siswa.')->group(function () {\n         Route::get('/dashboard', [SiswaDashboardController::class, 'index'])->name('dashboard');\n+        Route::put('/profil/update-info', [SiswaProfileController::class, 'updateInformation'])->name('profil.update_info');\n+        Route::put('/profil/update-password', [SiswaProfileController::class, 'updatePassword'])->name('profil.update_password');\n         Route::get('/profil', [SiswaProfileController::class, 'show'])->name('profil.show');\n         Route::get('/tagihan', [SiswaTagihanController::class, 'index'])->name('tagihan.index');\n+        Route::post('/invoices/{invoice}/pay', [SiswaTagihanController::class, 'createPaymentToken'])->name('tagihan.pay');\n+        Route::post('/invoices/bulk-pay', [SiswaTagihanController::class, 'createBulkPayment'])->name('invoices.bulk_pay');\n         Route::post('/tagihan/pay', [SiswaTagihanController::class, 'createUnifiedPayment'])->name('invoices.unified_pay');\n-    });\n+});\n \n+Route::controller(CheckTagihanController::class)->group(function () {\n+    Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n+    Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n+    Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n+    Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n+    Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay'); // Route pembayaran baru\n });\n+\n+require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754202388677,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -93,11 +93,20 @@\n Route::get('/daftar-ulang', [ReRegistrationController::class, 'create'])->name('re-register.create');\n Route::get('/daftar-ulang-academy', [ReRegistrationController::class, 'createAcademy'])->name('re-register-academy.create');\n // Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n-Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n+\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n+Route::middleware('web')->group(function () {\n+    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n+    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n+    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n+    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+    Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n+});\n+\n+\n Route::get('/dashboard', function () {\n     if (auth()->check() && auth()->user()->hasRole('siswa')) {\n         return redirect()->route('siswa.dashboard');\n     }\n@@ -108,14 +117,8 @@\n     // Fallback jika tidak ada role yang cocok (seharusnya tidak terjadi jika setup benar)\n     return Inertia::render('Welcome');\n })->middleware(['auth', 'verified'])->name('dashboard');\n \n-Route::middleware('web')->group(function () {\n-    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n-    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n-    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-});\n \n Route::middleware('auth')->group(function () {\n     Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n     Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n"
                },
                {
                    "date": 1754202405418,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,8 +35,17 @@\n use App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\n use App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\n use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n \n+Route::middleware('web')->group(function () {\n+    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n+    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n+    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n+    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+    Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n+});\n+\n+\n Route::get('/', function (Request $request) {\n     return Inertia::render('Welcome', [\n         'canLogin' => Route::has('login'),\n         'canRegister' => Route::has('register'),\n@@ -96,15 +105,8 @@\n Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n \n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n-Route::middleware('web')->group(function () {\n-    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n-    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n-    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-    Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n-});\n \n \n Route::get('/dashboard', function () {\n     if (auth()->check() && auth()->user()->hasRole('siswa')) {\n"
                },
                {
                    "date": 1754202760696,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,9 +39,9 @@\n Route::middleware('web')->group(function () {\n     Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n     Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n     Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n-    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+    Route::get('/pendaftaran/sukses/{siswa}', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n     Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n });\n \n \n"
                },
                {
                    "date": 1754202789646,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,17 +35,9 @@\n use App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\n use App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\n use App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\n \n-Route::middleware('web')->group(function () {\n-    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n-    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n-    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n-    Route::get('/pendaftaran/sukses/{siswa}', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-    Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n-});\n \n-\n Route::get('/', function (Request $request) {\n     return Inertia::render('Welcome', [\n         'canLogin' => Route::has('login'),\n         'canRegister' => Route::has('register'),\n@@ -102,13 +94,18 @@\n Route::get('/daftar-ulang', [ReRegistrationController::class, 'create'])->name('re-register.create');\n Route::get('/daftar-ulang-academy', [ReRegistrationController::class, 'createAcademy'])->name('re-register-academy.create');\n // Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n-\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n+Route::middleware('web')->group(function () {\n+    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n+    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n+    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n+    Route::get('/pendaftaran/sukses/{siswa}', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+    Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n+});\n \n-\n Route::get('/dashboard', function () {\n     if (auth()->check() && auth()->user()->hasRole('siswa')) {\n         return redirect()->route('siswa.dashboard');\n     }\n"
                },
                {
                    "date": 1754202827182,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -96,16 +96,15 @@\n // Route::get('/daftar-ss', [ReRegistrationController::class, 'createSs'])->name('re-register-ss.create');\n Route::post('/daftar-ulang', [ReRegistrationController::class, 'store'])->name('re-register.store');\n Route::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n \n-Route::middleware('web')->group(function () {\n-    Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n-    Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n-    Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n-    Route::get('/pendaftaran/sukses/{siswa}', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n-    Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n-});\n \n+Route::get('/daftar-academy', [RegistrationController::class, 'createAcademy'])->name('register-academy.create');\n+Route::get('/daftar-ss', [RegistrationController::class, 'createSs'])->name('register-ss.create');\n+Route::post('/pendaftaran', [RegistrationController::class, 'store'])->name('pendaftaran.store');\n+Route::get('/pendaftaran/sukses/{siswa}', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n+Route::post('/promo/validate', [RegistrationController::class, 'validatePromoCode'])->name('promo.validate');\n+\n Route::get('/dashboard', function () {\n     if (auth()->check() && auth()->user()->hasRole('siswa')) {\n         return redirect()->route('siswa.dashboard');\n     }\n"
                },
                {
                    "date": 1754378997511,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -197,5 +197,11 @@\n     Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n     Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay'); // Route pembayaran baru\n });\n \n+Route::controller(CekSppController::class)->group(function () {\n+    Route::get('/cek-spp', 'showForm')->name('tagihan.spp.form');\n+    Route::post('/cek-spp', 'findSiswaByPhone')->name('tagihan.spp.find');\n+    Route::get('/cek-spp/{siswa}', 'showTagihan')->name('tagihan.spp.show');\n+});\n+\n require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754379385284,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,8 +10,9 @@\n use App\\Http\\Controllers\\Admin\\Auth\\AuthenticatedSessionController as AdminAuthenticatedSessionController;\n use App\\Http\\Controllers\\WebhookController;\n use App\\Http\\Controllers\\CekTagihanController;\n use App\\Http\\Controllers\\Public\\CheckTagihanController;\n+use App\\Http\\Controllers\\Public\\CekSppController;\n use App\\Http\\Controllers\\PaymentController;\n use App\\Http\\Controllers\\RegistrationController;\n use App\\Http\\Controllers\\DisplayController;\n use App\\Http\\Controllers\\Admin\\DashboardController;\n"
                },
                {
                    "date": 1754380470631,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -202,7 +202,8 @@\n Route::controller(CekSppController::class)->group(function () {\n     Route::get('/cek-spp', 'showForm')->name('tagihan.spp.form');\n     Route::post('/cek-spp', 'findSiswaByPhone')->name('tagihan.spp.find');\n     Route::get('/cek-spp/{siswa}', 'showTagihan')->name('tagihan.spp.show');\n+    Route::post('/cek-spp/{siswa}/pay', 'createSppPayment')->name('tagihan.spp.pay');\n });\n \n require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754382763836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -203,7 +203,8 @@\n     Route::get('/cek-spp', 'showForm')->name('tagihan.spp.form');\n     Route::post('/cek-spp', 'findSiswaByPhone')->name('tagihan.spp.find');\n     Route::get('/cek-spp/{siswa}', 'showTagihan')->name('tagihan.spp.show');\n     Route::post('/cek-spp/{siswa}/pay', 'createSppPayment')->name('tagihan.spp.pay');\n+    Route::get('/cek-spp/sukses/{siswa}', 'showSuccess')->name('tagihan.spp.success');\n });\n \n require __DIR__.'/auth.php';\n"
                },
                {
                    "date": 1754386853284,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -202,8 +202,9 @@\n Route::controller(CekSppController::class)->group(function () {\n     Route::get('/cek-spp', 'showForm')->name('tagihan.spp.form');\n     Route::post('/cek-spp', 'findSiswaByPhone')->name('tagihan.spp.find');\n     Route::get('/cek-spp/{siswa}', 'showTagihan')->name('tagihan.spp.show');\n+    Route::post('/cek-spp/{siswa}/create-user', 'createUserAndLink')->name('tagihan.spp.create_user');\n     Route::post('/cek-spp/{siswa}/pay', 'createSppPayment')->name('tagihan.spp.pay');\n     Route::get('/cek-spp/sukses/{siswa}', 'showSuccess')->name('tagihan.spp.success');\n });\n \n"
                },
                {
                    "date": 1756787316335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,8 +167,9 @@\n             Route::post('siswa/import', [SiswaController::class, 'import'])->name('siswa.import');\n             Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n             Route::resource('siswa', SiswaController::class);\n             Route::resource('invoices', InvoiceController::class);\n+            oute::patch('invoices/{invoice}/mark-as-paid', [InvoiceController::class, 'markAsPaid'])->name('invoices.mark_as_paid');\n             Route::resource('promos', PromoController::class)->except(['show']);\n             Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n             Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n             Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n"
                },
                {
                    "date": 1756787333641,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -168,12 +168,12 @@\n             Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n             Route::resource('siswa', SiswaController::class);\n             Route::resource('invoices', InvoiceController::class);\n             oute::patch('invoices/{invoice}/mark-as-paid', [InvoiceController::class, 'markAsPaid'])->name('invoices.mark_as_paid');\n-            Route::resource('promos', PromoController::class)->except(['show']);\n             Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n             Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n             Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n+            Route::resource('promos', PromoController::class)->except(['show']);\n             Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n             Route::get('jobs', [\\App\\Http\\Controllers\\Admin\\JobBatchController::class, 'index'])->name('jobs.index');\n         });\n \n"
                },
                {
                    "date": 1756787723042,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -167,9 +167,9 @@\n             Route::post('siswa/import', [SiswaController::class, 'import'])->name('siswa.import');\n             Route::get('siswa/generate-nis/{kelas}', [SiswaController::class, 'generateNis'])->name('siswa.generate_nis');\n             Route::resource('siswa', SiswaController::class);\n             Route::resource('invoices', InvoiceController::class);\n-            oute::patch('invoices/{invoice}/mark-as-paid', [InvoiceController::class, 'markAsPaid'])->name('invoices.mark_as_paid');\n+            Route::patch('invoices/{invoice}/mark-as-paid', [InvoiceController::class, 'markAsPaid'])->name('invoices.mark_as_paid');\n             Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n             Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n             Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n             Route::resource('promos', PromoController::class)->except(['show']);\n"
                }
            ],
            "date": 1754202041374,
            "name": "Commit-0",
            "content": "<?php\n\nuse Illuminate\\Support\\Facades\\Route;\nuse Inertia\\Inertia;\n\n// --- Import semua controller di satu tempat ---\nuse App\\Http\\Controllers\\Admin\\ActivityLogController;\nuse App\\Http\\Controllers\\Admin\\Auth\\AuthenticatedSessionController as AdminAuthenticatedSessionController;\nuse App\\Http\\Controllers\\Admin\\Auth\\NewPasswordController;\nuse App\\Http\\Controllers\\Admin\\Auth\\PasswordResetLinkController;\nuse App\\Http\\Controllers\\Admin\\DashboardController;\nuse App\\Http\\Controllers\\Admin\\InvoiceController;\nuse App\\Http\\Controllers\\Admin\\JobBatchController;\nuse App\\Http\\Controllers\\Admin\\KelasController;\nuse App\\Http\\Controllers\\Admin\\LegalDocumentController;\nuse App\\Http\\Controllers\\Admin\\LaporanController;\nuse App\\Http\\Controllers\\Admin\\PermissionController;\nuse App\\Http\\Controllers\\Admin\\PromoController;\nuse App\\Http\\Controllers\\Admin\\RoleController;\nuse App\\Http\\Controllers\\Admin\\SettingsController;\nuse App\\Http\\Controllers\\Admin\\SiswaController;\nuse App\\Http\\Controllers\\Admin\\UserController;\nuse App\\Http\\Controllers\\LegalController;\nuse App\\Http\\Controllers\\PaymentController;\nuse App\\Http\\Controllers\\ProfileController;\nuse App\\Http\\Controllers\\Public\\CheckTagihanController;\nuse App\\Http\\Controllers\\RegistrationController;\nuse App\\Http\\Controllers\\RegistrationSuccessController;\nuse App\\Http\\Controllers\\Siswa\\DashboardController as SiswaDashboardController;\nuse App\\Http\\Controllers\\Siswa\\ProfileController as SiswaProfileController;\nuse App\\Http\\Controllers\\Siswa\\TagihanController as SiswaTagihanController;\nuse App\\Http\\Controllers\\WebhookController;\n\n/*\n|--------------------------------------------------------------------------\n| Web Routes\n|--------------------------------------------------------------------------\n*/\n\n// --- Rute Publik Statis (Tidak Perlu Session) ---\nRoute::get('/', function () {\n    return Inertia::render('Welcome', [\n        'canLogin' => Route::has('login'),\n        'canRegister' => Route::has('register'),\n    ]);\n})->name('welcome');\n\n// --- Rute Webhook (Stateless) ---\n// Webhook dari Xendit tidak memerlukan session atau CSRF, jadi diletakkan di luar grup 'web'.\nRoute::post('/webhooks/xendit/invoice', [WebhookController::class, 'handleInvoiceCallback'])->name('webhooks.xendit.invoice');\n\n\n// --- RUTE YANG MEMERLUKAN SESSION (MIDDLEWARE 'WEB') ---\nRoute::middleware('web')->group(function () {\n\n    // --- Rute Pendaftaran & Pembayaran Publik ---\n    Route::controller(RegistrationController::class)->group(function () {\n        Route::get('/daftar-academy', 'createAcademy')->name('register-academy.create');\n        Route::get('/daftar-ss', 'createSs')->name('register-ss.create');\n        Route::post('/pendaftaran', 'store')->name('pendaftaran.store');\n        Route::post('/promo/validate', 'validatePromoCode')->name('promo.validate');\n    });\n\n    Route::get('/pendaftaran/sukses', [RegistrationSuccessController::class, 'show'])->name('registration.success');\n    Route::get('/pembayaran/sukses', [PaymentController::class, 'success'])->name('payment.success');\n    Route::get('/pembayaran/gagal', [PaymentController::class, 'failure'])->name('payment.failure');\n\n    // --- Rute Cek Tagihan Publik ---\n    Route::controller(CheckTagihanController::class)->group(function () {\n        Route::get('/cek-tagihan', 'showCheckForm')->name('tagihan.check_form');\n        Route::post('/cek-tagihan', 'findSiswa')->name('tagihan.check_status');\n        Route::get('/cek-tagihan/hasil', 'showResult')->name('tagihan.check_result');\n        Route::post('/cek-tagihan/create-user', 'createUserAndLink')->name('tagihan.create_user');\n        Route::post('/cek-tagihan/pay', 'createPublicPayment')->name('tagihan.check_pay');\n    });\n\n    // --- Rute Halaman Legal ---\n    Route::controller(LegalController::class)->group(function () {\n        Route::get('/syarat-ketentuan', 'terms')->name('legal.terms');\n        Route::get('/kebijakan-privasi', 'privacy')->name('legal.privacy');\n        Route::get('/ketentuan-pengembalian', 'refund')->name('legal.refund');\n    });\n\n    // --- Rute Otentikasi Bawaan Laravel ---\n    Route::get('/dashboard', function () {\n        if (auth()->check() && auth()->user()->hasRole('siswa')) {\n            return redirect()->route('siswa.dashboard');\n        }\n        if (auth()->check() && auth()->user()->hasAnyRole(['admin', 'user', 'super_admin', 'admin_kelas'])) {\n            return redirect()->route('admin.dashboard');\n        }\n        return redirect()->route('welcome');\n    })->middleware(['auth', 'verified'])->name('dashboard');\n\n    Route::middleware('auth')->group(function () {\n        Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');\n        Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');\n        Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');\n    });\n\n    require __DIR__.'/auth.php';\n\n    // --- Rute Area Admin ---\n    Route::prefix('admin')->name('admin.')->group(function () {\n        // Rute login & reset password admin (hanya untuk guest)\n        Route::middleware('guest')->group(function () {\n            Route::get('login', [AdminAuthenticatedSessionController::class, 'create'])->name('login');\n            Route::post('login', [AdminAuthenticatedSessionController::class, 'store']);\n            Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])->name('password.request');\n            Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])->name('password.email');\n            Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])->name('password.reset');\n            Route::post('reset-password', [NewPasswordController::class, 'store'])->name('password.store');\n        });\n\n        // Rute yang memerlukan login admin\n        Route::middleware(['auth', 'verified'])->group(function () {\n            // Rute khusus untuk Super Admin & Admin\n            Route::middleware(['role:super_admin|admin'])->group(function () {\n                Route::resource('roles', RoleController::class);\n                Route::resource('permissions', PermissionController::class);\n                Route::resource('users', UserController::class);\n                Route::resource('legal-documents', LegalDocumentController::class);\n                Route::get('settings', [SettingsController::class, 'index'])->name('settings.index');\n                Route::post('settings', [SettingsController::class, 'update'])->name('settings.update');\n                Route::get('activity-log', [ActivityLogController::class, 'index'])->name('activity.index');\n            });\n\n            // Rute untuk semua jenis admin (termasuk admin kelas)\n            Route::middleware(['role:super_admin|admin|admin_kelas'])->group(function() {\n                Route::get('dashboard', [DashboardController::class, 'index'])->name('dashboard');\n                Route::resource('kelas', KelasController::class);\n                Route::resource('siswa', SiswaController::class);\n                Route::resource('invoices', InvoiceController::class);\n                Route::resource('promos', PromoController::class)->except(['show']);\n                Route::post('invoices/{invoice}/recreate', [InvoiceController::class, 'recreate'])->name('invoices.recreate');\n                Route::post('invoices/bulk-store', [InvoiceController::class, 'bulkStore'])->name('invoices.bulk_store');\n                Route::post('invoices/bulk-store-all', [InvoiceController::class, 'bulkStoreAll'])->name('invoices.bulk_store_all');\n                Route::get('laporan/pembayaran-bulanan', [LaporanController::class, 'pembayaranBulanan'])->name('laporan.pembayaran_bulanan');\n                Route::get('jobs', [JobBatchController::class, 'index'])->name('jobs.index');\n            });\n        });\n    });\n\n    // --- Rute Area Siswa ---\n    Route::middleware(['auth', 'verified', 'role:siswa'])->prefix('siswa')->name('siswa.')->group(function () {\n        Route::get('/dashboard', [SiswaDashboardController::class, 'index'])->name('dashboard');\n        Route::get('/profil', [SiswaProfileController::class, 'show'])->name('profil.show');\n        Route::get('/tagihan', [SiswaTagihanController::class, 'index'])->name('tagihan.index');\n        Route::post('/tagihan/pay', [SiswaTagihanController::class, 'createUnifiedPayment'])->name('invoices.unified_pay');\n    });\n\n});\n"
        }
    ]
}