import{c as d,b as n,e,G as ae,k as w,r as U,x as V,d as r,u as s,g as se,l as y,w as h,h as re,S as D,O as L,t as c,m as O,j as b,F as M,f as R,T as oe,n as q}from"./app-B6WrAJDs.js";import{A as le}from"./ApplicationLogo-C24SXVj3.js";import{P as A}from"./PrimaryButton-svTRhClR.js";import{_ as ne,a as v,b as P}from"./TextInput-BoJJOlv8.js";import{_ as ie}from"./Checkbox-C4aagnpD.js";import{r as Y}from"./ArrowPathIcon-TneLPGqb.js";import{r as de}from"./XCircleIcon-CIGuMU9-.js";import{r as W}from"./CheckCircleIcon-CYz1VNS_.js";import{r as ue}from"./CreditCardIcon-xJfiw1HP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ce(u,g){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}const me={class:"relative min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col items-center p-4 sm:p-6"},ge={key:0,class:"fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-50"},pe={class:"w-full max-w-4xl mx-auto z-10 flex-grow flex flex-col overflow-y-auto"},he={class:"text-center mb-8 flex-shrink-0 pt-6"},fe=["src"],xe={class:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8 pb-32"},we={key:0},ye={class:"text-2xl font-bold text-center text-gray-800 dark:text-white"},ke={key:0,class:"absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center rounded-md"},be={key:1,class:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",role:"alert"},ve={class:"flex"},_e={class:"flex-shrink-0"},Se={class:"ml-3"},Ce={class:"text-sm font-medium text-red-800 dark:text-red-300"},Te={key:1},De={class:"text-sm text-gray-500 dark:text-gray-400"},Ae={class:"mt-4 border-t border-gray-200 dark:border-gray-700"},Pe={role:"list",class:"divide-y divide-gray-200 dark:divide-gray-600"},je={class:"flex min-w-0 gap-x-4"},Ue={class:"min-w-0 flex-auto"},Ve={class:"text-sm font-semibold leading-6 text-gray-900 dark:text-white"},Me={class:"mt-1 truncate text-xs leading-5 text-gray-500 dark:text-gray-400"},Ne={key:2},Fe={class:"flex flex-col sm:flex-row justify-between sm:items-center gap-4"},Ie={class:"text-xl font-bold text-gray-900 dark:text-white"},$e={class:"text-sm text-gray-500 dark:text-gray-400"},Be={key:0,class:"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center"},Ee={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},ze={key:1,class:"mt-8 p-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800/50 rounded-lg"},Le={class:"mt-8"},Oe={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},Re=["onClick"],qe={class:"flex-1"},Ye={class:"font-medium text-gray-900 dark:text-white"},We={class:"text-sm text-gray-500 dark:text-gray-400"},Ge={key:1,class:"text-center py-10 text-gray-500 dark:text-gray-400"},Ze={key:0,class:"fixed bottom-0 left-0 right-0 w-full z-40"},Je={class:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 shadow-2xl shadow-slate-400/20"},Ke={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},He={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},Qe={class:"font-semibold text-gray-900 dark:text-white"},Xe={class:"text-lg font-bold text-red-600 dark:text-red-500"},ct={__name:"CekSpp",props:{pageTitle:String,errors:Object,foundSiswa:Array,selectedSiswa:Object,sppInvoices:Array,lastPeriod:String,searchedPhone:String},setup(u){const g=u,_=ae(),N=w(()=>{var o;return(o=_.props.app_settings)!=null&&o.app_logo?`/storage/${_.props.app_settings.app_logo}`:null}),F=w(()=>{var o;return(o=_.props.flash)==null?void 0:o.message}),G=w(()=>{var o;return((o=_.props.flash)==null?void 0:o.type)||"info"}),I=w(()=>F.value&&G.value==="success"),j=U(!1),$=U(!1),k=V({nomor_telepon_wali:g.searchedPhone||""}),l=V({name:"",email:"",password:"",password_confirmation:""}),m=U([]),S=V({periods:[]}),x=w(()=>{if(!g.selectedSiswa)return[];const o=(g.sppInvoices||[]).map(p=>({...p,is_projected:!1})),t=[];let a;if(g.lastPeriod){const p=g.lastPeriod.split("-").map(Number),T=new Date(Date.UTC(p[0],p[1]-1,p[2]));a=new Date(Date.UTC(T.getUTCFullYear(),T.getUTCMonth()+1,1))}else{const p=new Date;a=new Date(Date.UTC(p.getFullYear(),p.getMonth(),1))}let i=a;const f=new Date(Date.UTC(i.getUTCFullYear(),11,31));for(;i<=f;){const p=i.getUTCFullYear(),T=String(i.getUTCMonth()+1).padStart(2,"0"),E=`${p}-${T}-01`,te=new Intl.DateTimeFormat("id-ID",{month:"long",year:"numeric",timeZone:"UTC"}).format(i),z=g.selectedSiswa.jumlah_spp_custom||0;t.push({id:`proj-${E}`,description:`SPP Bulan ${te}`,total_amount:z,total_amount_formatted:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(z),status:"PROJECTED",periode_tagihan:E,is_projected:!0}),i.setUTCMonth(i.getUTCMonth()+1)}return[...o,...t]}),Z=w(()=>{if(m.value.length===0)return 0;const o=x.value.filter(a=>m.value.includes(a.periode_tagihan)).reduce((a,i)=>a+i.total_amount,0),t=g.selectedSiswa.admin_fee_custom||0;return o+t}),J=w(()=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(Z.value)),K=()=>{j.value=!0,k.post(route("tagihan.spp.find"),{onFinish:()=>j.value=!1})},H=()=>{l.post(route("tagihan.spp.create_user",g.selectedSiswa.id_siswa),{preserveScroll:!0,onError:()=>{l.name||l.setError("name","Nama akun wajib diisi."),l.email||l.setError("email","Email wajib diisi."),l.password||l.setError("password","Password wajib diisi.")}})},B=(o,t)=>{const a=x.value.findIndex(i=>i.id===o.id);if(t)(a===0||m.value.includes(x.value[a-1].periode_tagihan))&&m.value.push(o.periode_tagihan);else{const i=x.value.slice(a).map(f=>f.periode_tagihan);m.value=m.value.filter(f=>!i.includes(f))}},C=o=>o===0?!1:!m.value.includes(x.value[o-1].periode_tagihan),Q=()=>{$.value=!0,S.periods=m.value.sort(),S.post(route("tagihan.spp.pay",g.selectedSiswa.id_siswa))},X=o=>({PENDING:"bg-yellow-100 text-yellow-800",PROJECTED:"bg-blue-100 text-blue-800"})[o]||"bg-gray-100 text-gray-800",ee=o=>o?o.split("-")[0].trim():"";return(o,t)=>(n(),d(M,null,[r(s(se),{title:u.pageTitle},null,8,["title"]),e("div",me,[t[18]||(t[18]=e("div",{class:"fixed inset-0 z-0 bg-cover bg-center",style:{"background-image":"url('/images/bg_registration.webp')"}},[e("div",{class:"absolute inset-0 bg-black/50"})],-1)),$.value?(n(),d("div",ge,[r(s(Y),{class:"h-12 w-12 text-white animate-spin"}),t[5]||(t[5]=e("p",{class:"text-white mt-4 text-lg"},"Mengarahkan ke halaman pembayaran...",-1))])):y("",!0),e("main",pe,[e("header",he,[r(s(D),{href:"/",class:"inline-block"},{default:h(()=>[N.value?(n(),d("img",{key:0,src:N.value,alt:"App Logo",class:"h-12 w-auto mx-auto"},null,8,fe)):(n(),re(le,{key:1,class:"h-12 w-auto mx-auto text-white"}))]),_:1})]),e("div",xe,[!u.foundSiswa&&!u.selectedSiswa?(n(),d("div",we,[e("h1",ye,c(u.pageTitle),1),t[6]||(t[6]=e("p",{class:"mt-2 text-center text-gray-600 dark:text-gray-400"},"Masukkan No. Telepon Wali yang terdaftar.",-1)),e("form",{onSubmit:O(K,["prevent"]),class:"mt-6 max-w-md mx-auto space-y-6 relative"},[j.value?(n(),d("div",ke,[r(s(Y),{class:"h-8 w-8 text-gray-500 animate-spin"})])):y("",!0),u.errors.lookup?(n(),d("div",be,[e("div",ve,[e("div",_e,[r(s(de),{class:"h-5 w-5 text-red-400","aria-hidden":"true"})]),e("div",Se,[e("p",Ce,c(u.errors.lookup),1)])])])):y("",!0),e("div",null,[r(ne,{for:"nomor_telepon_wali",value:"No. Telepon Wali"}),r(v,{modelValue:s(k).nomor_telepon_wali,"onUpdate:modelValue":t[0]||(t[0]=a=>s(k).nomor_telepon_wali=a),id:"nomor_telepon_wali",type:"tel",required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),r(P,{message:s(k).errors.nomor_telepon_wali,class:"mt-2"},null,8,["message"])]),e("div",null,[r(A,{type:"submit",disabled:s(k).processing,class:"w-full flex justify-center py-3"},{default:h(()=>[b(c(s(k).processing?"Mencari...":"Cari Siswa"),1)]),_:1},8,["disabled"])])],32),t[7]||(t[7]=L('<div class="mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto"><p> Nomor Anda tidak terdaftar, padahal anak Anda sudah menjadi siswa aktif? <br class="sm:hidden"> Silakan hubungi kami melalui <a href="https://wa.me/62811386846" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400"><span>WhatsApp</span><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 16 16" fill="currentColor"><path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"></path></svg></a>. </p></div>',1))])):u.foundSiswa?(n(),d("div",Te,[t[9]||(t[9]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"Pilih Siswa",-1)),e("p",De,"Ditemukan "+c(u.foundSiswa.length)+" siswa dengan nomor telepon yang sama.",1),e("div",Ae,[e("ul",Pe,[(n(!0),d(M,null,R(u.foundSiswa,a=>(n(),d("li",{key:a.id_siswa,class:"flex items-center justify-between gap-x-6 py-4"},[e("div",je,[r(s(ce),{class:"h-10 w-10 flex-none rounded-full bg-gray-200 dark:bg-gray-700 p-2 text-gray-500"}),e("div",Ue,[e("p",Ve,c(a.nama_siswa),1),e("p",Me,c(a.kelas_nama),1)])]),r(s(D),{href:o.route("tagihan.spp.show",a.id_siswa),class:"rounded-md bg-white px-3 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 dark:bg-gray-700 dark:text-white dark:ring-gray-600 dark:hover:bg-gray-600"},{default:h(()=>t[8]||(t[8]=[b("Pilih")])),_:2,__:[8]},1032,["href"])]))),128))])]),t[10]||(t[10]=L('<div class="mt-8 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 pt-6 max-w-md mx-auto"><p> Bukan siswa yang Anda cari? <br class="sm:hidden"> Silakan hubungi kami melalui <a href="https://wa.me/62811386846" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 font-semibold text-green-600 hover:text-green-500 hover:underline dark:text-green-500 dark:hover:text-green-400"><span>WhatsApp</span><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 16 16" fill="currentColor"><path d="M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"></path></svg></a>. </p></div>',1))])):u.selectedSiswa?(n(),d("div",Ne,[e("div",Fe,[e("div",null,[e("h3",Ie,"Tagihan untuk: "+c(u.selectedSiswa.nama_siswa),1),e("p",$e,"NIS: "+c(u.selectedSiswa.nis),1)]),r(s(D),{href:o.route("tagihan.spp.form"),class:"text-sm text-indigo-600 hover:text-indigo-500"},{default:h(()=>t[11]||(t[11]=[b("← Cari dengan Nomor Lain")])),_:1,__:[11]},8,["href"])]),I.value?(n(),d("div",Be,[r(s(W),{class:"h-12 w-12 text-green-500 mx-auto"}),t[13]||(t[13]=e("h4",{class:"mt-4 font-bold text-gray-800 dark:text-white"},"Akun Berhasil Dibuat!",-1)),e("p",Ee,c(F.value),1),r(s(D),{href:o.route("login"),class:"mt-4 inline-block"},{default:h(()=>[r(A,null,{default:h(()=>t[12]||(t[12]=[b("Masuk Sekarang")])),_:1,__:[12]})]),_:1},8,["href"])])):y("",!0),!u.selectedSiswa.has_user_account&&!I.value?(n(),d("div",ze,[t[14]||(t[14]=e("h4",{class:"font-bold text-gray-800 dark:text-white"},"Lengkapi Akun Anda",-1)),t[15]||(t[15]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},"Buat akun untuk login dan mempermudah pembayaran di kemudian hari.",-1)),e("form",{onSubmit:O(H,["prevent"]),class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start"},[e("div",null,[r(v,{modelValue:s(l).name,"onUpdate:modelValue":t[1]||(t[1]=a=>s(l).name=a),placeholder:"Nama Akun (misal: Budi Ayah Gilang)",required:"",class:"w-full"},null,8,["modelValue"]),r(P,{message:s(l).errors.name,class:"mt-1"},null,8,["message"])]),e("div",null,[r(v,{modelValue:s(l).email,"onUpdate:modelValue":t[2]||(t[2]=a=>s(l).email=a),type:"email",placeholder:"Email (untuk login)",required:"",class:"w-full"},null,8,["modelValue"]),r(P,{message:s(l).errors.email,class:"mt-1"},null,8,["message"])]),e("div",null,[r(v,{modelValue:s(l).password,"onUpdate:modelValue":t[3]||(t[3]=a=>s(l).password=a),type:"password",placeholder:"Password",required:"",class:"w-full"},null,8,["modelValue"]),r(P,{message:s(l).errors.password,class:"mt-1"},null,8,["message"])]),e("div",null,[r(v,{modelValue:s(l).password_confirmation,"onUpdate:modelValue":t[4]||(t[4]=a=>s(l).password_confirmation=a),type:"password",placeholder:"Konfirmasi Password",required:"",class:"w-full"},null,8,["modelValue"])]),r(A,{type:"submit",disabled:s(l).processing,class:"md:col-span-2"},{default:h(()=>[b(c(s(l).processing?"Menyimpan...":"Simpan & Buat Akun"),1)]),_:1},8,["disabled"])],32)])):y("",!0),e("div",Le,[x.value.length>0?(n(),d("div",Oe,[(n(!0),d(M,null,R(x.value,(a,i)=>(n(),d("div",{key:a.id,onClick:f=>!C(i)&&B(a,!m.value.includes(a.periode_tagihan)),class:q(["bg-white/50 dark:bg-gray-900/50 rounded-lg shadow-sm transition-all duration-200 p-4 flex items-center space-x-4",{"bg-slate-200 dark:bg-slate-700":m.value.includes(a.periode_tagihan),"cursor-pointer hover:shadow-md":!C(i),"opacity-50 cursor-not-allowed":C(i)}])},[r(ie,{checked:m.value.includes(a.periode_tagihan),"onUpdate:checked":f=>B(a,f),disabled:C(i)},null,8,["checked","onUpdate:checked","disabled"]),e("div",qe,[e("p",Ye,c(ee(a.description)),1),e("p",We,c(a.total_amount_formatted),1)]),e("span",{class:q(["px-2 py-0.5 text-xs font-semibold rounded-full",X(a.status)])},c(a.is_projected?"Proyeksi":"Tersedia"),3)],10,Re))),128))])):(n(),d("div",Ge,[r(s(W),{class:"mx-auto h-12 w-12 text-green-400"}),t[16]||(t[16]=e("p",{class:"mt-2 font-medium"},"Semua tagihan lunas!",-1)),t[17]||(t[17]=e("p",{class:"text-sm"},"Tidak ada tagihan yang perlu dibayar saat ini.",-1))]))])])):y("",!0)]),r(oe,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"transform opacity-0 translate-y-full","enter-to-class":"transform opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform opacity-100 translate-y-0","leave-to-class":"transform opacity-0 translate-y-full"},{default:h(()=>[u.selectedSiswa&&m.value.length>0?(n(),d("div",Ze,[e("div",Je,[e("div",Ke,[e("div",He,[e("div",null,[e("h4",Qe,c(m.value.length)+" bulan tagihan dipilih",1),e("p",Xe,c(J.value),1)]),r(A,{onClick:Q,disabled:s(S).processing,class:"w-full sm:w-auto"},{default:h(()=>[r(s(ue),{class:"h-5 w-5 mr-2"}),b(" "+c(s(S).processing?"Memproses...":"Lanjutkan ke Pembayaran"),1)]),_:1},8,["disabled"])])])])])):y("",!0)]),_:1})])])],64))}};export{ct as default};
