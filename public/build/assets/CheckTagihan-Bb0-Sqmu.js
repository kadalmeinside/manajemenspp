import{G as ee,k as w,r as U,x as V,c as u,b as n,d as o,e,u as s,g as te,l as x,w as h,h as ae,S as j,t as c,m as L,j as k,F as B,f as se,T as le,n as q}from"./app-BR2b6J22.js";import{A as oe}from"./ApplicationLogo-CZEB-oPw.js";import{P as S}from"./PrimaryButton-DFs1nnD9.js";import{_ as R,a as y,b as v}from"./TextInput-D77RpWHp.js";import{_ as re}from"./Checkbox-Bi1j7L73.js";import{r as Y}from"./ArrowPathIcon-CAmCCX6H.js";import{r as ie}from"./XCircleIcon-CzEs8atg.js";import{r as ne}from"./CheckCircleIcon-DVVzPKsO.js";import{r as de}from"./CreditCardIcon-CRgMwfMT.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"relative min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col items-center p-4 sm:p-6"},ce={key:0,class:"fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-50"},me={class:"w-full max-w-4xl mx-auto z-10 flex-grow flex flex-col overflow-y-auto"},ge={class:"text-center mb-8 flex-shrink-0 pt-6"},pe=["src"],fe={class:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8 pb-32"},he={key:0},_e={class:"text-2xl font-bold text-center text-gray-800 dark:text-white"},we={key:0,class:"absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center rounded-md"},xe={key:1,class:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",role:"alert"},be={class:"flex"},ye={class:"flex-shrink-0"},ke={class:"ml-3"},ve={class:"text-sm font-medium text-red-800 dark:text-red-300"},Te={key:1},Ce={class:"flex flex-col sm:flex-row justify-between sm:items-center gap-4"},De={class:"text-xl font-bold text-gray-900 dark:text-white"},Se={class:"text-sm text-gray-500 dark:text-gray-400"},Pe={key:0,class:"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center"},Ue={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Ve={key:1,class:"mt-8 p-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800/50 rounded-lg"},je={class:"mt-8"},Fe={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},Ie=["onClick"],Me={class:"flex-1"},Ne={class:"font-medium text-gray-900 dark:text-white"},$e={class:"text-sm text-gray-500 dark:text-gray-400"},Ae={key:0,class:"fixed bottom-0 left-0 right-0 w-full z-40"},Ee={class:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 shadow-2xl shadow-slate-400/20"},Le={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Be={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},qe={class:"font-semibold text-gray-900 dark:text-white"},Re={class:"text-lg font-bold text-red-600 dark:text-red-500"},et={__name:"CheckTagihan",props:{pageTitle:String,errors:Object,siswa:Object,sppInvoices:Array,lastPaidPeriod:String},setup(g){const b=g,T=ee(),F=w(()=>{var l;return(l=T.props.app_settings)!=null&&l.app_logo?`/storage/${T.props.app_settings.app_logo}`:null}),I=w(()=>{var l;return(l=T.props.flash)==null?void 0:l.message}),z=w(()=>{var l;return((l=T.props.flash)==null?void 0:l.type)||"info"}),M=w(()=>I.value&&z.value==="success"),P=U(!1),N=U(!1),p=V({nomor_telepon_wali:"",tanggal_lahir:""}),r=V({name:"",email:"",password:"",password_confirmation:""}),d=U([]),C=V({periods:[]}),_=w(()=>{if(!b.siswa)return[];const l=(b.sppInvoices||[]).map(m=>({...m,is_projected:!1})),t=[];let a;if(l.length>0){const m=new Date(l[l.length-1].periode_tagihan);a=new Date(Date.UTC(m.getUTCFullYear(),m.getUTCMonth()+1,1))}else if(b.lastPaidPeriod){const m=new Date(b.lastPaidPeriod);a=new Date(Date.UTC(m.getUTCFullYear(),m.getUTCMonth()+1,1))}else{const m=new Date;a=new Date(Date.UTC(m.getFullYear(),m.getMonth(),1))}let i=a;const f=new Date(Date.UTC(i.getUTCFullYear(),11,31));for(;i<=f;){const m=i.getUTCFullYear(),Q=String(i.getUTCMonth()+1).padStart(2,"0"),A=`${m}-${Q}-01`,X=new Intl.DateTimeFormat("id-ID",{month:"long",year:"numeric",timeZone:"UTC"}).format(i),E=b.siswa.jumlah_spp_custom||0;t.push({id:`proj-${A}`,description:`SPP Bulan ${X}`,total_amount:E,total_amount_formatted:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(E),status:"PROJECTED",periode_tagihan:A,is_projected:!0}),i.setUTCMonth(i.getUTCMonth()+1)}return[...l,...t]}),O=w(()=>{if(d.value.length===0)return 0;const l=_.value.filter(a=>d.value.includes(a.periode_tagihan)).reduce((a,i)=>a+i.total_amount,0),t=b.siswa.admin_fee_custom||0;return l+t}),G=w(()=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(O.value)),J=()=>{P.value=!0,p.post(route("tagihan.check_status"),{onFinish:()=>P.value=!1})},W=()=>{r.post(route("tagihan.create_user"),{preserveScroll:!0,onError:()=>{r.name||r.setError("name","Nama akun wajib diisi."),r.email||r.setError("email","Email wajib diisi."),r.password||r.setError("password","Password wajib diisi.")}})},$=(l,t)=>{const a=_.value.findIndex(i=>i.id===l.id);if(t)(a===0||d.value.includes(_.value[a-1].periode_tagihan))&&d.value.push(l.periode_tagihan);else{const i=_.value.slice(a).map(f=>f.periode_tagihan);d.value=d.value.filter(f=>!i.includes(f))}},D=l=>l===0?!1:!d.value.includes(_.value[l-1].periode_tagihan),K=()=>{N.value=!0,C.periods=d.value.sort(),C.post(route("tagihan.check_pay"))},Z=l=>({PENDING:"bg-yellow-100 text-yellow-800",PROJECTED:"bg-blue-100 text-blue-800"})[l]||"bg-gray-100 text-gray-800",H=l=>l?l.split("-")[0].trim():"";return(l,t)=>(n(),u(B,null,[o(s(te),{title:g.pageTitle},null,8,["title"]),e("div",ue,[t[13]||(t[13]=e("div",{class:"fixed inset-0 z-0 bg-cover bg-center",style:{"background-image":"url('/images/bg_registration.webp')"}},[e("div",{class:"absolute inset-0 bg-black/50"})],-1)),N.value?(n(),u("div",ce,[o(s(Y),{class:"h-12 w-12 text-white animate-spin"}),t[6]||(t[6]=e("p",{class:"text-white mt-4 text-lg"},"Mengarahkan ke halaman pembayaran...",-1))])):x("",!0),e("main",me,[e("header",ge,[o(s(j),{href:"/",class:"inline-block"},{default:h(()=>[F.value?(n(),u("img",{key:0,src:F.value,alt:"App Logo",class:"h-12 w-auto mx-auto"},null,8,pe)):(n(),ae(oe,{key:1,class:"h-12 w-auto mx-auto text-white"}))]),_:1})]),e("div",fe,[g.siswa?(n(),u("div",Te,[e("div",Ce,[e("div",null,[e("h3",De,"Tagihan untuk: "+c(g.siswa.nama_siswa),1),e("p",Se,"NIS: "+c(g.siswa.nis),1)]),o(s(j),{href:l.route("tagihan.check_form"),class:"text-sm text-indigo-600 hover:text-indigo-500"},{default:h(()=>t[8]||(t[8]=[k(" â† Cari Siswa Lain ")])),_:1,__:[8]},8,["href"])]),M.value?(n(),u("div",Pe,[o(s(ne),{class:"h-12 w-12 text-green-500 mx-auto"}),t[10]||(t[10]=e("h4",{class:"mt-4 font-bold text-gray-800 dark:text-white"},"Pendaftaran Akun Berhasil!",-1)),e("p",Ue,c(I.value),1),o(s(j),{href:l.route("login"),class:"mt-4 inline-block"},{default:h(()=>[o(S,null,{default:h(()=>t[9]||(t[9]=[k("Masuk Sekarang")])),_:1,__:[9]})]),_:1},8,["href"])])):x("",!0),!g.siswa.has_user_account&&!M.value?(n(),u("div",Ve,[t[11]||(t[11]=e("h4",{class:"font-bold text-gray-800 dark:text-white"},"Lengkapi Akun Anda",-1)),t[12]||(t[12]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},"Buat akun untuk login dan mempermudah pembayaran di kemudian hari.",-1)),e("form",{onSubmit:L(W,["prevent"]),class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start"},[e("div",null,[o(y,{modelValue:s(r).name,"onUpdate:modelValue":t[2]||(t[2]=a=>s(r).name=a),placeholder:"Nama Akun (misal: Budi Ayah Gilang)",required:"",class:"w-full"},null,8,["modelValue"]),o(v,{message:s(r).errors.name,class:"mt-1"},null,8,["message"])]),e("div",null,[o(y,{modelValue:s(r).email,"onUpdate:modelValue":t[3]||(t[3]=a=>s(r).email=a),type:"email",placeholder:"Email (untuk login)",required:"",class:"w-full"},null,8,["modelValue"]),o(v,{message:s(r).errors.email,class:"mt-1"},null,8,["message"])]),e("div",null,[o(y,{modelValue:s(r).password,"onUpdate:modelValue":t[4]||(t[4]=a=>s(r).password=a),type:"password",placeholder:"Password",required:"",class:"w-full"},null,8,["modelValue"]),o(v,{message:s(r).errors.password,class:"mt-1"},null,8,["message"])]),e("div",null,[o(y,{modelValue:s(r).password_confirmation,"onUpdate:modelValue":t[5]||(t[5]=a=>s(r).password_confirmation=a),type:"password",placeholder:"Konfirmasi Password",required:"",class:"w-full"},null,8,["modelValue"])]),o(S,{type:"submit",disabled:s(r).processing,class:"md:col-span-2"},{default:h(()=>[k(c(s(r).processing?"Menyimpan...":"Simpan & Buat Akun"),1)]),_:1},8,["disabled"])],32)])):x("",!0),e("div",je,[_.value.length>0?(n(),u("div",Fe,[(n(!0),u(B,null,se(_.value,(a,i)=>(n(),u("div",{key:a.id,onClick:f=>!D(i)&&$(a,!d.value.includes(a.periode_tagihan)),class:q(["bg-white/50 dark:bg-gray-900/50 rounded-lg shadow-sm transition-all duration-200 p-4 flex items-center space-x-4",{"bg-slate-200 dark:bg-slate-700":d.value.includes(a.periode_tagihan),"cursor-pointer hover:shadow-md":!D(i),"opacity-50 cursor-not-allowed":D(i)}])},[o(re,{checked:d.value.includes(a.periode_tagihan),"onUpdate:checked":f=>$(a,f),disabled:D(i)},null,8,["checked","onUpdate:checked","disabled"]),e("div",Me,[e("p",Ne,c(H(a.description)),1),e("p",$e,c(a.total_amount_formatted),1)]),e("span",{class:q(["px-2 py-0.5 text-xs font-semibold rounded-full",Z(a.status)])},c(a.is_projected?"Proyeksi":"Tersedia"),3)],10,Ie))),128))])):x("",!0)])])):(n(),u("div",he,[e("h1",_e,c(g.pageTitle),1),t[7]||(t[7]=e("p",{class:"mt-2 text-center text-gray-600 dark:text-gray-400"},"Masukkan No. Telepon Wali dan Tanggal Lahir Siswa.",-1)),e("form",{onSubmit:L(J,["prevent"]),class:"mt-6 max-w-md mx-auto space-y-6 relative"},[P.value?(n(),u("div",we,[o(s(Y),{class:"h-8 w-8 text-gray-500 animate-spin"})])):x("",!0),g.errors.lookup?(n(),u("div",xe,[e("div",be,[e("div",ye,[o(s(ie),{class:"h-5 w-5 text-red-400","aria-hidden":"true"})]),e("div",ke,[e("p",ve,c(g.errors.lookup),1)])])])):x("",!0),e("div",null,[o(R,{for:"nomor_telepon_wali",value:"No. Telepon Wali"}),o(y,{modelValue:s(p).nomor_telepon_wali,"onUpdate:modelValue":t[0]||(t[0]=a=>s(p).nomor_telepon_wali=a),id:"nomor_telepon_wali",type:"text",required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),o(v,{message:s(p).errors.nomor_telepon_wali,class:"mt-2"},null,8,["message"])]),e("div",null,[o(R,{for:"tanggal_lahir",value:"Tanggal Lahir Siswa"}),o(y,{modelValue:s(p).tanggal_lahir,"onUpdate:modelValue":t[1]||(t[1]=a=>s(p).tanggal_lahir=a),id:"tanggal_lahir",type:"date",required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),o(v,{message:s(p).errors.tanggal_lahir,class:"mt-2"},null,8,["message"])]),e("div",null,[o(S,{type:"submit",disabled:s(p).processing,class:"w-full flex justify-center py-3"},{default:h(()=>[k(c(s(p).processing?"Mencari...":"Cek Tagihan"),1)]),_:1},8,["disabled"])])],32)]))]),o(le,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"transform opacity-0 translate-y-full","enter-to-class":"transform opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform opacity-100 translate-y-0","leave-to-class":"transform opacity-0 translate-y-full"},{default:h(()=>[g.siswa&&d.value.length>0?(n(),u("div",Ae,[e("div",Ee,[e("div",Le,[e("div",Be,[e("div",null,[e("h4",qe,c(d.value.length)+" bulan tagihan dipilih",1),e("p",Re,c(G.value),1)]),o(S,{onClick:K,disabled:s(C).processing,class:"w-full sm:w-auto"},{default:h(()=>[o(s(de),{class:"h-5 w-5 mr-2"}),k(" "+c(s(C).processing?"Memproses...":"Lanjutkan ke Pembayaran"),1)]),_:1},8,["disabled"])])])])])):x("",!0)]),_:1})])])],64))}};export{et as default};
