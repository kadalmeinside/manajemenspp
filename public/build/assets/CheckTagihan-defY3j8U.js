import{c as d,b as i,e,G as ee,k as x,r as U,x as V,d as o,u as s,g as te,l as b,w as h,h as ae,S as j,t as c,m as B,j as y,F as L,f as se,T as le,n as q}from"./app-Cmjz_kjm.js";import{A as oe}from"./ApplicationLogo-DJ1kvjpN.js";import{P as S}from"./PrimaryButton-CvSK1u4D.js";import{_ as R,a as v,b as k}from"./TextInput-BplOqhyk.js";import{_ as re}from"./Checkbox-BVCd6qf-.js";import{r as ne}from"./XCircleIcon-ClDNVO2M.js";import{r as ie}from"./CheckCircleIcon-DtLzAiXK.js";import{r as de}from"./CreditCardIcon-ckVeLYnM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function Y(g,w){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}const ue={class:"relative min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col items-center p-4 sm:p-6"},ce={key:0,class:"fixed inset-0 bg-black/70 flex flex-col items-center justify-center z-50"},me={class:"w-full max-w-4xl mx-auto z-10 flex-grow flex flex-col overflow-y-auto"},ge={class:"text-center mb-8 flex-shrink-0 pt-6"},pe=["src"],fe={class:"bg-white/80 dark:bg-gray-800/80 backdrop-blur-lg shadow-2xl rounded-xl p-6 md:p-8 pb-32"},he={key:0},we={class:"text-2xl font-bold text-center text-gray-800 dark:text-white"},_e={key:0,class:"absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center rounded-md"},xe={key:1,class:"bg-red-50 dark:bg-red-900/20 border-l-4 border-red-400 p-4",role:"alert"},be={class:"flex"},ve={class:"flex-shrink-0"},ye={class:"ml-3"},ke={class:"text-sm font-medium text-red-800 dark:text-red-300"},Te={key:1},Ce={class:"flex flex-col sm:flex-row justify-between sm:items-center gap-4"},De={class:"text-xl font-bold text-gray-900 dark:text-white"},Se={class:"text-sm text-gray-500 dark:text-gray-400"},Pe={key:0,class:"mt-8 p-6 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800/50 rounded-lg text-center"},Ue={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},Ve={key:1,class:"mt-8 p-6 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800/50 rounded-lg"},je={class:"mt-8"},Fe={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},Ie=["onClick"],Me={class:"flex-1"},Ne={class:"font-medium text-gray-900 dark:text-white"},$e={class:"text-sm text-gray-500 dark:text-gray-400"},Ae={key:0,class:"fixed bottom-0 left-0 right-0 w-full z-40"},Ee={class:"bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 shadow-2xl shadow-slate-400/20"},Be={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Le={class:"flex flex-col sm:flex-row items-center justify-between gap-4"},qe={class:"font-semibold text-gray-900 dark:text-white"},Re={class:"text-lg font-bold text-red-600 dark:text-red-500"},Xe={__name:"CheckTagihan",props:{pageTitle:String,errors:Object,siswa:Object,sppInvoices:Array,lastPaidPeriod:String},setup(g){const w=g,T=ee(),F=x(()=>{var l;return(l=T.props.app_settings)!=null&&l.app_logo?`/storage/${T.props.app_settings.app_logo}`:null}),I=x(()=>{var l;return(l=T.props.flash)==null?void 0:l.message}),z=x(()=>{var l;return((l=T.props.flash)==null?void 0:l.type)||"info"}),M=x(()=>I.value&&z.value==="success"),P=U(!1),N=U(!1),p=V({nomor_telepon_wali:"",tanggal_lahir:""}),r=V({name:"",email:"",password:"",password_confirmation:""}),u=U([]),C=V({periods:[]}),_=x(()=>{if(!w.siswa)return[];const l=(w.sppInvoices||[]).map(m=>({...m,is_projected:!1})),t=[];let a;if(l.length>0){const m=new Date(l[l.length-1].periode_tagihan);a=new Date(Date.UTC(m.getUTCFullYear(),m.getUTCMonth()+1,1))}else if(w.lastPaidPeriod){const m=new Date(w.lastPaidPeriod);a=new Date(Date.UTC(m.getUTCFullYear(),m.getUTCMonth()+1,1))}else{const m=new Date;a=new Date(Date.UTC(m.getFullYear(),m.getMonth(),1))}let n=a;const f=new Date(Date.UTC(n.getUTCFullYear(),11,31));for(;n<=f;){const m=n.getUTCFullYear(),Q=String(n.getUTCMonth()+1).padStart(2,"0"),A=`${m}-${Q}-01`,X=new Intl.DateTimeFormat("id-ID",{month:"long",year:"numeric",timeZone:"UTC"}).format(n),E=w.siswa.jumlah_spp_custom||0;t.push({id:`proj-${A}`,description:`SPP Bulan ${X}`,total_amount:E,total_amount_formatted:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(E),status:"PROJECTED",periode_tagihan:A,is_projected:!0}),n.setUTCMonth(n.getUTCMonth()+1)}return[...l,...t]}),O=x(()=>{if(u.value.length===0)return 0;const l=_.value.filter(a=>u.value.includes(a.periode_tagihan)).reduce((a,n)=>a+n.total_amount,0),t=w.siswa.admin_fee_custom||0;return l+t}),G=x(()=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(O.value)),J=()=>{P.value=!0,p.post(route("tagihan.check_status"),{onFinish:()=>P.value=!1})},W=()=>{r.post(route("tagihan.create_user"),{preserveScroll:!0,onError:()=>{r.name||r.setError("name","Nama akun wajib diisi."),r.email||r.setError("email","Email wajib diisi."),r.password||r.setError("password","Password wajib diisi.")}})},$=(l,t)=>{const a=_.value.findIndex(n=>n.id===l.id);if(t)(a===0||u.value.includes(_.value[a-1].periode_tagihan))&&u.value.push(l.periode_tagihan);else{const n=_.value.slice(a).map(f=>f.periode_tagihan);u.value=u.value.filter(f=>!n.includes(f))}},D=l=>l===0?!1:!u.value.includes(_.value[l-1].periode_tagihan),K=()=>{N.value=!0,C.periods=u.value.sort(),C.post(route("tagihan.check_pay"))},Z=l=>({PENDING:"bg-yellow-100 text-yellow-800",PROJECTED:"bg-blue-100 text-blue-800"})[l]||"bg-gray-100 text-gray-800",H=l=>l?l.split("-")[0].trim():"";return(l,t)=>(i(),d(L,null,[o(s(te),{title:g.pageTitle},null,8,["title"]),e("div",ue,[t[13]||(t[13]=e("div",{class:"fixed inset-0 z-0 bg-cover bg-center",style:{"background-image":"url('/images/bg_registration.webp')"}},[e("div",{class:"absolute inset-0 bg-black/50"})],-1)),N.value?(i(),d("div",ce,[o(s(Y),{class:"h-12 w-12 text-white animate-spin"}),t[6]||(t[6]=e("p",{class:"text-white mt-4 text-lg"},"Mengarahkan ke halaman pembayaran...",-1))])):b("",!0),e("main",me,[e("header",ge,[o(s(j),{href:"/",class:"inline-block"},{default:h(()=>[F.value?(i(),d("img",{key:0,src:F.value,alt:"App Logo",class:"h-12 w-auto mx-auto"},null,8,pe)):(i(),ae(oe,{key:1,class:"h-12 w-auto mx-auto text-white"}))]),_:1})]),e("div",fe,[g.siswa?(i(),d("div",Te,[e("div",Ce,[e("div",null,[e("h3",De,"Tagihan untuk: "+c(g.siswa.nama_siswa),1),e("p",Se,"NIS: "+c(g.siswa.nis),1)]),o(s(j),{href:l.route("tagihan.check_form"),class:"text-sm text-indigo-600 hover:text-indigo-500"},{default:h(()=>t[8]||(t[8]=[y(" ← Cari Siswa Lain ")])),_:1,__:[8]},8,["href"])]),M.value?(i(),d("div",Pe,[o(s(ie),{class:"h-12 w-12 text-green-500 mx-auto"}),t[10]||(t[10]=e("h4",{class:"mt-4 font-bold text-gray-800 dark:text-white"},"Pendaftaran Akun Berhasil!",-1)),e("p",Ue,c(I.value),1),o(s(j),{href:l.route("login"),class:"mt-4 inline-block"},{default:h(()=>[o(S,null,{default:h(()=>t[9]||(t[9]=[y("Masuk Sekarang")])),_:1,__:[9]})]),_:1},8,["href"])])):b("",!0),!g.siswa.has_user_account&&!M.value?(i(),d("div",Ve,[t[11]||(t[11]=e("h4",{class:"font-bold text-gray-800 dark:text-white"},"Lengkapi Akun Anda",-1)),t[12]||(t[12]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},"Buat akun untuk login dan mempermudah pembayaran di kemudian hari.",-1)),e("form",{onSubmit:B(W,["prevent"]),class:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 items-start"},[e("div",null,[o(v,{modelValue:s(r).name,"onUpdate:modelValue":t[2]||(t[2]=a=>s(r).name=a),placeholder:"Nama Akun (misal: Budi Ayah Gilang)",required:"",class:"w-full"},null,8,["modelValue"]),o(k,{message:s(r).errors.name,class:"mt-1"},null,8,["message"])]),e("div",null,[o(v,{modelValue:s(r).email,"onUpdate:modelValue":t[3]||(t[3]=a=>s(r).email=a),type:"email",placeholder:"Email (untuk login)",required:"",class:"w-full"},null,8,["modelValue"]),o(k,{message:s(r).errors.email,class:"mt-1"},null,8,["message"])]),e("div",null,[o(v,{modelValue:s(r).password,"onUpdate:modelValue":t[4]||(t[4]=a=>s(r).password=a),type:"password",placeholder:"Password",required:"",class:"w-full"},null,8,["modelValue"]),o(k,{message:s(r).errors.password,class:"mt-1"},null,8,["message"])]),e("div",null,[o(v,{modelValue:s(r).password_confirmation,"onUpdate:modelValue":t[5]||(t[5]=a=>s(r).password_confirmation=a),type:"password",placeholder:"Konfirmasi Password",required:"",class:"w-full"},null,8,["modelValue"])]),o(S,{type:"submit",disabled:s(r).processing,class:"md:col-span-2"},{default:h(()=>[y(c(s(r).processing?"Menyimpan...":"Simpan & Buat Akun"),1)]),_:1},8,["disabled"])],32)])):b("",!0),e("div",je,[_.value.length>0?(i(),d("div",Fe,[(i(!0),d(L,null,se(_.value,(a,n)=>(i(),d("div",{key:a.id,onClick:f=>!D(n)&&$(a,!u.value.includes(a.periode_tagihan)),class:q(["bg-white/50 dark:bg-gray-900/50 rounded-lg shadow-sm transition-all duration-200 p-4 flex items-center space-x-4",{"bg-slate-200 dark:bg-slate-700":u.value.includes(a.periode_tagihan),"cursor-pointer hover:shadow-md":!D(n),"opacity-50 cursor-not-allowed":D(n)}])},[o(re,{checked:u.value.includes(a.periode_tagihan),"onUpdate:checked":f=>$(a,f),disabled:D(n)},null,8,["checked","onUpdate:checked","disabled"]),e("div",Me,[e("p",Ne,c(H(a.description)),1),e("p",$e,c(a.total_amount_formatted),1)]),e("span",{class:q(["px-2 py-0.5 text-xs font-semibold rounded-full",Z(a.status)])},c(a.is_projected?"Proyeksi":"Tersedia"),3)],10,Ie))),128))])):b("",!0)])])):(i(),d("div",he,[e("h1",we,c(g.pageTitle),1),t[7]||(t[7]=e("p",{class:"mt-2 text-center text-gray-600 dark:text-gray-400"},"Masukkan No. Telepon Wali dan Tanggal Lahir Siswa.",-1)),e("form",{onSubmit:B(J,["prevent"]),class:"mt-6 max-w-md mx-auto space-y-6 relative"},[P.value?(i(),d("div",_e,[o(s(Y),{class:"h-8 w-8 text-gray-500 animate-spin"})])):b("",!0),g.errors.lookup?(i(),d("div",xe,[e("div",be,[e("div",ve,[o(s(ne),{class:"h-5 w-5 text-red-400","aria-hidden":"true"})]),e("div",ye,[e("p",ke,c(g.errors.lookup),1)])])])):b("",!0),e("div",null,[o(R,{for:"nomor_telepon_wali",value:"No. Telepon Wali"}),o(v,{modelValue:s(p).nomor_telepon_wali,"onUpdate:modelValue":t[0]||(t[0]=a=>s(p).nomor_telepon_wali=a),id:"nomor_telepon_wali",type:"text",required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),o(k,{message:s(p).errors.nomor_telepon_wali,class:"mt-2"},null,8,["message"])]),e("div",null,[o(R,{for:"tanggal_lahir",value:"Tanggal Lahir Siswa"}),o(v,{modelValue:s(p).tanggal_lahir,"onUpdate:modelValue":t[1]||(t[1]=a=>s(p).tanggal_lahir=a),id:"tanggal_lahir",type:"date",required:"",class:"mt-1 block w-full"},null,8,["modelValue"]),o(k,{message:s(p).errors.tanggal_lahir,class:"mt-2"},null,8,["message"])]),e("div",null,[o(S,{type:"submit",disabled:s(p).processing,class:"w-full flex justify-center py-3"},{default:h(()=>[y(c(s(p).processing?"Mencari...":"Cek Tagihan"),1)]),_:1},8,["disabled"])])],32)]))]),o(le,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"transform opacity-0 translate-y-full","enter-to-class":"transform opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform opacity-100 translate-y-0","leave-to-class":"transform opacity-0 translate-y-full"},{default:h(()=>[g.siswa&&u.value.length>0?(i(),d("div",Ae,[e("div",Ee,[e("div",Be,[e("div",Le,[e("div",null,[e("h4",qe,c(u.value.length)+" bulan tagihan dipilih",1),e("p",Re,c(G.value),1)]),o(S,{onClick:K,disabled:s(C).processing,class:"w-full sm:w-auto"},{default:h(()=>[o(s(de),{class:"h-5 w-5 mr-2"}),y(" "+c(s(C).processing?"Memproses...":"Lanjutkan ke Pembayaran"),1)]),_:1},8,["disabled"])])])])])):b("",!0)]),_:1})])])],64))}};export{Xe as default};
