import{D as X,c as k,j as h,x as Y,q as L,m as Z,a as n,o as d,b as o,u as a,g as ee,w as m,d as s,e as p,f as q,B as se,F as U,r as P,t as g,C as te,i as v,S as re,n as N,h as ae,Q as C}from"./app-DTOZ3zsH.js";import{A as oe}from"./AuthenticatedLayout-CZg4ZEOp.js";import{P as B}from"./PrimaryButton-CTuY8E2Y.js";import{_ as F,a as j}from"./Modal-Csx7A8p6.js";import{D as le}from"./DangerButton-NhoTXmWP.js";import{a as S,_ as V,b as M}from"./TextInput-PqLkJz5Q.js";import{_ as de}from"./Checkbox-CJ71VPpM.js";import{_ as ne}from"./Toast-sEvPeIUI.js";import{l as ie}from"./lodash-CX8nwrGi.js";import{r as ue}from"./PlusIcon-Czn359QC.js";import{r as me}from"./PencilIcon-DPUONLZ6.js";import{r as ce}from"./TrashIcon-lNUNpr8a.js";import"./ApplicationLogo-Cp59Ii8x.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserCircleIcon-Da93_6Nd.js";import"./ArrowPathIcon-BmVieaQ0.js";import"./CheckCircleIcon-mXPivvxl.js";import"./XCircleIcon-C0R5r3qY.js";const pe={class:"pb-12 pt-4"},ge={class:"max-w-7xl mx-auto"},fe={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},xe={class:"p-6 text-gray-900 dark:text-gray-100"},ve={class:"mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4"},_e={class:"flex flex-col sm:flex-row items-center gap-3 flex-grow"},ye=["value"],we={class:"overflow-x-auto"},be={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ke={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},he={key:0},Ue={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300"},Se={class:"px-6 py-4 whitespace-nowrap text-sm"},Ve={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},Me={key:1,class:"text-xs text-gray-400"},Ee={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Re=["onClick"],De=["onClick"],$e={key:0,class:"p-4 border-t border-gray-200 dark:border-gray-700"},Pe={class:"flex flex-wrap -mb-1 justify-center"},Te=["innerHTML"],Ae={class:"p-6"},Le={class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4 border-b pb-3 dark:border-gray-700"},Ne={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},qe={key:0},Be={key:1},Fe={class:"mt-2 grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-2 max-h-32 overflow-y-auto p-2 border dark:border-gray-700 rounded-md"},je={class:"text-sm text-gray-700 dark:text-gray-300"},He={class:"mt-6 flex justify-end space-x-3 pt-4 border-t dark:border-gray-700"},Oe={class:"p-6"},Qe={class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},Ie={class:"font-semibold"},We={class:"mt-6 flex justify-end space-x-3"},cs={__name:"Index",setup(ze){const f=X(),u=k(()=>f.props.users),E=k(()=>f.props.filters||{}),R=k(()=>f.props.allRoles||[]),T=k(()=>f.props.can||{}),H=k(()=>{var l;return(l=f.props.flash)==null?void 0:l.message}),O=k(()=>{var l;return((l=f.props.flash)==null?void 0:l.type)||"info"}),D=h(!1),i=h(!1),r=Y({id:null,name:"",email:"",password:"",password_confirmation:"",roles:[]}),_=h(E.value.search||""),y=h(E.value.role||""),Q=()=>{console.log("Applying filters:",{search:_.value,role:y.value}),C.get(route("admin.users.index"),{search:_.value,role:y.value,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})};L([_,y],ie.debounce(Q,300));const I=()=>{i.value=!1,r.reset(),r.clearErrors(),D.value=!0},W=l=>{i.value=!0,r.reset(),r.clearErrors(),r.id=l.id,r.name=l.name,r.email=l.email,r.password="",r.password_confirmation="",r.roles=l.roles_array?[...l.roles_array]:[],D.value=!0},A=()=>{D.value=!1,r.reset(),r.clearErrors()},z=()=>{const l=i.value?route("admin.users.update",r.id):route("admin.users.store"),e=i.value?"put":"post";r.submit(e,l,{preserveScroll:!0,onSuccess:()=>{A(),console.log("Form submitted successfully. Reloading page props...")},onError:x=>{console.error("Form submission error:",x)}})},w=h(!1),b=h(null),G=l=>{b.value=l,w.value=!0},J=()=>{b.value&&C.delete(route("admin.users.destroy",b.value.id),{preserveScroll:!0,onSuccess:()=>{b.value=null,w.value=!1,console.log("User deleted successfully. Reloading page props..."),C.reload({preserveScroll:!0})},onError:l=>{console.error("Delete error:",l),b.value=null,w.value=!1}})};return Z(()=>{var e,x;const l=new URLSearchParams(window.location.search);_.value=l.get("search")||E.value.search||"",y.value=l.get("role")||E.value.role||"",console.log("Mounted. Initial Users:",(x=(e=u.value)==null?void 0:e.data)==null?void 0:x.length)}),L(()=>f.props.users,l=>{console.log("PAGE.PROPS.USERS (prop) changed:",l)},{deep:!0}),L(u,l=>{console.log("COMPUTED USERS changed:",l)},{deep:!0}),(l,e)=>(d(),n(U,null,[o(a(ee),{title:"Manage Users"}),o(oe,null,{header:m(()=>e[9]||(e[9]=[s("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"User Management",-1)])),default:m(()=>{var x;return[o(ne,{message:H.value,type:O.value},null,8,["message","type"]),s("div",pe,[s("div",ge,[s("div",fe,[s("div",xe,[s("div",ve,[s("div",_e,[o(S,{type:"text",modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"Search name or email...",class:"w-full sm:w-auto md:flex-grow lg:max-w-xs","aria-label":"Search users"},null,8,["modelValue"]),se(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),class:"w-full sm:w-auto md:flex-grow lg:max-w-xs border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm","aria-label":"Filter by role"},[e[10]||(e[10]=s("option",{value:""},"All Roles",-1)),(d(!0),n(U,null,P(R.value,t=>(d(),n("option",{key:t,value:t},g(t),9,ye))),128))],512),[[te,y.value]])]),(x=T.value)!=null&&x.create_user?(d(),q(B,{key:0,onClick:I,class:"w-full md:w-auto mt-2 md:mt-0"},{default:m(()=>[o(a(ue),{class:"-ml-0.5 mr-1.5 h-5 w-5","aria-hidden":"true"}),e[11]||(e[11]=v(" Add New User "))]),_:1,__:[11]})):p("",!0)]),s("div",we,[s("table",be,[e[13]||(e[13]=s("thead",{class:"bg-gray-50 dark:bg-gray-700"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Name"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Email"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Roles"),s("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Actions")])],-1)),s("tbody",ke,[!u.value||!u.value.data||u.value.data.length===0?(d(),n("tr",he,e[12]||(e[12]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400"},"No users found.",-1)]))):p("",!0),(d(!0),n(U,null,P(u.value.data,t=>{var c,$;return d(),n("tr",{key:t.id},[s("td",Ue,g(t.name),1),s("td",Ce,g(t.email),1),s("td",Se,[t.roles_string&&t.roles_string.length>0?(d(),n("span",Ve,g(t.roles_string),1)):(d(),n("span",Me,"No Roles"))]),s("td",Ee,[(c=T.value)!=null&&c.edit_user?(d(),n("button",{key:0,onClick:K=>W(t),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 p-1 mr-2",title:"Edit User"},[o(a(me),{class:"h-5 w-5"})],8,Re)):p("",!0),($=T.value)!=null&&$.delete_user?(d(),n("button",{key:1,onClick:K=>G(t),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 p-1",title:"Delete User"},[o(a(ce),{class:"h-5 w-5"})],8,De)):p("",!0)])])}),128))])])]),u.value&&u.value.links&&u.value.links.length>3?(d(),n("div",$e,[s("div",Pe,[(d(!0),n(U,null,P(u.value.links,(t,c)=>(d(),n(U,{key:c},[t.url===null?(d(),n("div",{key:0,class:"mr-1 mb-1 px-3 py-2 text-sm leading-4 text-gray-400 dark:text-gray-500 border rounded dark:border-gray-600 select-none",innerHTML:t.label},null,8,Te)):(d(),q(a(re),{key:1,class:N(["mr-1 mb-1 px-3 py-2 text-sm leading-4 border rounded dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:border-indigo-500 dark:focus:border-indigo-700 focus:text-indigo-500 dark:focus:text-indigo-300",{"bg-indigo-500 text-white dark:bg-indigo-600 dark:text-white dark:border-indigo-700":t.active}]),href:t.url,innerHTML:t.label,"preserve-scroll":""},null,8,["class","href","innerHTML"]))],64))),128))])])):p("",!0)])])])]),o(F,{show:D.value,onClose:A,maxWidth:"2xl"},{default:m(()=>[s("div",Ae,[s("h2",Le,g(i.value?"Edit User":"Create New User"),1),s("form",{onSubmit:ae(z,["prevent"]),class:"space-y-6"},[s("div",null,[o(V,{for:"name_modal_user_form",value:"Name"}),o(S,{id:"name_modal_user_form",type:"text",class:"mt-1 block w-full",modelValue:a(r).name,"onUpdate:modelValue":e[2]||(e[2]=t=>a(r).name=t),required:"",autofocus:"",autocomplete:"name"},null,8,["modelValue"]),o(M,{class:"mt-2",message:a(r).errors.name},null,8,["message"])]),s("div",null,[o(V,{for:"email_modal_user_form",value:"Email"}),o(S,{id:"email_modal_user_form",type:"email",class:"mt-1 block w-full",modelValue:a(r).email,"onUpdate:modelValue":e[3]||(e[3]=t=>a(r).email=t),required:"",autocomplete:"email"},null,8,["modelValue"]),o(M,{class:"mt-2",message:a(r).errors.email},null,8,["message"])]),s("div",null,[o(V,{for:"password_modal_user_form",value:i.value?"New Password (Optional)":"Password"},null,8,["value"]),o(S,{id:"password_modal_user_form",type:"password",class:"mt-1 block w-full",modelValue:a(r).password,"onUpdate:modelValue":e[4]||(e[4]=t=>a(r).password=t),required:!i.value,autocomplete:"new-password"},null,8,["modelValue","required"]),o(M,{class:"mt-2",message:a(r).errors.password},null,8,["message"]),i.value&&!a(r).password?(d(),n("p",Ne,"Leave blank to keep current password.")):p("",!0)]),a(r).password||!i.value?(d(),n("div",qe,[o(V,{for:"password_confirmation_modal_user_form",value:"Confirm Password"}),o(S,{id:"password_confirmation_modal_user_form",type:"password",class:"mt-1 block w-full",modelValue:a(r).password_confirmation,"onUpdate:modelValue":e[5]||(e[5]=t=>a(r).password_confirmation=t),required:a(r).password!==""||!i.value,autocomplete:"new-password"},null,8,["modelValue","required"]),o(M,{class:"mt-2",message:a(r).errors.password_confirmation},null,8,["message"])])):p("",!0),R.value&&R.value.length>0?(d(),n("div",Be,[o(V,{value:"Roles",class:"mb-1"}),s("div",Fe,[(d(!0),n(U,null,P(R.value,(t,c)=>(d(),n("label",{key:"role_option_"+c,class:"flex items-center space-x-2 cursor-pointer"},[o(de,{id:"role_modal_user_form_"+c,value:t,checked:a(r).roles,"onUpdate:checked":e[6]||(e[6]=$=>a(r).roles=$)},null,8,["id","value","checked"]),s("span",je,g(t),1)]))),128))]),o(M,{class:"mt-2",message:a(r).errors.roles},null,8,["message"])])):p("",!0),s("div",He,[o(j,{onClick:A,type:"button"},{default:m(()=>e[14]||(e[14]=[v(" Cancel ")])),_:1,__:[14]}),o(B,{class:N({"opacity-25":a(r).processing}),disabled:a(r).processing},{default:m(()=>[v(g(i.value?"Update User":"Create User"),1)]),_:1},8,["class","disabled"])])],32)])]),_:1},8,["show"]),o(F,{show:w.value,onClose:e[8]||(e[8]=t=>w.value=!1),maxWidth:"md"},{default:m(()=>{var t;return[s("div",Oe,[e[19]||(e[19]=s("h2",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," Confirm Delete User ",-1)),s("p",Qe,[e[15]||(e[15]=v(' Are you sure you want to delete user "')),s("span",Ie,g((t=b.value)==null?void 0:t.name),1),e[16]||(e[16]=v('"? This action cannot be undone. '))]),s("div",We,[o(j,{onClick:e[7]||(e[7]=c=>w.value=!1),type:"button"},{default:m(()=>e[17]||(e[17]=[v(" Cancel ")])),_:1,__:[17]}),o(le,{onClick:J,class:N({"opacity-25":a(C).processing||a(r).processing}),disabled:a(C).processing||a(r).processing},{default:m(()=>e[18]||(e[18]=[v(" Delete User ")])),_:1,__:[18]},8,["class","disabled"])])])]}),_:1},8,["show"])]}),_:1})],64))}};export{cs as default};
