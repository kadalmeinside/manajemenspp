import{G as ee,k as x,r as U,x as se,y as L,o as te,c as n,b as d,d as r,u as o,g as ae,w as c,e as a,l as p,h as F,C as re,F as y,f as V,t as g,D as oe,j as _,S as le,n as N,m as de,T as ne,Q as M}from"./app-D_KT0tPu.js";import{A as ie}from"./AuthenticatedLayout-Be6LC74m.js";import{P as q}from"./PrimaryButton-cD5W__y6.js";import{_ as B,a as K}from"./SecondaryButton-BiNkEi16.js";import{D as ue}from"./DangerButton-C2W4mQAu.js";import{a as E,_ as C,b as S}from"./TextInput-BfGu2Bmr.js";import{_ as j}from"./Checkbox-DWbs9nPn.js";import{_ as me}from"./Toast-BdrNrtSR.js";import{l as ce}from"./lodash-rIsAmA1W.js";import{r as pe}from"./PlusIcon-Cs-t4Mrz.js";import{r as ge}from"./PencilIcon-DhKA6nmb.js";import{r as fe}from"./TrashIcon-BLifyBJy.js";import"./ApplicationLogo-DBJf_uXy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DropdownLink-BCWgZ0fC.js";import"./ArrowPathIcon-BICNMCoS.js";import"./CheckCircleIcon-Dj4egUVU.js";import"./XCircleIcon-QLoYyhtd.js";import"./UsersIcon-my6ZFiS5.js";import"./XMarkIcon-oIUpVMdT.js";import"./ChevronDownIcon-C8dmnrSh.js";import"./ChevronRightIcon-B1ZJtrh5.js";import"./InformationCircleIcon-D9vQXY2O.js";import"./ExclamationTriangleIcon-D392v1z5.js";import"./CheckCircleIcon-CS25EzUu.js";const xe={class:"pb-12 pt-4"},ve={class:"max-w-7xl mx-auto"},ye={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-sm sm:rounded-lg"},_e={class:"p-6 text-gray-900 dark:text-gray-100"},ke={class:"mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4"},we={class:"flex flex-col sm:flex-row items-center gap-3 flex-grow"},be=["value"],he={class:"overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ce={class:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"},Se={key:0},Ve={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},Me={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300"},Ee={class:"px-6 py-4 whitespace-nowrap text-sm"},Re={key:0,class:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},De={key:1,class:"text-xs text-gray-400"},$e={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Pe=["onClick"],Te=["onClick"],Ae={key:0,class:"p-4 border-t border-gray-200 dark:border-gray-700"},Le={class:"flex flex-wrap -mb-1 justify-center"},Ne=["innerHTML"],Fe={class:"p-6"},qe={class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4 border-b pb-3 dark:border-gray-700"},Be={key:0,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Ke={key:0},je={key:1},He={class:"mt-2 grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-2 max-h-32 overflow-y-auto p-2 border dark:border-gray-700 rounded-md"},Ie={class:"text-sm text-gray-700 dark:text-gray-300"},Oe={key:0},Qe={class:"mt-2 max-h-48 overflow-y-auto border dark:border-gray-700 rounded-md p-2 grid grid-cols-2 md:grid-cols-3 gap-4"},Ge={class:"ms-2 text-sm text-gray-600 dark:text-gray-400"},We={class:"mt-6 flex justify-end space-x-3 pt-4 border-t dark:border-gray-700"},ze={class:"p-6"},Je={class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},Xe={class:"font-semibold"},Ye={class:"mt-6 flex justify-end space-x-3"},Cs={__name:"Index",setup(Ze){const f=ee(),u=x(()=>f.props.users),R=x(()=>f.props.filters||{}),D=x(()=>f.props.allRoles||[]),H=x(()=>f.props.allKelas||[]),T=x(()=>f.props.can||{}),I=x(()=>{var l;return(l=f.props.flash)==null?void 0:l.message}),O=x(()=>{var l;return((l=f.props.flash)==null?void 0:l.type)||"info"}),$=U(!1),i=U(!1),s=se({id:null,name:"",email:"",password:"",password_confirmation:"",roles:[],kelas_ids:[]}),k=U(R.value.search||""),w=U(R.value.role||""),Q=()=>{console.log("Applying filters:",{search:k.value,role:w.value}),M.get(route("admin.users.index"),{search:k.value,role:w.value,page:1},{preserveState:!0,preserveScroll:!0,replace:!0})};L([k,w],ce.debounce(Q,300));const G=()=>{i.value=!1,s.reset(),s.clearErrors(),$.value=!0},W=l=>{i.value=!0,s.reset(),s.clearErrors(),s.id=l.id,s.name=l.name,s.email=l.email,s.password="",s.password_confirmation="",s.roles=l.roles_array?[...l.roles_array]:[],s.kelas_ids=l.managedKelasIds?[...l.managedKelasIds]:[],$.value=!0},z=x(()=>s.roles.includes("admin_kelas")),A=()=>{$.value=!1,s.reset(),s.clearErrors()},J=()=>{const l=i.value?route("admin.users.update",s.id):route("admin.users.store"),e=i.value?"put":"post";s.submit(e,l,{preserveScroll:!0,onSuccess:()=>{A(),console.log("Form submitted successfully. Reloading page props...")},onError:v=>{console.error("Form submission error:",v)}})},b=U(!1),h=U(null),X=l=>{h.value=l,b.value=!0},Y=()=>{h.value&&M.delete(route("admin.users.destroy",h.value.id),{preserveScroll:!0,onSuccess:()=>{h.value=null,b.value=!1,console.log("User deleted successfully. Reloading page props..."),M.reload({preserveScroll:!0})},onError:l=>{console.error("Delete error:",l),h.value=null,b.value=!1}})};return te(()=>{var e,v;const l=new URLSearchParams(window.location.search);k.value=l.get("search")||R.value.search||"",w.value=l.get("role")||R.value.role||"",console.log("Mounted. Initial Users:",(v=(e=u.value)==null?void 0:e.data)==null?void 0:v.length)}),L(()=>f.props.users,l=>{console.log("PAGE.PROPS.USERS (prop) changed:",l)},{deep:!0}),L(u,l=>{console.log("COMPUTED USERS changed:",l)},{deep:!0}),(l,e)=>(d(),n(y,null,[r(o(ae),{title:"Manage Users"}),r(ie,null,{header:c(()=>e[10]||(e[10]=[a("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"User Management",-1)])),default:c(()=>{var v;return[r(me,{message:I.value,type:O.value},null,8,["message","type"]),a("div",xe,[a("div",ve,[a("div",ye,[a("div",_e,[a("div",ke,[a("div",we,[r(E,{type:"text",modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:"Search name or email...",class:"w-full sm:w-auto md:flex-grow lg:max-w-xs","aria-label":"Search users"},null,8,["modelValue"]),re(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>w.value=t),class:"w-full sm:w-auto md:flex-grow lg:max-w-xs border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm","aria-label":"Filter by role"},[e[11]||(e[11]=a("option",{value:""},"All Roles",-1)),(d(!0),n(y,null,V(D.value,t=>(d(),n("option",{key:t,value:t},g(t),9,be))),128))],512),[[oe,w.value]])]),(v=T.value)!=null&&v.create_user?(d(),F(q,{key:0,onClick:G,class:"w-full md:w-auto mt-2 md:mt-0"},{default:c(()=>[r(o(pe),{class:"-ml-0.5 mr-1.5 h-5 w-5","aria-hidden":"true"}),e[12]||(e[12]=_(" Add New User "))]),_:1,__:[12]})):p("",!0)]),a("div",he,[a("table",Ue,[e[14]||(e[14]=a("thead",{class:"bg-gray-50 dark:bg-gray-700"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Name"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Email"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Roles"),a("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider"},"Actions")])],-1)),a("tbody",Ce,[!u.value||!u.value.data||u.value.data.length===0?(d(),n("tr",Se,e[13]||(e[13]=[a("td",{colspan:"4",class:"px-6 py-4 text-center text-sm text-gray-500 dark:text-gray-400"},"No users found.",-1)]))):p("",!0),(d(!0),n(y,null,V(u.value.data,t=>{var m,P;return d(),n("tr",{key:t.id},[a("td",Ve,g(t.name),1),a("td",Me,g(t.email),1),a("td",Ee,[t.roles_string&&t.roles_string.length>0?(d(),n("span",Re,g(t.roles_string),1)):(d(),n("span",De,"No Roles"))]),a("td",$e,[(m=T.value)!=null&&m.edit_user?(d(),n("button",{key:0,onClick:Z=>W(t),class:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-200 p-1 mr-2",title:"Edit User"},[r(o(ge),{class:"h-5 w-5"})],8,Pe)):p("",!0),(P=T.value)!=null&&P.delete_user?(d(),n("button",{key:1,onClick:Z=>X(t),class:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-200 p-1",title:"Delete User"},[r(o(fe),{class:"h-5 w-5"})],8,Te)):p("",!0)])])}),128))])])]),u.value&&u.value.links&&u.value.links.length>3?(d(),n("div",Ae,[a("div",Le,[(d(!0),n(y,null,V(u.value.links,(t,m)=>(d(),n(y,{key:m},[t.url===null?(d(),n("div",{key:0,class:"mr-1 mb-1 px-3 py-2 text-sm leading-4 text-gray-400 dark:text-gray-500 border rounded dark:border-gray-600 select-none",innerHTML:t.label},null,8,Ne)):(d(),F(o(le),{key:1,class:N(["mr-1 mb-1 px-3 py-2 text-sm leading-4 border rounded dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 focus:border-indigo-500 dark:focus:border-indigo-700 focus:text-indigo-500 dark:focus:text-indigo-300",{"bg-indigo-500 text-white dark:bg-indigo-600 dark:text-white dark:border-indigo-700":t.active}]),href:t.url,innerHTML:t.label,"preserve-scroll":""},null,8,["class","href","innerHTML"]))],64))),128))])])):p("",!0)])])])]),r(B,{show:$.value,onClose:A,maxWidth:"2xl"},{default:c(()=>[a("div",Fe,[a("h2",qe,g(i.value?"Edit User":"Create New User"),1),a("form",{onSubmit:de(J,["prevent"]),class:"space-y-6"},[a("div",null,[r(C,{for:"name_modal_user_form",value:"Name"}),r(E,{id:"name_modal_user_form",type:"text",class:"mt-1 block w-full",modelValue:o(s).name,"onUpdate:modelValue":e[2]||(e[2]=t=>o(s).name=t),required:"",autofocus:"",autocomplete:"name"},null,8,["modelValue"]),r(S,{class:"mt-2",message:o(s).errors.name},null,8,["message"])]),a("div",null,[r(C,{for:"email_modal_user_form",value:"Email"}),r(E,{id:"email_modal_user_form",type:"email",class:"mt-1 block w-full",modelValue:o(s).email,"onUpdate:modelValue":e[3]||(e[3]=t=>o(s).email=t),required:"",autocomplete:"email"},null,8,["modelValue"]),r(S,{class:"mt-2",message:o(s).errors.email},null,8,["message"])]),a("div",null,[r(C,{for:"password_modal_user_form",value:i.value?"New Password (Optional)":"Password"},null,8,["value"]),r(E,{id:"password_modal_user_form",type:"password",class:"mt-1 block w-full",modelValue:o(s).password,"onUpdate:modelValue":e[4]||(e[4]=t=>o(s).password=t),required:!i.value,autocomplete:"new-password"},null,8,["modelValue","required"]),r(S,{class:"mt-2",message:o(s).errors.password},null,8,["message"]),i.value&&!o(s).password?(d(),n("p",Be,"Leave blank to keep current password.")):p("",!0)]),o(s).password||!i.value?(d(),n("div",Ke,[r(C,{for:"password_confirmation_modal_user_form",value:"Confirm Password"}),r(E,{id:"password_confirmation_modal_user_form",type:"password",class:"mt-1 block w-full",modelValue:o(s).password_confirmation,"onUpdate:modelValue":e[5]||(e[5]=t=>o(s).password_confirmation=t),required:o(s).password!==""||!i.value,autocomplete:"new-password"},null,8,["modelValue","required"]),r(S,{class:"mt-2",message:o(s).errors.password_confirmation},null,8,["message"])])):p("",!0),D.value&&D.value.length>0?(d(),n("div",je,[r(C,{value:"Roles",class:"mb-1"}),a("div",He,[(d(!0),n(y,null,V(D.value,(t,m)=>(d(),n("label",{key:"role_option_"+m,class:"flex items-center space-x-2 cursor-pointer"},[r(j,{id:"role_modal_user_form_"+m,value:t,checked:o(s).roles,"onUpdate:checked":e[6]||(e[6]=P=>o(s).roles=P)},null,8,["id","value","checked"]),a("span",Ie,g(t),1)]))),128))]),r(S,{class:"mt-2",message:o(s).errors.roles},null,8,["message"])])):p("",!0),r(ne,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0"},{default:c(()=>[z.value?(d(),n("div",Oe,[r(C,{value:"Tugaskan ke Kelas"}),e[15]||(e[15]=a("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-2"},"Pilih satu atau lebih kelas yang akan dikelola oleh user ini.",-1)),a("div",Qe,[(d(!0),n(y,null,V(H.value,t=>(d(),n("label",{key:t.id_kelas,class:"flex items-center"},[r(j,{value:t.id_kelas,checked:o(s).kelas_ids,"onUpdate:checked":e[7]||(e[7]=m=>o(s).kelas_ids=m)},null,8,["value","checked"]),a("span",Ge,g(t.nama_kelas),1)]))),128))]),r(S,{class:"mt-2",message:o(s).errors.kelas_ids},null,8,["message"])])):p("",!0)]),_:1}),a("div",We,[r(K,{onClick:A,type:"button"},{default:c(()=>e[16]||(e[16]=[_(" Cancel ")])),_:1,__:[16]}),r(q,{class:N({"opacity-25":o(s).processing}),disabled:o(s).processing},{default:c(()=>[_(g(i.value?"Update User":"Create User"),1)]),_:1},8,["class","disabled"])])],32)])]),_:1},8,["show"]),r(B,{show:b.value,onClose:e[9]||(e[9]=t=>b.value=!1),maxWidth:"md"},{default:c(()=>{var t;return[a("div",ze,[e[21]||(e[21]=a("h2",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"}," Confirm Delete User ",-1)),a("p",Je,[e[17]||(e[17]=_(' Are you sure you want to delete user "')),a("span",Xe,g((t=h.value)==null?void 0:t.name),1),e[18]||(e[18]=_('"? This action cannot be undone. '))]),a("div",Ye,[r(K,{onClick:e[8]||(e[8]=m=>b.value=!1),type:"button"},{default:c(()=>e[19]||(e[19]=[_(" Cancel ")])),_:1,__:[19]}),r(ue,{onClick:Y,class:N({"opacity-25":o(M).processing||o(s).processing}),disabled:o(M).processing||o(s).processing},{default:c(()=>e[20]||(e[20]=[_(" Delete User ")])),_:1,__:[20]},8,["class","disabled"])])])]}),_:1},8,["show"])]}),_:1})],64))}};export{Cs as default};
